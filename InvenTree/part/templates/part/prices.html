{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load inventree_extras %}

<div class='panel-heading'>
    <div class='d-flex flex-wrap'>
        <h4>{% trans "Price Range Overview" %}</h4>
        {% include "spacer.html" %}
        <div class='btn-group' role='group'>
            <button type='button' class='btn btn-success' id='part-pricing-refresh' title='{% trans "Refresh Part Pricing" %}'>
                <span class='fas fa-redo-alt'></span> {% trans "Refresh" %}
            </button>
        </div>
    </div>
</div>
{% with part.pricing as pricing %}
{% if pricing.is_valid %}
<!-- Part pricing table -->
<div class='alert alert-info alert-block'>
    {% trans "Last Updated" %}: {% render_date pricing.updated %}
</div>
<table class='table table-striped table-condensed'>
    <thead>
        <tr>
            <th>{% trans "Price Category" %}</th>
            <th>{% trans "Minimum" %}</th>
            <th>{% trans "Maximum" %}</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th>{% trans "Internal Price" %}</th>
            <td>{% include "price_data.html" with price=pricing.internal_cost_min %}</td>
            <td>{% include "price_data.html" with price=pricing.internal_cost_max %}</td>
        </tr>
        {% if part.purchaseable %}
        <tr>
            <th>{% trans "Purchase Cost" %}</th>
            <td>{% include "price_data.html" with price=pricing.purchase_cost_min %}</td>
            <td>{% include "price_data.html" with price=pricing.purchase_cost_max %}</td>
        </tr>
        <tr>
            <th>{% trans "Supplier Price" %}</th>
            <td>{% include "price_data.html" with price=pricing.supplier_price_min %}</td>
            <td>{% include "price_data.html" with price=pricing.supplier_price_max %}</td>
        </tr>
        {% endif %}
        {% if part.assembly %}
        <tr>
            <th>{% trans "BOM Cost" %}</th>
            <td>{% include "price_data.html" with price=pricing.bom_cost_min %}</td>
            <td>{% include "price_data.html" with price=pricing.bom_cost_max %}</td>
        </tr>
        {% endif %}
        <tr>
            <th>
                {% trans "Overall Cost" %}
            </th>
            <th>{% include "price_data.html" with price=pricing.overall_min %}</th>
            <th>{% include "price_data.html" with price=pricing.overall_max %}</th>
        </tr>
    </tbody>
</table>
{% else %}
<div class='alert alert-warning alert-block'>
    {% trans "Price range data is not available for this part." %}
</div>
{% endif %}
{% endwith %}

{% settings_value "PART_INTERNAL_PRICE" as show_internal_price %}
{% if show_internal_price and roles.sales_order.view %}
<a class="anchor" id="internal-cost"></a>
<div class='panel-heading'>
    <div class='d-flex flex-wrap'>
        <h4>{% trans "Internal Pricing" %}
            <a href="#overview" title='{% trans "Jump to overview" %}'><span class="fas fa-level-up-alt"></span></a>
        </h4>
        {% include "spacer.html" %}
        <div class='btn-group' role='group'>
            <button class='btn btn-success' id='new-internal-price-break' type='button'>
                <span class='fas fa-plus-circle'></span> {% trans "Add Internal Price Break" %}
            </button>
        </div>
    </div>
</div>

<div class='panel-content'>
    <div class="row full-height">
        <div class="col col-md-6">
            <div style="max-width: 99%; height: 100%;">
                <canvas id="InternalPriceBreakChart"></canvas>
            </div>
        </div>
        <div class="col col-md-6">

            <table class='table table-striped table-condensed' id='internal-price-break-table' data-toolbar='#internal-price-break-toolbar'
                data-sort-name="quantity" data-sort-order="asc">
            </table>
        </div>
    </div>
</div>
{% endif %}

{% if part.purchaseable and roles.purchase_order.view %}
{% if show_price_history %}
<div class='panel-heading'>
    <h4>
        {% trans "Purchase Price History" %}
        <a href="#overview" title='{% trans "Jump to overview" %}'><span class="fas fa-level-up-alt"></span></a>
    </h4>
</div>
<div class='panel-content'>
    <div class="row full-height">
        <div class="col col-md-6">
            <div style="max-width: 99%; height: 100%;">
                <canvas id="part-purchase-history-chart"></canvas>
            </div>
        </div>
        <div class="col col-md-6">
            <table class='table table-striped table-condensed' id='part-purchase-history-table' data-toolbar='#internal-price-break-toolbar'>
            </table>
        </div>
    </div>
</div>
{% endif %}

<a class="anchor" id="supplier-cost"></a>
<div class='panel-heading'>
    <h4>
        {% trans "Supplier Prices" %}
        <a href="#overview" title='{% trans "Jump to overview" %}'><span class="fas fa-level-up-alt"></span></a>
    </h4>
</div>

<div class='panel-content'>
    <div class='row full-height'>
        <div class="col col-md-6">
            <div style="max-width: 99%; height: 100%;">
                <canvas id="part-supplier-pricing-chart"></canvas>
            </div>
        </div>
        <div class="col col-md-6">
            <table class='table table-striped table-condensed' id='part-supplier-pricing-table' data-toolbar='#internal-price-break-toolbar'>
            </table>
        </div>
    </div>
</div>
{% endif %}


{% if part.assembly and part.has_bom %}
<a class="anchor" id="bom-cost"></a>
<div class='panel-heading'>
    <h4>{% trans "BOM Cost" %}
        <a href="#overview" title='{% trans "Jump to overview" %}'><span class="fas fa-level-up-alt"></span></a>
    </h4>
</div>

<div class='panel-content'>
    <div class='row full-height'>
        <div class="col col-md-6">
            <div style="max-width: 99%; height: 100%;">
                <canvas id="bom-pricing-chart"></canvas>
            </div>
        </div>
        <div class="col col-md-6">
            <table class='table table-striped table-condensed' id='bom-pricing-table' data-toolbar='#internal-price-break-toolbar'>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% if part.salable and roles.sales_order.view %}
<a class="anchor" id="sale-cost"></a>
<div class='panel-heading'>
    <h4>{% trans "Sale Cost" %}
        <a href="#overview" title='{% trans "Jump to overview" %}'><span class="fas fa-level-up-alt"></span></a>
    </h4>
</div>

<div class='panel-content'>
    <div class="row full-height">
        <div class="col col-md-8">
            <div style="max-width: 99%; height: 100%;">
                <canvas id="SalePriceBreakChart"></canvas>
            </div>
        </div>
        <div class="col col-md-4">
            <div id='price-break-toolbar' class='btn-group'>
                <button class='btn btn-success' id='new-price-break' type='button'>
                    <span class='fas fa-plus-circle'></span> {% trans "Add Price Break" %}
                </button>
            </div>

            <table class='table table-striped table-condensed' id='price-break-table' data-toolbar='#price-break-toolbar'
            data-sort-name="quantity" data-sort-order="asc">
            </table>
        </div>
    </div>
</div>

{% if show_price_history %}
<a class="anchor" id="sale-price"></a>
<div class='panel-heading'>
    <h4>{% trans "Sale Price" %}
        <a href="#overview" title='{% trans "Jump to overview" %}'><span class="fas fa-level-up-alt"></span></a>
    </h4>
</div>

<div class='panel-content'>
    {% if sale_history|length > 0 %}
        <div style="max-width: 99%; min-height: 300px">
            <canvas id="SalePriceChart"></canvas>
        </div>
    {% else %}
        <div class='alert alert-danger alert-block'>
            {% trans 'No sale pice history available for this part.' %}
        </div>
    {% endif %}
</div>
{% endif %}
{% endif %}
