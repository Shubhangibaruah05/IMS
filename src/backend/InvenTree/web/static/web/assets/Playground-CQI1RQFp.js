import{r as l,j as e,S as g,z as F,J as N,aa as M,h,an as L,G as _,D as x,a9 as V,ao as G,a7 as U,ap as q,H as z,Y as H,ae as Q,aq as C,ar as Y,ac as B}from"./vendor-C5fHLTDD.js";import{T as P}from"./BaseContext-BGXKB9QI.js";import{O as K}from"./ApiForm-Dtyf-xF2.js";import{A as u,i as m,l as k,j as I,n as J,M as w}from"./index-DX4YmBvQ.js";import{u as A}from"./UseInstance-rwUPjJ4i.js";import{S as T}from"./StylishText-CD9I8-X7.js";import{g as W,S as Z}from"./Instance-c0njg-mI.js";import{S as $}from"./StandaloneField-BRVMmltH.js";import{P as X}from"./Placeholder-C1-1kY0o.js";import{p as ee,u as b}from"./PartForms-FGG79plz.js";import{u as te}from"./StockForms-yHG_9MvM.js";import{u as y,a as S}from"./UseForm-Btt47jru.js";import"./notifications-DM-9a7Is.js";import"./IconInfoCircle-D5K91YCo.js";import"./IconTrash-KFql82qv.js";import"./IconExternalLink-CDh1KHXW.js";import"./IconQrcode-DcoHpd2K.js";import"./ActionButton-seel8ZoK.js";function re({field:t,row:i,session:n}){const r=l.useMemo(()=>{const o=(n==null?void 0:n.available_fields)??{};let a;return console.log("row:",i),Object.keys(o).forEach(s=>{s==t&&(a=o[s],a={...a,field_type:a.type,description:a.help_text,value:(i==null?void 0:i.data[t])??a.default,disabled:a.read_only??!1})}),a??{}},[n,t]);return e.jsx("td",{children:t?e.jsx($,{fieldDefinition:r,hideLabels:!0}):e.jsx(h,{children:"field value"})})}function ae({row:t,session:i,onRowDeleted:n}){const r=l.useMemo(()=>(i==null?void 0:i.column_mappings)??[],[i]),o=l.useCallback(()=>{const a=k(u.import_session_row_list,t.pk);I.delete(a).then(()=>{n()}).catch(()=>{J.show({title:m._({id:"SlfejT"}),message:m._({id:"reibn4"}),color:"red"})})},[t]);return e.jsxs("tr",{children:[e.jsx("td",{children:t.row_index}),r.map(a=>e.jsx(re,{field:a.field,row:t,session:i})),e.jsx("td",{children:e.jsx(M,{label:m._({id:"3mIfxA"}),position:"left",children:e.jsx(L,{color:"red",onClick:o})})})]})}function se({session:t,onComplete:i}){const{instance:n,refreshInstance:r,instanceQuery:o}=A({endpoint:u.import_session_row_list,params:{session:t.pk,ordering:"row_index"},hasPrimaryKey:!1,defaultValue:[],refetchOnMount:!0}),a=l.useMemo(()=>(t==null?void 0:t.column_mappings)??[],[t]);return e.jsxs(g,{spacing:"xs",children:[e.jsx(F,{visible:o.isFetching}),e.jsxs(N,{striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:m._({id:"IqKCNQ"})}),a.map(s=>e.jsx("th",{children:e.jsx(M,{label:s.description,hidden:!s.description,children:e.jsx(h,{weight:700,children:(s==null?void 0:s.label)||(s==null?void 0:s.column)})})})),e.jsx("th",{})]})}),e.jsx("tbody",{children:n&&n.map(s=>e.jsx(ae,{row:s,session:t,onRowDeleted:r}))})]})]})}function ie({column:t,options:i}){const[n,r]=l.useState(""),[o,a]=l.useState(t.field??"");l.useEffect(()=>{a(t.field??"")},[t.field]);const s=l.useCallback(c=>{c!=o&&I.patch(k(u.import_session_column_mapping_list,t.pk),{field:c||""}).then(p=>{var d;a(((d=p.data)==null?void 0:d.field)??c),r("")}).catch(p=>{const d=p.response.data;r(d.field??d.non_field_errors??m._({id:"Vw8l6h"}))})},[t]);return e.jsx(G,{error:n,clearable:!0,placeholder:m._({id:"v3S42f"}),label:t.column,data:i,value:o,onChange:s,withinPortal:!0})}function ne({session:t,onComplete:i}){var s;const n=l.useMemo(()=>{const c=(t==null?void 0:t.available_fields)??{};let p=[];for(const d in c){let j=c[d];j.read_only||p.push({value:d,label:j.label??d})}return p},[t]),[r,o]=l.useState(""),a=l.useCallback(()=>{const c=k(u.import_session_accept_fields,t.pk);I.post(c).then(p=>{i()}).catch(p=>{var d,j;o(((j=(d=p.response)==null?void 0:d.data)==null?void 0:j.error)??m._({id:"Vw8l6h"}))})},[t]);return e.jsxs(g,{spacing:"xs",children:[e.jsxs(_,{position:"apart",children:[e.jsx(h,{children:m._({id:"Wew5xr"})}),e.jsx(x,{color:"green",variant:"filled",onClick:a,children:m._({id:"Y+Sfcf"})})]}),r&&e.jsx(V,{color:"red",title:m._({id:"SlfejT"}),children:e.jsx(h,{children:r})}),(s=t==null?void 0:t.column_mappings)==null?void 0:s.map(c=>e.jsx(ie,{column:c,options:n}))]})}function le({sessionId:t,opened:i,onClose:n}){const{instance:r,refreshInstance:o,instanceQuery:a}=A({endpoint:u.import_session_list,pk:t,refetchOnMount:!0}),s=l.useMemo(()=>W(w.importsession,r==null?void 0:r.status),[r]),c=l.useMemo(()=>{switch(s){case"INITIAL":return e.jsx(h,{children:"Initial"});case"MAPPING":return e.jsx(ne,{session:r,onComplete:o});case"IMPORTING":return e.jsx(h,{children:"Importing..."});case"PROCESSING":return e.jsx(se,{session:r,onComplete:o});case"COMPLETE":return e.jsx(h,{children:"Complete!"});default:return e.jsxs(h,{children:["Unknown status code: ",r==null?void 0:r.status]})}},[r]),p=l.useCallback(()=>{I.delete(k(u.import_session_list,t)),n()},[r]);return e.jsx(U,{position:"bottom",size:"80%",opened:i,onClose:n,withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,children:e.jsxs(g,{spacing:"xs",children:[e.jsxs(_,{position:"apart",grow:!0,children:[e.jsx(T,{size:"xl",children:m._({id:"CTRRU5"})}),e.jsx(q,{value:20,label:m._({id:"qYDajY"}),size:"20px",radius:"md"}),e.jsx(_,{position:"right",children:e.jsx(x,{color:"red",variant:"filled",onClick:p,children:m._({id:"vrLFuQ"})})})]}),e.jsx(z,{}),e.jsx(H,{children:e.jsxs(g,{spacing:"xs",children:[e.jsx(F,{visible:a.isFetching}),e.jsx(Q,{p:"md",children:a.isFetching||c})]})})]})})}function oe({model:t}){return l.useMemo(()=>({data_file:{},model_type:{value:t},field_detauls:{hidden:!0}}),[])}const ce=ee({});function de(){const t=y({url:u.category_list,pk:2,title:"Edit Category",fields:ce}),i=b({create:!0}),n=b({create:!1}),r=S({url:u.part_list,title:"Create Part",fields:i,initialData:{description:"A part created via the API"}}),o=y({url:u.part_list,pk:1,title:"Edit Part",fields:n}),a=S({url:u.part_attachment_list,title:"Create Attachment",fields:{part:{},attachment:{},comment:{}},initialData:{part:1},successMessage:"Attachment uploaded"}),[s,c]=l.useState(!0),[p,d]=l.useState("Hello"),j=l.useMemo(()=>{const f=n;return f.name={...f.name,value:p,onValueChange:d},f.active={...f.active,value:s,onValueChange:c},f.responsible={...f.responsible,disabled:!s},f},[p,s]),{modal:D,open:E}=S({url:u.part_list,title:"Create part",fields:j,initialData:{is_template:!0,virtual:!0,minimum_stock:10,description:"An example part description",keywords:"apple, banana, carrottt","initial_supplier.sku":"SKU-123"},preFormContent:e.jsx(x,{onClick:()=>d("Hello world"),children:'Set name="Hello world"'})}),{modal:O,open:R}=te();return e.jsxs(g,{children:[e.jsxs(_,{children:[e.jsx(x,{onClick:()=>r.open(),children:"Create New Part"}),r.modal,e.jsx(x,{onClick:()=>o.open(),children:"Edit Part"}),o.modal,e.jsx(x,{onClick:()=>R(),children:"Create Stock Item"}),O,e.jsx(x,{onClick:()=>t.open(),children:"Edit Category"}),t.modal,e.jsx(x,{onClick:()=>a.open(),children:"Create Attachment"}),a.modal,e.jsx(x,{onClick:()=>E(),children:"Create Part new Modal"}),D]}),e.jsx(Y,{sx:{padding:"30px"},children:e.jsx(K,{props:{url:u.part_list,method:"POST",fields:{active:{value:s,onValueChange:c},keywords:{disabled:!s,value:"default,test,placeholder"}}},id:"this is very unique"})})]})}function pe(){const[t,i]=l.useState("10");return e.jsx(e.Fragment,{children:e.jsxs(_,{children:[e.jsx(h,{children:"Stock Status"}),e.jsx(B,{value:t,onChange:n=>i(n.currentTarget.value)}),e.jsx(Z,{type:w.stockitem,status:t})]})})}function ue(){const[t,i]=l.useState(!1),n=oe({model:"partcategory"}),[r,o]=l.useState(0),a=S({url:u.import_session_list,title:"Create Import Session",fields:n,initialData:{parent:1},onFormSuccess:c=>{o(c.pk),i(!0)}}),s=l.useCallback(()=>{a.open()},[]);return e.jsxs(e.Fragment,{children:[a.modal,e.jsx(x,{onClick:()=>s(),children:"Open Importer"}),e.jsx(le,{sessionId:r,opened:t,onClose:()=>i(!1)})]})}function v({title:t,content:i}){return e.jsx(e.Fragment,{children:e.jsxs(C.Item,{value:`accordion-playground-${t}`,children:[e.jsx(C.Control,{children:e.jsx(h,{children:t})}),e.jsx(C.Panel,{children:i})]})})}function Ae(){return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(T,{children:e.jsx(P,{id:"0LrFTO"})}),e.jsx(X,{})]}),e.jsx(h,{children:e.jsx(P,{id:"ZLvUR5"})}),e.jsxs(C,{defaultValue:"",children:[e.jsx(v,{title:"API Forms",content:e.jsx(de,{})}),e.jsx(v,{title:"Status labels",content:e.jsx(pe,{})}),e.jsx(v,{title:"Data Import",content:e.jsx(ue,{})})]})]})}export{Ae as default};
