import{r as p,j as i,F as C,a8 as f,h as j,aH as M,aJ as R,a4 as E}from"./vendor-C5fHLTDD.js";import{A as d,i as r,M as z,l as b,j as S}from"./index-DX4YmBvQ.js";import{A as J}from"./ActionButton-seel8ZoK.js";import{T as q,S as P}from"./Instance-c0njg-mI.js";import{S as v}from"./StylishText-CD9I8-X7.js";import{a as y}from"./ApiForm-Dtyf-xF2.js";import{u as D,a as w,b as T}from"./UseForm-Btt47jru.js";import{m as L}from"./BaseContext-BGXKB9QI.js";function A({create:e=!1}){const[n,s]=p.useState(null),[t,a]=p.useState(null);return p.useMemo(()=>({part:{value:n,hidden:!e,onValueChange:l=>{s(l),a(null)}},supplier_part:{value:t,onValueChange:a,filters:{part_detail:!0,supplier_detail:!0,...n?{part:n}:{}},adjustFilters:l=>(l.data.part&&(l.filters.part=l.data.part),l.filters)},use_pack_size:{hidden:!e,description:r._({id:"qyS7x9"})},location:{hidden:!e,filters:{structural:!1}},quantity:{hidden:!e,description:r._({id:"LWFE8j"})},serial_numbers:{field_type:"string",label:r._({id:"VzQT2x"}),description:r._({id:"0dR85g"}),required:!1,hidden:!e},serial:{hidden:e},batch:{},status:{},expiry_date:{},purchase_price:{},purchase_price_currency:{},packaging:{},link:{},owner:{},delete_on_deplete:{}}),[n,t])}function ie(){const e=A({create:!0});return w({url:d.stock_item_list,fields:e,title:r._({id:"bJLEQT"})})}function ne({item_id:e,callback:n}){const s=A({create:!1});return D({url:d.stock_item_list,pk:e,fields:s,title:r._({id:"gQgYNs"}),successMessage:r._({id:"gqrPgW"}),onFormSuccess:n})}function U({stockItem:e,value:n}){console.log("item",e);const{data:s}=R({queryKey:["location",e.part_detail.default_location??e.part_detail.category_default_location],queryFn:async()=>{const t=b(d.stock_location_list,e.part_detail.default_location??e.part_detail.category_default_location);return S.get(t).then(a=>{switch(a.status){case 200:return a.data;default:return null}}).catch(()=>null)}});return i.jsxs(f,{gap:"sm",justify:"space-evenly",align:"center",children:[i.jsxs(f,{gap:"sm",direction:"column",align:"center",children:[i.jsxs(j,{children:[n," x ",e.part_detail.name]}),i.jsx(q,{src:e.part_detail.thumbnail,size:80,align:"center"})]}),i.jsxs(f,{direction:"column",gap:"sm",align:"center",children:[i.jsx(j,{children:e.location_detail.pathstring}),i.jsx(y,{icon:"arrow_down"}),i.jsx(p.Suspense,{fallback:i.jsx(E,{width:"150px"}),children:i.jsx(j,{children:s==null?void 0:s.pathstring})})]})]})}function O(e,n,s){L.openConfirmModal({title:i.jsx(v,{children:"Confirm Stock Transfer"}),children:i.jsx(U,{stockItem:e,value:n}),onConfirm:()=>{e.location===e.part_detail.default_location||e.location===e.part_detail.category_default_location||S.post(b(d.stock_transfer),{items:[{pk:e.pk,quantity:n,batch:e.batch,status:e.status}],location:e.part_detail.default_location??e.part_detail.category_default_location}).then(t=>(s(),t.data)).catch(()=>null)}})}function u({input:e,transfer:n=!1,add:s=!1,setMax:t=!1,merge:a=!1,record:o}){const l=e.item;console.log("rec",o);const[_,m]=p.useState(s?0:l.quantity??0),g=p.useCallback(h=>{m(h),e.changeFn(e.idx,"quantity",h)},[l]),k=()=>{e.removeFn(e.idx)};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs(f,{gap:"sm",align:"center",children:[i.jsx(q,{size:40,src:o.part_detail.thumbnail,align:"center"}),i.jsx("div",{children:o.part_detail.name})]})}),i.jsx("td",{children:o.location?o.location_detail.pathstring:"-"}),i.jsx("td",{children:i.jsxs(f,{align:"center",gap:"xs",children:[i.jsx(j,{children:o.quantity}),i.jsx(P,{status:o.status,type:z.stockitem})]})}),!a&&i.jsx("td",{children:i.jsx(M,{value:_,onChange:g,max:t?o.quantity:void 0,min:0,style:{maxWidth:"100px"}})}),i.jsx("td",{children:i.jsxs(f,{gap:"3px",children:[n&&i.jsx(J,{onClick:()=>O(o,_,k),icon:i.jsx(y,{icon:"default_location"}),tooltip:r._({id:"b+SPUR"}),tooltipAlignment:"top",disabled:!o.part_detail.default_location&&!o.part_detail.category_default_location}),i.jsx(J,{onClick:()=>e.removeFn(e.idx),icon:i.jsx(y,{icon:"square_x"}),tooltip:r._({id:"zMFs5V"}),tooltipAlignment:"top",color:"red"})]})})]})}function x(e){return e.map(s=>({pk:s.pk,quantity:s.quantity,batch:s.batch,status:s.status,packaging:s.packaging,obj:s}))}function G(e){if(!e)return{};const n=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:x(e),modelRenderer:t=>i.jsx(u,{input:t,transfer:!0,setMax:!0,record:n[t.item.pk]},t.item.pk),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"QWdKwH"}),r._({id:"7L01XJ"})]},location:{filters:{structural:!1}},notes:{}}}function X(e){if(!e)return{};const n=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:x(e),modelRenderer:t=>i.jsx(u,{input:t,setMax:!0,record:n[t.item.pk]},t.item.pk),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"t/YqKh"}),r._({id:"7L01XJ"})]},notes:{}}}function Q(e){if(!e)return{};const n=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:x(e),modelRenderer:t=>i.jsx(u,{input:t,add:!0,record:n[t.item.pk]},t.item.pk),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"m16xKo"}),r._({id:"7L01XJ"})]},notes:{}}}function V(e){if(!e)return{};const n=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:x(e),modelRenderer:t=>i.jsx(u,{input:t,record:n[t.item.pk]},t.item.pk),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"wBMjJ2"}),r._({id:"7L01XJ"})]},notes:{}}}function K(e){if(!e)return{};const n=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:e.map(t=>t.pk),modelRenderer:t=>i.jsx(u,{input:t,merge:!0,record:n[t.item]},t.item),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"7L01XJ"})]},status:{},note:{}}}function W(e){var t;if(!e)return{};const n=Object.fromEntries(e.map(a=>[a.pk,a]));return{items:{field_type:"table",value:e.map(a=>({item:a.pk,obj:a})),modelRenderer:a=>i.jsx(u,{input:a,merge:!0,record:n[a.item.item]},a.item.item),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"7L01XJ"})]},location:{default:(t=e[0])==null?void 0:t.part_detail.default_location,filters:{structural:!1}},notes:{},allow_mismatched_suppliers:{},allow_mismatched_status:{}}}function B(e){if(!e)return{};const n=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:e.map(t=>({item:t.pk,obj:t})),modelRenderer:t=>i.jsx(u,{input:t,merge:!0,record:n[t.item.item]},t.item.item),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"7L01XJ"})]},customer:{filters:{is_customer:!0}},notes:{}}}function N(e){if(!e)return{};const n=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:e.map(t=>t.pk),modelRenderer:t=>i.jsx(u,{input:t,merge:!0,record:n[t.item]},t.item),headers:[r._({id:"vgP+9p"}),r._({id:"wJijgU"}),r._({id:"zn38D/"}),r._({id:"7L01XJ"})]}}}function c({items:e,pk:n,model:s,refresh:t,fieldGenerator:a,endpoint:o,title:l,modalFunc:_=w}){const m={part_detail:!0,location_detail:!0,cascade:!1};m[s]=n===void 0&&s==="location"?"null":n;const{data:g}=C({queryKey:["stockitems",s,n,e],queryFn:async()=>{if(e)return Array.isArray(e)?e:[e];const h=b(d.stock_item_list);return S.get(h,{params:m}).then(F=>{if(F.status===200)return F.data}).catch(()=>null)}}),k=p.useMemo(()=>a(g),[g]);return _({url:o,fields:k,title:l,onFormSuccess:()=>t()})}function se(e){return c({...e,fieldGenerator:Q,endpoint:d.stock_add,title:r._({id:"smUxso"})})}function ae(e){return c({...e,fieldGenerator:X,endpoint:d.stock_remove,title:r._({id:"dxvf6V"})})}function oe(e){return c({...e,fieldGenerator:G,endpoint:d.stock_transfer,title:r._({id:"9efe+k"})})}function de(e){return c({...e,fieldGenerator:V,endpoint:d.stock_count,title:r._({id:"n/p2QJ"})})}function le(e){return c({...e,fieldGenerator:K,endpoint:d.stock_change_status,title:r._({id:"Y+vtBl"})})}function ue(e){return c({...e,fieldGenerator:W,endpoint:d.stock_merge,title:r._({id:"z5kN6j"})})}function ce(e){return c({...e,fieldGenerator:B,endpoint:d.stock_assign,title:"Assign Stock to Customer"})}function pe(e){return c({...e,fieldGenerator:N,endpoint:d.stock_item_list,modalFunc:T,title:r._({id:"khKVoc"})})}function fe({}){return{parent:{description:r._({id:"9P2CtI"}),required:!1},name:{},description:{},structural:{},external:{},location_type:{}}}export{A as a,oe as b,se as c,ae as d,de as e,le as f,ue as g,ce as h,pe as i,ne as j,fe as s,ie as u};
