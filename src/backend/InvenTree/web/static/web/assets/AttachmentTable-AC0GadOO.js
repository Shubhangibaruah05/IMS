import{j as s,G as x,A as w,r as h,aa as g,a1 as k,S as C,h as T,I as S}from"./vendor-C5fHLTDD.js";import{g as m,i as a,l as L,j as y,n as j}from"./index-DX4YmBvQ.js";import{a as M}from"./DetailsImage-Y3z_v9dS.js";import{I as R}from"./notifications-DM-9a7Is.js";import{n as G,o as P,p as Z,q as V,r as b}from"./ApiForm-Dtyf-xF2.js";import{I as H}from"./IconFileTypePdf-ST3WfDb7.js";import{u as O,R as U,a as W,I as X}from"./InvenTreeTable-LkhQVMZE.js";import{I as q}from"./IconExternalLink-CDh1KHXW.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var J=m("outline","file-type-csv","IconFileTypeCsv",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M7 16.5a1.5 1.5 0 0 0 -3 0v3a1.5 1.5 0 0 0 3 0",key:"svg-2"}],["path",{d:"M10 20.25c0 .414 .336 .75 .75 .75h1.25a1 1 0 0 0 1 -1v-1a1 1 0 0 0 -1 -1h-1a1 1 0 0 1 -1 -1v-1a1 1 0 0 1 1 -1h1.25a.75 .75 0 0 1 .75 .75",key:"svg-3"}],["path",{d:"M16 15l2 6l2 -6",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Q=m("outline","file-type-doc","IconFileTypeDoc",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M5 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z",key:"svg-2"}],["path",{d:"M20 16.5a1.5 1.5 0 0 0 -3 0v3a1.5 1.5 0 0 0 3 0",key:"svg-3"}],["path",{d:"M12.5 15a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1 -3 0v-3a1.5 1.5 0 0 1 1.5 -1.5z",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Y=m("outline","file-type-xls","IconFileTypeXls",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M4 15l4 6",key:"svg-2"}],["path",{d:"M4 21l4 -6",key:"svg-3"}],["path",{d:"M17 20.25c0 .414 .336 .75 .75 .75h1.25a1 1 0 0 0 1 -1v-1a1 1 0 0 0 -1 -1h-1a1 1 0 0 1 -1 -1v-1a1 1 0 0 1 1 -1h1.25a.75 .75 0 0 1 .75 .75",key:"svg-4"}],["path",{d:"M11 15v6h3",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var B=m("outline","file-type-zip","IconFileTypeZip",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M16 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6",key:"svg-2"}],["path",{d:"M12 15v6",key:"svg-3"}],["path",{d:"M5 15h3l-3 6h3",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var K=m("outline","file","IconFile",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}]]);function $(e){var n;switch(((n=e.split(".").pop())==null?void 0:n.toLowerCase())??""){case"pdf":return s.jsx(H,{size:18});case"csv":return s.jsx(J,{size:18});case"xls":case"xlsx":return s.jsx(Y,{size:18});case"doc":case"docx":return s.jsx(Q,{size:18});case"zip":case"tar":case"gz":case"7z":return s.jsx(B,{size:18});case"png":case"jpg":case"jpeg":case"gif":case"bmp":case"tif":case"webp":return s.jsx(G,{size:18});default:return s.jsx(K,{size:18})}}function z({attachment:e,external:i}){let t=i?e:e.split("/").pop();return s.jsxs(x,{position:"left",spacing:"sm",children:[i?s.jsx(R,{}):$(e),s.jsx(w,{href:e,target:"_blank",rel:"noopener noreferrer",children:t})]})}function I({endpoint:e,model:i,pk:t,attachmentType:n,callback:p}){let l={attachment:{},link:{},comment:{}};n==="link"?delete l.attachment:delete l.link,l[i]={value:t,hidden:!0};let u=n==="file"?a._({id:"8uQpHD"}):a._({id:"V4WsyL"}),d=n==="file"?a._({id:"TzSMET"}):a._({id:"GvlLvd"});P({title:u,url:e,successMessage:d,fields:l,onFormSuccess:p})}function N({endpoint:e,model:i,pk:t,attachmentType:n,callback:p}){let l={link:{},comment:{}};n==="file"&&delete l.link,l[i]={value:t,hidden:!0};let u=n==="file"?a._({id:"xtmR+6"}):a._({id:"gDx5MG"}),d=n==="file"?a._({id:"TKcCLO"}):a._({id:"AEUkAQ"});Z({title:u,url:e,pk:t,successMessage:d,fields:l,onFormSuccess:p})}function ee({endpoint:e,pk:i,callback:t}){V({url:e,pk:i,title:a._({id:"hZfPb3"}),successMessage:a._({id:"iDEbsu"}),onFormSuccess:t,fields:{},preFormWarning:a._({id:"1oL0IJ"})})}function se(){return[{accessor:"attachment",sortable:!1,switchable:!1,noWrap:!0,render:function(e){return e.attachment?s.jsx(z,{attachment:e.attachment}):e.link?s.jsx(z,{attachment:e.link,external:!0}):"-"}},{accessor:"comment",sortable:!1,render:function(e){return e.comment}},{accessor:"upload_date",sortable:!0,render:function(e){return s.jsxs(x,{position:"apart",children:[s.jsx(T,{children:e.upload_date}),e.user_detail&&s.jsx(S,{size:"xs",children:e.user_detail.username})]})}}]}function he({endpoint:e,model:i,pk:t}){const n=O(`${i}-attachments`),p=h.useMemo(()=>se(),[]),[l,u]=h.useState(!1),[d,F]=h.useState(!1),v=h.useMemo(()=>L(e),[e]),_=h.useMemo(()=>t>0,[t]);h.useEffect(()=>{y.options(v).then(o=>{var r;let c=((r=o.data)==null?void 0:r.actions)??{};return u("POST"in c),F("DELETE"in c),o}).catch(o=>o)},[]);const A=h.useCallback(o=>{let c=[];return l&&c.push(U({onClick:()=>{N({endpoint:e,model:i,pk:o.pk,attachmentType:o.attachment?"file":"link",callback:r=>{n.updateRecord(r)}})}})),d&&c.push(W({onClick:()=>{ee({endpoint:e,pk:o.pk,callback:n.refreshTable})}})),c},[l,d]);function E(o){o.forEach(c=>{let r=new FormData;r.append("attachment",c),r.append(i,t.toString()),y.post(v,r).then(f=>(j.show({title:a._({id:"FJqE4H"}),message:a._({id:"3LxYDr",values:{0:c.name}}),color:"green"}),n.refreshTable(),f)).catch(f=>(console.error("error uploading attachment:",c,"->",f),j.show({title:a._({id:"ae3dey"}),message:a._({id:"GZnmeE"}),color:"red"}),f))})}const D=h.useMemo(()=>{let o=[];return l&&(o.push(s.jsx(g,{label:a._({id:"V8euYO"}),children:s.jsx(k,{radius:"sm",onClick:()=>{I({endpoint:e,model:i,pk:t,attachmentType:"file",callback:n.refreshTable})},children:s.jsx(b,{})})},"attachment-add")),o.push(s.jsx(g,{label:a._({id:"DpV4ac"}),children:s.jsx(k,{radius:"sm",onClick:()=>{I({endpoint:e,model:i,pk:t,attachmentType:"link",callback:n.refreshTable})},children:s.jsx(q,{})})},"link-add"))),o},[l]);return s.jsxs(C,{spacing:"xs",children:[t&&t>0&&s.jsx(X,{url:v,tableState:n,columns:p,props:{noRecordsText:a._({id:"32o8IC"}),enableSelection:!0,tableActions:D,rowActions:l&&d?A:void 0,params:{[i]:t}}},"attachment-table"),l&&_&&s.jsx(M,{onDrop:E,children:s.jsx(M.Idle,{children:s.jsxs(x,{position:"center",children:[s.jsx(b,{size:24}),s.jsx(T,{size:"sm",children:a._({id:"VHmXZm"})})]})})},"attachment-dropzone")]})}export{he as A,z as a};
