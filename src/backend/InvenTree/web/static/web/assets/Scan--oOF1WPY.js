import{j as e,G as j,T as ne,ba as se,X as ie,V as K,r as f,D as G,K as $,aK as ae,bb as U,S as V,ao as ee,h as v,a1 as y,ad as Y,Y as le,J as oe,t as re,ac as ce,bc as de,W as ue,I as he,g as pe,s as L}from"./vendor-C5fHLTDD.js";import{T as d,H as Q,I as N}from"./BaseContext-BGXKB9QI.js";import{g as D,i as r,j as W,l as q,A as xe,I as fe,s as O,M as S}from"./index-DX4YmBvQ.js";import{D as me}from"./DocTooltip-BYA2RvhP.js";import{I as je}from"./IconInfoCircle-D5K91YCo.js";import{S as ge}from"./StylishText-CD9I8-X7.js";import{R as ke}from"./Instance-c0njg-mI.js";import{M as ye}from"./ModelType-C8nSW6qW.js";import{I as be,a as Ie,n as Se}from"./notifications-DM-9a7Is.js";import{I as Z}from"./IconTrash-KFql82qv.js";import{I as ve}from"./IconSearch-CKaD9XHL.js";import{I as Me}from"./IconAlertCircle-C-1MzrG3.js";import{I as we}from"./IconPlus-QsNVBJ5N.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var _e=D("outline","arrows-maximize","IconArrowsMaximize",[["path",{d:"M16 4l4 0l0 4",key:"svg-0"}],["path",{d:"M14 10l6 -6",key:"svg-1"}],["path",{d:"M8 20l-4 0l0 -4",key:"svg-2"}],["path",{d:"M4 20l6 -6",key:"svg-3"}],["path",{d:"M16 20l4 0l0 -4",key:"svg-4"}],["path",{d:"M14 14l6 6",key:"svg-5"}],["path",{d:"M8 4l-4 0l0 4",key:"svg-6"}],["path",{d:"M4 4l6 6",key:"svg-7"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ce=D("outline","arrows-minimize","IconArrowsMinimize",[["path",{d:"M5 9l4 0l0 -4",key:"svg-0"}],["path",{d:"M3 3l6 6",key:"svg-1"}],["path",{d:"M5 15l4 0l0 4",key:"svg-2"}],["path",{d:"M3 21l6 -6",key:"svg-3"}],["path",{d:"M19 9l-4 0l0 -4",key:"svg-4"}],["path",{d:"M15 9l6 -6",key:"svg-5"}],["path",{d:"M19 15l-4 0l0 4",key:"svg-6"}],["path",{d:"M15 15l6 6",key:"svg-7"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var De=D("outline","number","IconNumber",[["path",{d:"M4 17v-10l7 10v-10",key:"svg-0"}],["path",{d:"M15 17h5",key:"svg-1"}],["path",{d:"M17.5 10m-2.5 0a2.5 3 0 1 0 5 0a2.5 3 0 1 0 -5 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Fe=D("filled","player-play-filled","IconPlayerPlayFilled",[["path",{d:"M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ae=D("filled","player-stop-filled","IconPlayerStopFilled",[["path",{d:"M17 4h-10a3 3 0 0 0 -3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3 -3v-10a3 3 0 0 0 -3 -3z",key:"svg-0"}]]);function te({size:t=18,text:i,detail:o,link:a}){return e.jsx(me,{text:i,detail:o,link:a,children:e.jsx(je,{size:t})})}function X({children:t,variant:i,order:o,size:a,text:x,detail:h}){return e.jsxs(j,{children:[e.jsx(ne,{variant:i,order:o,size:a,children:t}),x&&e.jsx(te,{text:x,detail:h})]})}function ze(t){return t!=null&&t.part?[S.part,t==null?void 0:t.part.pk]:t!=null&&t.stockitem?[S.stockitem,t==null?void 0:t.stockitem.pk]:t!=null&&t.stocklocation?[S.stocklocation,t==null?void 0:t.stocklocation.pk]:t!=null&&t.supplierpart?[S.supplierpart,t==null?void 0:t.supplierpart.pk]:t!=null&&t.purchaseorder?[S.purchaseorder,t==null?void 0:t.purchaseorder.pk]:t!=null&&t.salesorder?[S.salesorder,t==null?void 0:t.salesorder.pk]:t!=null&&t.build?[S.build,t==null?void 0:t.build.pk]:[void 0,void 0]}function Ye(){var k;const{toggle:t,fullscreen:i}=se(),[o,a]=ie([]),[x,h]=K({key:"scan-history",defaultValue:[]}),[s,c]=f.useState([]),[b,g]=K({key:"input-selection",defaultValue:null});function F(){const l=I(s[0]);l&&w(l==null?void 0:l.ref,l==null?void 0:l.id)}const A=s.length===1&&((k=I(s[0]))==null?void 0:k.link)!=null;function z(){const l=I(s[0]);l&&A&&window.open(l.link,"_blank")}function M(){a.setState([]),h([]),c([])}function R(){a.setState(o.filter(l=>!s.includes(l.id))),c([])}function I(l){if(s.length===0)return;const u=o.find(m=>m.id===l);if((u==null?void 0:u.ref)!==void 0)return u}function w(l,u){W.post(q(xe.barcode),{barcode:l}).then(m=>{var C;if(!u)return;const p=I(s[0]);if(!p)return;p.link=(C=m.data)==null?void 0:C.url;const _=ze(m.data);if(p.model=_[0],p.pk=_[1],p.model&&p.pk){let B=ye[p.model];if(B&&B.api_endpoint){let J=q(B.api_endpoint,p.pk);W.get(J).then(P=>{p.instance=P.data}).catch(P=>{console.error("error while fetching instance data at",J),console.info(P)})}}a.setState(o)}).catch(m=>{var p,_,C;((p=m.response)==null?void 0:p.status)===400&&((C=(_=m.response)==null?void 0:_.data)==null?void 0:C.plugin)==="None"||console.log("error while running barcode",m)})}function T(l){for(const u of l)a.append(u),w(u.ref,u.id);c(l.map(u=>u.id))}f.useEffect(()=>{o.length!==0&&h(o)},[o]),o.length===0&&x.length!=0&&a.setState(x);const E=[{value:"manually",label:r._({id:"pS7MTY"})},{value:"imageBarcode",label:r._({id:"29Om2/"})}],H=function(){switch(b){case"manually":return e.jsx(Te,{action:T});case"imageBarcode":return e.jsx(Ee,{action:T});default:return e.jsx(v,{children:"No input selected"})}}(),n=()=>{const l=[...new Set(s.map(u=>{var m;return(m=o.find(p=>p.id===u))==null?void 0:m.model}).filter(u=>u!=null))];return l.length===0?e.jsxs(j,{spacing:0,children:[e.jsx(Ie,{color:"orange"}),e.jsx(d,{id:"dQStih"})]}):l.length>1?e.jsxs(j,{spacing:0,children:[e.jsx(Me,{color:"orange"}),e.jsx(d,{id:"Oik3bo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{fz:"sm",c:"dimmed",children:e.jsx(d,{id:"RlLl3G",values:{0:l[0]}})}),e.jsx(j,{children:e.jsx(y,{onClick:Se,title:r._({id:"wBMjJ2"}),children:e.jsx(De,{})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{position:"apart",children:[e.jsxs(j,{position:"left",children:[e.jsx(ge,{children:e.jsx(d,{id:"T2Wq4D"})}),e.jsx(te,{text:r._({id:"cXiEKg"})})]}),e.jsx(G,{onClick:t,size:"sm",variant:"subtle",children:i?e.jsx(_e,{}):e.jsx(Ce,{})})]}),e.jsx($,{h:"md"}),e.jsxs(ae,{maw:"100%",children:[e.jsx(U,{span:4,children:e.jsxs(V,{children:[e.jsxs(V,{spacing:"xs",children:[e.jsxs(j,{position:"apart",children:[e.jsx(X,{order:3,text:r._({id:"qBZttg"}),children:e.jsx(d,{id:"XU5AOg"})}),e.jsx(ee,{value:b,onChange:g,data:E,searchable:!0,placeholder:r._({id:"kY/87m"}),nothingFound:r._({id:"ow3fug"})})]}),H]}),e.jsxs(V,{spacing:0,children:[e.jsx(X,{order:3,text:r._({id:"66J/c0"}),children:e.jsx(d,{id:"bwRvnp"})}),s.length===0?e.jsx(v,{children:e.jsx(d,{id:"bX1aQ5"})}):e.jsxs(e.Fragment,{children:[e.jsx(v,{children:e.jsx(d,{id:"sQhVFe",values:{0:s.length}})}),e.jsx(v,{fz:"sm",c:"dimmed",children:e.jsx(d,{id:"U+sonC"})}),e.jsxs(j,{children:[e.jsx(y,{color:"red",onClick:R,title:r._({id:"cnGeoo"}),children:e.jsx(Z,{})}),e.jsx(y,{onClick:F,disabled:s.length>1,title:r._({id:"H8H7u6"}),children:e.jsx(ve,{})}),e.jsx(y,{onClick:z,disabled:!A,title:r._({id:"sliuzR"}),children:e.jsx(be,{})})]}),e.jsx(n,{})]})]})]})}),e.jsxs(U,{span:8,children:[e.jsxs(j,{position:"apart",children:[e.jsx(X,{order:3,text:r._({id:"mM7dgZ"}),detail:r._({id:"s9lCxX"}),children:e.jsx(d,{id:"0caMy7"})}),e.jsx(y,{color:"red",onClick:M,children:e.jsx(Z,{})})]}),e.jsx(Re,{data:o,selection:s,setSelection:c})]})]})]})}function Re({data:t,selection:i,setSelection:o}){const a=s=>o(c=>c.includes(s)?c.filter(b=>b!==s):[...c,s]),x=()=>o(s=>s.length===t.length?[]:t.map(c=>c.id)),h=t.map(s=>{var c;return i.includes(s.id),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Y,{checked:i.includes(s.id),onChange:()=>a(s.id),transitionDuration:0})}),e.jsx("td",{children:s.pk&&s.model&&s.instance?e.jsx(ke,{model:s.model,instance:s.instance}):s.ref}),e.jsx("td",{children:s.model}),e.jsx("td",{children:s.source}),e.jsx("td",{children:(c=s.timestamp)==null?void 0:c.toString()})]},s.id)});return t.length===0?e.jsx(v,{children:e.jsx(d,{id:"nB43gC"})}):e.jsx(le,{children:e.jsxs(oe,{miw:800,verticalSpacing:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:re(40)},children:e.jsx(Y,{onChange:x,checked:i.length===t.length,indeterminate:i.length>0&&i.length!==t.length,transitionDuration:0})}),e.jsx("th",{children:e.jsx(d,{id:"HX5SVx"})}),e.jsx("th",{children:e.jsx(d,{id:"+zy2Nq"})}),e.jsx("th",{children:e.jsx(d,{id:"wdxz7K"})}),e.jsx("th",{children:e.jsx(d,{id:"PvB8gr"})})]})}),e.jsx("tbody",{children:h})]})})}function Te({action:t}){const[i,o]=f.useState("");function a(){if(i==="")return;const h={id:L(),ref:i,data:{item:i},timestamp:new Date,source:"manually"};t([h]),o("")}function x(){const h={id:L(),ref:"Test item",data:{},timestamp:new Date,source:"manually"};t([h])}return e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsx(ce,{placeholder:r._({id:"mPrJo6"}),value:i,onChange:h=>o(h.currentTarget.value),onKeyDown:de([["Enter",a]])}),e.jsx(y,{onClick:a,w:16,children:e.jsx(we,{})})]}),fe&&e.jsx(G,{onClick:x,variant:"outline",children:e.jsx(d,{id:"gUm1Y0"})})]})}function Ee({action:t}){const[i,o]=f.useState(null),[a,x]=K({key:"camId",defaultValue:null}),[h,s]=f.useState([]),[c,b]=f.useState(null),[g,F]=f.useState(!1),[A,z]=f.useState(!1),M=ue();let R="";f.useEffect(()=>{o(new Q("reader")),Q.getCameras().then(n=>{n!=null&&n.length&&s(n)})},[]),f.useEffect(()=>{a&&b(a.id)},[a]),f.useEffect(()=>{g&&M==="hidden"?(H(),z(!0)):A&&M==="visible"&&(E(),z(!1))},[M]);function I(n){if(i==null||i.pause(),n===R){i==null||i.resume();return}R=n,t([{id:L(),ref:n,data:n,timestamp:new Date,source:"imageBarcode"}]),i==null||i.resume()}function w(n){n!="QR code parse error, error = NotFoundException: No MultiFormat Readers were able to detect the code."&&console.warn(`Code scan error = ${n}`)}function T(){Q.getCameras().then(n=>{n!=null&&n.length&&x(n[0])}).catch(n=>{O({title:r._({id:"UHot+L"}),message:n,color:"red",icon:e.jsx(N,{})})})}function E(){a&&i&&!g&&(i.start(a.id,{fps:10,qrbox:{width:250,height:250}},n=>{I(n)},n=>{w(n)}).catch(n=>{O({title:r._({id:"bR26mb"}),message:n,color:"red",icon:e.jsx(N,{})})}),F(!0))}function H(){i&&g&&(i.stop().catch(n=>{O({title:r._({id:"fvJQqd"}),message:n,color:"red",icon:e.jsx(N,{})})}),F(!1))}return f.useEffect(()=>{if(c===null)return;if(c===(a==null?void 0:a.id)){console.log("matching value and id");return}const n=h.find(k=>k.id===c);i&&g?i.stop().then(()=>{x(n),i.start(n.id,{fps:10,qrbox:{width:250,height:250}},k=>{I(k)},k=>{w(k)})}):x(n)},[c]),e.jsxs(V,{spacing:"xs",children:[e.jsxs(j,{spacing:"xs",children:[e.jsx(ee,{value:c,onChange:b,data:h.map(n=>({value:n.id,label:n.label})),size:"sm"}),g?e.jsx(y,{onClick:H,title:r._({id:"yFRXH8"}),children:e.jsx(Ae,{})}):e.jsx(y,{onClick:E,title:r._({id:"m3BKG+"}),disabled:!a,children:e.jsx(Fe,{})}),e.jsx($,{sx:{flex:1}}),e.jsx(he,{color:g?"green":"orange",children:g?r._({id:"CMQ09J"}):r._({id:"Fg9r/3"})})]}),e.jsx(pe,{px:0,id:"reader",w:"100%",mih:"300px"}),!a&&e.jsx(G,{onClick:T,children:e.jsx(d,{id:"QuNKRX"})})]})}export{Ye as default};
