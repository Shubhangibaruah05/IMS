import{F as q,r as s,j as e,aU as B,G as R,aa as G,a1 as Q,a4 as H,h as D,S as X,z as Y}from"./vendor-C5fHLTDD.js";import{a as A,A as k,i as a,U as T,l as S,M as P,j as $}from"./index-DX4YmBvQ.js";import{I as z,D as w}from"./ItemDetails-DTEWr5C0.js";import{A as W,E as J}from"./ActionDropdown-C-AjyTLr.js";import{P as V}from"./PageDetail-BwkjpKwR.js";import{P as ee}from"./PanelGroup-CWuySmV8.js";import{P as te}from"./PartCategoryTree-DYz_97uS.js";import{p as F}from"./PartForms-FGG79plz.js";import{u as N,I as E,c as ae,g as K,R as re}from"./InvenTreeTable-LkhQVMZE.js";import{a as Z,u as M}from"./UseForm-Btt47jru.js";import{u as se}from"./UseInstance-rwUPjJ4i.js";import{Y as L}from"./YesNoButton-DIAHIY63.js";import{P as oe,D as O,e as ie}from"./ColumnRenderers-Dz-jxqgo.js";import{I as ne}from"./IconEdit-DwKL16RF.js";import{A as le}from"./AddItemButton-BjrbTsCx.js";import{u as ce,d as pe}from"./DesktopAppView-DlNUv0Ur.js";import{P as de}from"./PartTable-9dbqLQIq.js";import{h as me,z as ue}from"./ApiForm-Dtyf-xF2.js";import{I as fe}from"./IconInfoCircle-D5K91YCo.js";import{I as _e}from"./IconCategory-DjtaS4XP.js";import{I as be}from"./IconListDetails-DXQ95UwH.js";import"./ProgressBar-BhbAlmdB.js";import"./StylishText-CD9I8-X7.js";import"./ModelType-C8nSW6qW.js";import"./Instance-c0njg-mI.js";import"./notifications-DM-9a7Is.js";import"./IconQrcode-DcoHpd2K.js";import"./IconTrash-KFql82qv.js";import"./BaseContext-BGXKB9QI.js";import"./Placeholder-C1-1kY0o.js";import"./index.es-RSVDxQs2.js";import"./IconChevronDown-DoPmRmuk.js";import"./ActionButton-seel8ZoK.js";import"./IconSearch-CKaD9XHL.js";import"./IconRefresh-ClXNAr2V.js";import"./IconPlus-QsNVBJ5N.js";import"./IconExternalLink-CDh1KHXW.js";function xe({record:c,template:r,canEdit:p,onEdit:m}){var h;const{hovered:b,ref:t}=B();let i=(h=c.parameters)==null?void 0:h.find(f=>f.template==r.pk),u=[],g=i==null?void 0:i.data;r!=null&&r.checkbox&&g!=null&&(g=e.jsx(L,{value:i.data})),r.units&&i&&i.data_numeric&&i.data_numeric!=i.data&&u.push(`${i.data_numeric} [${r.units}]`);const x=s.useCallback(f=>{ae(f),m()},[]);return e.jsx("div",{children:e.jsxs(R,{grow:!0,ref:t,position:"apart",children:[e.jsx(R,{grow:!0,style:{flex:1},children:e.jsx(ie,{value:g??"-",extra:u,title:a._({id:"Y0ne3N"})})}),b&&p&&e.jsx("div",{style:{flex:0},children:e.jsx(G,{label:a._({id:"T4+0qy"}),children:e.jsx(Q,{size:"xs",onClick:x,children:e.jsx(ne,{})})})})]})})}function ge({categoryId:c}){const r=N("parametric-parts"),p=A(),m=q({queryKey:["category-parameters",c],queryFn:async()=>$.get(S(k.part_parameter_template_list),{params:{category:c}}).then(l=>l.data).catch(l=>[]),refetchOnMount:!0}),[b,t]=s.useState(0),[i,u]=s.useState(0),[g,x]=s.useState(0),h=s.useMemo(()=>({part:{disabled:!0},template:{disabled:!0},data:{}}),[]),f=Z({url:k.part_parameter_list,title:a._({id:"iwRvX8"}),fields:h,onFormSuccess:l=>{y(b,l)},initialData:{part:b,template:i}}),n=M({url:k.part_parameter_list,title:a._({id:"ZqLOh/"}),pk:g,fields:h,onFormSuccess:l=>{y(b,l)}}),y=s.useCallback((l,o)=>{let d=r.records,_=d.findIndex(j=>j.pk==l);if(_<0){r.refreshTable();return}let C=d[_].parameters.findIndex(j=>j.pk==o.pk);C<0?d[_].parameters.push(o):d[_].parameters[C]=o,r.setRecords(d)},[r.records]),I=s.useMemo(()=>(m.data??[]).map(o=>{let d=o.name;return o.units&&(d+=` [${o.units}]`),{accessor:`parameter_${o.pk}`,title:d,sortable:!0,extra:{template:o.pk},render:_=>e.jsx(xe,{record:_,template:o,canEdit:p.hasChangeRole(T.part),onEdit:()=>{var j;u(o.pk),t(_.pk);let C=(j=_.parameters)==null?void 0:j.find(v=>v.template==o.pk);C?(x(C.pk),n.open()):f.open()}})}}),[p,m.data]),U=s.useMemo(()=>[...[{accessor:"name",sortable:!0,switchable:!1,noWrap:!0,render:o=>oe(o)},O({}),{accessor:"IPN",sortable:!0}],...I],[I]);return s.useCallback((l,o)=>{var C,j;let d=(C=o==null?void 0:o.extra)==null?void 0:C.template;if(!d)return;t(l.pk),u(d);let _=(j=l==null?void 0:l.parameters)==null?void 0:j.find(v=>v.template==d);_?(x(_.pk),n.open()):f.open()},[p]),e.jsxs(e.Fragment,{children:[f.modal,n.modal,e.jsx(E,{url:S(k.part_list),tableState:r,columns:U,props:{enableDownload:!1,params:{category:c,cascade:!0,category_detail:!0,parameters:!0},modelType:P.part}})]})}function he({parentId:c}){const r=ce(),p=N("partcategory"),m=A(),b=s.useMemo(()=>[{accessor:"name",sortable:!0,switchable:!1},O({}),{accessor:"pathstring",sortable:!1},{accessor:"structural",sortable:!0,render:n=>e.jsx(L,{value:n.structural})},{accessor:"part_count",sortable:!0}],[]),t=s.useMemo(()=>[{name:"cascade",label:a._({id:"NgZniC"}),description:a._({id:"Tt3/Pp"})},{name:"structural",label:a._({id:"PRKZBP"}),description:a._({id:"kHkg2b"})}],[]),i=Z({url:k.category_list,title:a._({id:"sIMwJx"}),fields:F({}),initialData:{parent:c},onFormSuccess(n){n.pk?r(K(P.partcategory,n.pk)):p.refreshTable()}}),[u,g]=s.useState(-1),x=M({url:k.category_list,pk:u,title:a._({id:"7fjpj0"}),fields:F({}),onFormSuccess:n=>p.updateRecord(n)}),h=s.useMemo(()=>{let n=m.hasAddRole(T.part_category);return[e.jsx(le,{tooltip:a._({id:"5LuNgu"}),onClick:()=>i.open(),hidden:!n})]},[m]),f=s.useCallback(n=>{let y=m.hasChangeRole(T.part_category);return[re({hidden:!y,onClick:()=>{g(n.pk),x.open()}})]},[m]);return e.jsxs(e.Fragment,{children:[i.modal,x.modal,e.jsx(E,{url:S(k.category_list),tableState:p,columns:b,props:{enableDownload:!0,params:{parent:c},tableFilters:t,tableActions:h,rowActions:f,modelType:P.partcategory}})]})}function rt({}){const{id:c}=pe(),r=s.useMemo(()=>isNaN(parseInt(c||""))?void 0:c,[c]),p=A(),[m,b]=s.useState(!1),{instance:t,refreshInstance:i,instanceQuery:u}=se({endpoint:k.category_list,hasPrimaryKey:!0,pk:r,params:{path_detail:!0}}),g=s.useMemo(()=>{if(r&&u.isFetching)return e.jsx(H,{});let y=[{type:"text",name:"name",label:a._({id:"6YtxFj"}),copy:!0},{type:"text",name:"pathstring",label:a._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!r},{type:"text",name:"description",label:a._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:a._({id:"o8hZ41"}),model:P.partcategory,hidden:!(t!=null&&t.parent)}],I=[{type:"text",name:"part_count",label:a._({id:"pmRbKZ"}),icon:"part"},{type:"text",name:"subcategories",label:a._({id:"7lonqg"}),icon:"sitemap",hidden:!(t!=null&&t.subcategories)},{type:"boolean",name:"structural",label:a._({id:"PRKZBP"}),icon:"sitemap"},{type:"link",name:"parent_default_location",label:a._({id:"XLVNTv"}),model:P.stocklocation,hidden:!t.parent_default_location||t.default_location},{type:"link",name:"default_location",label:a._({id:"QC5Msb"}),model:P.stocklocation,hidden:!t.default_location}];return e.jsxs(z,{children:[r&&(t!=null&&t.pk)?e.jsx(w,{item:t,fields:y}):e.jsx(D,{children:a._({id:"PFKWrQ"})}),r&&(t==null?void 0:t.pk)&&e.jsx(w,{item:t,fields:I})]})},[t,u]),x=M({url:k.category_list,pk:r,title:a._({id:"7fjpj0"}),fields:F({}),onFormSuccess:i}),h=s.useMemo(()=>[e.jsx(W,{tooltip:a._({id:"O/o81A"}),icon:e.jsx(me,{}),actions:[J({hidden:!r||!p.hasChangeRole(T.part_category),tooltip:a._({id:"7fjpj0"}),onClick:()=>x.open()})]},"category")],[r,p]),f=s.useMemo(()=>[{name:"details",label:a._({id:"wp9B4i"}),icon:e.jsx(fe,{}),content:g},{name:"parts",label:a._({id:"pmRbKZ"}),icon:e.jsx(_e,{}),content:e.jsx(de,{props:{params:{category:r}}})},{name:"subcategories",label:a._({id:"2GkbLI"}),icon:e.jsx(ue,{}),content:e.jsx(he,{parentId:r})},{name:"parameters",label:a._({id:"TxrNvj"}),icon:e.jsx(be,{}),content:e.jsx(ge,{categoryId:r})}],[t,r]),n=s.useMemo(()=>[{name:a._({id:"pmRbKZ"}),url:"/part"},...(t.path??[]).map(y=>({name:y.name,url:K(P.partcategory,y.pk)}))],[t]);return e.jsxs(e.Fragment,{children:[x.modal,e.jsxs(X,{spacing:"xs",children:[e.jsx(Y,{visible:u.isFetching}),e.jsx(te,{opened:m,onClose:()=>{b(!1)},selectedCategory:t==null?void 0:t.pk}),e.jsx(V,{title:a._({id:"QXANxH"}),detail:e.jsx(D,{children:t.name??"Top level"}),breadcrumbs:n,breadcrumbAction:()=>{b(!0)},actions:h}),e.jsx(ee,{pageKey:"partcategory",panels:f})]})]})}export{rt as default};
