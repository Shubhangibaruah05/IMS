import{r as o,j as s,F as ee,G as S,h as Q,aa as L,I as V,a4 as z,aK as G,S as te,z as se,a9 as ae}from"./vendor-C5fHLTDD.js";import{g as F,a as U,M as p,l as A,A as _,i as t,j as J,s as O,U as T}from"./index-DX4YmBvQ.js";import{I as ie,D as B}from"./ItemDetails-DTEWr5C0.js";import{D as le}from"./DetailsImage-Y3z_v9dS.js";import{B as oe,V as ne,L as re,U as de,A as W,E as ce,D as pe}from"./ActionDropdown-C-AjyTLr.js";import{P as me}from"./PageDetail-BwkjpKwR.js";import{P as ue}from"./PanelGroup-CWuySmV8.js";import{S as _e}from"./StockLocationTree-BJuCfroG.js";import{N as he}from"./MarkdownEditor-CY0oiYAG.js";import{j as ke,e as be,c as xe,d as fe,b as je}from"./StockForms-yHG_9MvM.js";import{N as ge,z as ve,f as ye,g as Ie,I as Me,a as R,h as Se}from"./ApiForm-Dtyf-xF2.js";import{u as Z,I as X,R as Te,a as Ae,d as we,Z as Ce,g as Pe}from"./InvenTreeTable-LkhQVMZE.js";import{u as De}from"./UseInstance-rwUPjJ4i.js";import{a as qe,A as Ee}from"./AttachmentTable-AC0GadOO.js";import{P as Be,S as Re,D as Fe,N as Ke,r as N}from"./ColumnRenderers-Dz-jxqgo.js";import{S as ze}from"./StockItemTable-DiLjDthM.js";import{A as Ge}from"./AddItemButton-BjrbTsCx.js";import{P as Ne}from"./YesNoButton-DIAHIY63.js";import{d as Ue}from"./Instance-c0njg-mI.js";import{a as Ye,u as He,b as Le}from"./UseForm-Btt47jru.js";import{I as $}from"./IconInfoCircle-D5K91YCo.js";import{I as Ve}from"./IconCircleCheck-CZpHYTUf.js";import{d as Je}from"./DesktopAppView-DlNUv0Ur.js";import{b as Oe}from"./BaseContext-BGXKB9QI.js";import"./ProgressBar-BhbAlmdB.js";import"./StylishText-CD9I8-X7.js";import"./ModelType-C8nSW6qW.js";import"./index-DtVngfXu.js";import"./ActionButton-seel8ZoK.js";import"./notifications-DM-9a7Is.js";import"./IconQrcode-DcoHpd2K.js";import"./IconEdit-DwKL16RF.js";import"./IconTrash-KFql82qv.js";import"./Placeholder-C1-1kY0o.js";import"./index.es-RSVDxQs2.js";import"./IconChevronDown-DoPmRmuk.js";import"./IconExternalLink-CDh1KHXW.js";import"./IconSearch-CKaD9XHL.js";import"./IconRefresh-ClXNAr2V.js";import"./IconFileTypePdf-ST3WfDb7.js";import"./IconPlus-QsNVBJ5N.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var We=F("outline","bookmark","IconBookmark",[["path",{d:"M18 7v14l-6 -4l-6 4v-14a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qe=F("outline","box-padding","IconBoxPadding",[["path",{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M8 16v.01",key:"svg-1"}],["path",{d:"M8 12v.01",key:"svg-2"}],["path",{d:"M8 8v.01",key:"svg-3"}],["path",{d:"M16 16v.01",key:"svg-4"}],["path",{d:"M16 12v.01",key:"svg-5"}],["path",{d:"M16 8v.01",key:"svg-6"}],["path",{d:"M12 8v.01",key:"svg-7"}],["path",{d:"M12 16v.01",key:"svg-8"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ze=F("outline","checklist","IconChecklist",[["path",{d:"M9.615 20h-2.615a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8",key:"svg-0"}],["path",{d:"M14 19l2 2l4 -4",key:"svg-1"}],["path",{d:"M9 8h4",key:"svg-2"}],["path",{d:"M9 12h2",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xe=F("outline","history","IconHistory",[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]]);function $e({parentId:r}){const n=Z("stock_item_install"),h=U(),m=o.useMemo(()=>[{accessor:"part",switchable:!1,render:d=>Be(d==null?void 0:d.part_detail)},{accessor:"quantity",switchable:!1,render:d=>{let k=d.quantity;return d.serial&&d.quantity==1&&(k=`# ${d.serial}`),k}},{accessor:"batch",switchable:!1},Re(p.stockitem)],[]),e=o.useMemo(()=>[],[h]);return s.jsx(s.Fragment,{children:s.jsx(X,{url:A(_.stock_item_list),tableState:n,columns:m,props:{tableActions:e,modelType:p.stockitem,params:{belongs_to:r,part_detail:!0}}})})}function et({partId:r,itemId:n}){const h=U(),m=Z("stocktests"),{data:e}=ee({queryKey:["stocktesttemplates",r,n],queryFn:async()=>r?J.get(A(_.part_test_template_list),{params:{part:r,include_inherited:!0,enabled:!0}}).then(a=>a.data).catch(a=>[]):[]});o.useEffect(()=>{m.refreshTable()},[e]);const d=o.useCallback(a=>{let i=e.map(l=>({...l,templateId:l.pk,results:[]}));return a.forEach(l=>{i.find(c=>c.templateId==l.template)||i.push({...l.template_detail,templateId:l.template,results:[]})}),a.sort((l,c)=>l.pk>c.pk?1:-1).forEach(l=>{let c=i.findIndex(f=>f.templateId==l.template);c>=0&&(i[c]={...i[c],...l},i[c].results.push(l))}),i},[r,n,e]),k=o.useMemo(()=>[{accessor:"test",title:t._({id:"NnH3pK"}),switchable:!1,sortable:!0,render:a=>{var f,I,M;let i=a.required??((f=a.template_detail)==null?void 0:f.required),l=a.enabled??((I=a.template_detail)==null?void 0:I.enabled),c=a.stock_item!=null&&a.stock_item!=n;return s.jsxs(S,{position:"apart",children:[s.jsxs(Q,{italic:c,fw:i&&700,color:l?void 0:"red",children:[!a.templateId&&"- ",a.test_name??((M=a.template_detail)==null?void 0:M.test_name)]}),s.jsxs(S,{position:"right",children:[a.results&&a.results.length>1&&s.jsx(L,{label:t._({id:"isbwWo"}),children:s.jsx(V,{color:"lightblue",variant:"filled",children:a.results.length})}),c&&s.jsx(L,{label:t._({id:"yd1WJ/"}),children:s.jsx($,{size:16,color:"blue"})})]})]})}},{accessor:"result",title:t._({id:"RD6AE9"}),switchable:!1,sortable:!0,render:a=>a.result===void 0?s.jsx(V,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}):s.jsx(Ne,{value:a.result})},Fe({accessor:"description"}),{accessor:"value",title:t._({id:"wMHvYH"})},{accessor:"attachment",title:t._({id:"UY1vmE"}),render:a=>a.attachment&&s.jsx(qe,{attachment:a.attachment})},Ke(),{accessor:"date",sortable:!0,title:t._({id:"mYGY3B"}),render:a=>s.jsxs(S,{position:"apart",children:[N(a.date),a.user_detail&&s.jsx(Ue,{instance:a.user_detail})]})},{accessor:"test_station",sortable:!0,title:t._({id:"18Lf3c"})},{accessor:"started_datetime",sortable:!0,title:t._({id:"JEGlfK"}),render:a=>s.jsx(S,{position:"apart",children:N(a.started_datetime,{showTime:!0,showSeconds:!0})})},{accessor:"finished_datetime",sortable:!0,title:t._({id:"4dQFvz"}),render:a=>s.jsx(S,{position:"apart",children:N(a.finished_datetime,{showTime:!0,showSeconds:!0})})}],[n]),w=o.useMemo(()=>({template:{filters:{include_inherited:!0,part:r}},result:{},value:{},attachment:{},notes:{},test_station:{},started_datetime:{},finished_datetime:{},stock_item:{value:n,hidden:!0}}),[r,n]),[K,C]=o.useState(void 0),j=Ye({url:_.stock_test_result_list,fields:w,initialData:{template:K,result:!0},title:t._({id:"VzkBcq"}),onFormSuccess:()=>m.refreshTable(),successMessage:t._({id:"VivtT0"})}),[x,g]=o.useState(void 0),v=He({url:_.stock_test_result_list,pk:x,fields:w,title:t._({id:"1HKt5e"}),onFormSuccess:()=>m.refreshTable(),successMessage:t._({id:"G0v/SO"})}),y=Le({url:_.stock_test_result_list,pk:x,title:t._({id:"381PhV"}),onFormSuccess:()=>m.refreshTable(),successMessage:t._({id:"xbuMqN"})}),P=o.useCallback(a=>{J.post(A(_.stock_test_result_list),{template:a,stock_item:n,result:!0}).then(()=>{m.refreshTable(),O({title:t._({id:"uUlW4e"}),message:t._({id:"uiR3yF"}),color:"green"})}).catch(()=>{O({title:t._({id:"SlfejT"}),message:t._({id:"VjER3N"}),color:"red"})})},[n]),D=o.useCallback(a=>a.stock_item!=null&&a.stock_item!=n?[]:[{title:t._({id:"up/ozE"}),color:"green",icon:s.jsx(Ve,{}),hidden:!a.templateId||(a==null?void 0:a.requires_attachment)||(a==null?void 0:a.requires_value)||a.result,onClick:()=>P(a.templateId)},{title:t._({id:"m16xKo"}),tooltip:t._({id:"VzkBcq"}),color:"green",icon:s.jsx(ge,{}),hidden:!h.hasAddRole(T.stock)||!a.templateId,onClick:()=>{C(a.templateId),j.open()}},Te({tooltip:t._({id:"1HKt5e"}),hidden:!h.hasChangeRole(T.stock)||!a.template_detail,onClick:()=>{g(a.pk),v.open()}}),Ae({tooltip:t._({id:"381PhV"}),hidden:!h.hasDeleteRole(T.stock)||!a.template_detail,onClick:()=>{g(a.pk),y.open()}})],[h,n]),q=o.useMemo(()=>[{name:"required",label:t._({id:"TMLAx2"}),description:t._({id:"sKK8za"})},{name:"include_installed",label:t._({id:"TD72EF"}),description:t._({id:"BYeSw1"})},{name:"result",label:t._({id:"nqMwPi"}),description:t._({id:"bcwRe2"})}],[]),E=o.useMemo(()=>[s.jsx(Ge,{tooltip:t._({id:"VzkBcq"}),onClick:()=>{C(void 0),j.open()},hidden:!h.hasAddRole(T.stock)})],[h]),u=o.useMemo(()=>{const a=[...k,{accessor:"actions",title:"  ",hidden:!1,switchable:!1,width:50,render:i=>s.jsx(we,{actions:D(i)??[]})}];return{allowMultiple:!0,content:({record:i})=>{if(!i||!i.results||i.results.length<2)return null;const l=(i==null?void 0:i.results)??[];return s.jsx(Ce,{noHeader:!0,columns:a,records:l.slice(0,-1)},i.pk)}}},[]);return s.jsxs(s.Fragment,{children:[j.modal,v.modal,y.modal,s.jsx(X,{url:A(_.stock_test_result_list),tableState:m,columns:k,props:{dataFormatter:d,enablePagination:!1,tableActions:E,tableFilters:q,rowActions:D,rowExpansion:u,params:{stock_item:n,user_detail:!0,attachment_detail:!0,template_detail:!0,enabled:!0}}})]})}function Ut(){var q,E;const{id:r}=Je(),n=U(),[h,m]=o.useState(!1),{instance:e,refreshInstance:d,instanceQuery:k}=De({endpoint:_.stock_item_list,pk:r,params:{part_detail:!0,location_detail:!0,path_detail:!0}}),w=o.useMemo(()=>{var I,M;let u=e,a=(e==null?void 0:e.part_detail)??{};if(u.available_stock=Math.max(0,u.quantity-u.allocated),k.isFetching)return s.jsx(z,{});let i=[{name:"part",label:t._({id:"mY+KgP"}),type:"link",model:p.part},{name:"status",type:"status",label:t._({id:"Y3/0dR"}),model:p.stockitem},{type:"text",name:"tests",label:"Completed Tests",icon:"progress",hidden:!(a!=null&&a.trackable)},{type:"text",name:"updated",icon:"calendar",label:t._({id:"K7P0jz"})},{type:"text",name:"stocktake",icon:"calendar",label:t._({id:"whZ7zT"}),hidden:!e.stocktake}],l=[{type:"text",name:"quantity",label:t._({id:"VbWX2u"})},{type:"text",name:"serial",label:t._({id:"AXeJt4"}),hidden:!e.serial},{type:"text",name:"available_stock",label:t._({id:"csDS2L"}),icon:"quantity"}],c=[{name:"supplier_part",label:t._({id:"nne72x"}),type:"link",model:p.supplierpart,hidden:!e.supplier_part},{type:"link",name:"location",label:t._({id:"wJijgU"}),model:p.stocklocation,hidden:!e.location},{type:"link",name:"belongs_to",label:t._({id:"QPoAhl"}),model_formatter:b=>{var H;let Y=((H=b==null?void 0:b.part_detail)==null?void 0:H.full_name)??(b==null?void 0:b.name);return b.serial&&b.quantity==1&&(Y+=`# ${b.serial}`),Y},icon:"stock",model:p.stockitem,hidden:!e.belongs_to},{type:"link",name:"consumed_by",label:t._({id:"H00rnl"}),model:p.build,hidden:!e.consumed_by,icon:"build",model_field:"reference"},{type:"link",name:"build",label:t._({id:"YxwWvi"}),model:p.build,hidden:!e.build,model_field:"reference"},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),model:p.salesorder,hidden:!e.sales_order,icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",label:t._({id:"876pfE"}),model:p.company,hidden:!e.customer}],f=[{type:"text",name:"packaging",icon:"part",label:t._({id:"pD/Ew0"}),hidden:!e.packaging}];return s.jsxs(ie,{children:[s.jsxs(G,{children:[s.jsx(G.Col,{span:4,children:s.jsx(le,{appRole:T.part,apiPath:_.part_list,src:((I=e.part_detail)==null?void 0:I.image)??((M=e==null?void 0:e.part_detail)==null?void 0:M.thumbnail),pk:e.part})}),s.jsx(G.Col,{span:8,children:s.jsx(B,{fields:i,item:e})})]}),s.jsx(B,{fields:l,item:e}),s.jsx(B,{fields:c,item:e}),s.jsx(B,{fields:f,item:e})]})},[e,k]),K=o.useMemo(()=>{var u,a,i,l;return[{name:"details",label:t._({id:"hBG+yp"}),icon:s.jsx($,{}),content:w},{name:"tracking",label:t._({id:"IdrYoA"}),icon:s.jsx(Xe,{})},{name:"allocations",label:t._({id:"KwhnxF"}),icon:s.jsx(We,{}),hidden:!((u=e==null?void 0:e.part_detail)!=null&&u.salable)&&!((a=e==null?void 0:e.part_detail)!=null&&a.component)},{name:"testdata",label:t._({id:"dljGeD"}),icon:s.jsx(Ze,{}),hidden:!((i=e==null?void 0:e.part_detail)!=null&&i.trackable),content:e!=null&&e.pk?s.jsx(et,{itemId:e.pk,partId:e.part}):s.jsx(z,{})},{name:"installed_items",label:t._({id:"xnskHi"}),icon:s.jsx(Qe,{}),hidden:!((l=e==null?void 0:e.part_detail)!=null&&l.assembly),content:s.jsx($e,{parentId:e.pk})},{name:"child_items",label:t._({id:"K4v96J"}),icon:s.jsx(ve,{}),hidden:((e==null?void 0:e.child_items)??0)==0,content:e!=null&&e.pk?s.jsx(ze,{params:{ancestor:e.pk}}):s.jsx(z,{})},{name:"attachments",label:t._({id:"w/Sphq"}),icon:s.jsx(ye,{}),content:s.jsx(Ee,{endpoint:_.stock_attachment_list,model:"stock_item",pk:Number(r)})},{name:"notes",label:t._({id:"1DBGsz"}),icon:s.jsx(Ie,{}),content:s.jsx(he,{url:A(_.stock_item_list,r),data:e.notes??"",allowEdit:!0})}]},[e,r]),C=o.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.location_path??[]).map(u=>({name:u.name,url:Pe(p.stocklocation,u.pk)}))],[e]),j=ke({item_id:e.pk,callback:()=>d()}),x=o.useMemo(()=>({items:e,model:p.stockitem,refresh:d}),[e]),g=be(x),v=xe(x),y=fe(x),P=je(x),D=o.useMemo(()=>[s.jsx(oe,{actions:[ne({}),re({hidden:e==null?void 0:e.barcode_hash}),de({hidden:!(e!=null&&e.barcode_hash)})]}),s.jsx(W,{tooltip:t._({id:"ClJC3x"}),icon:s.jsx(Me,{}),actions:[{name:t._({id:"wBMjJ2"}),tooltip:t._({id:"rb0Klh"}),icon:s.jsx(R,{icon:"stocktake",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&g.open()}},{name:t._({id:"m16xKo"}),tooltip:t._({id:"vq/m8u"}),icon:s.jsx(R,{icon:"add",iconProps:{color:"green"}}),onClick:()=>{e.pk&&v.open()}},{name:t._({id:"t/YqKh"}),tooltip:t._({id:"qpe+W0"}),icon:s.jsx(R,{icon:"remove",iconProps:{color:"red"}}),onClick:()=>{e.pk&&y.open()}},{name:t._({id:"zPGNJm"}),tooltip:t._({id:"+OxnAC"}),icon:s.jsx(R,{icon:"transfer",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&P.open()}}]},"operations"),s.jsx(W,{icon:s.jsx(Se,{}),actions:[{name:t._({id:"euc6Ns"}),tooltip:t._({id:"KD3GYK"}),icon:s.jsx(Oe,{})},ce({}),pe({})]},"stock")],[r,e,n]);return s.jsxs(te,{children:[s.jsx(se,{visible:k.isFetching}),s.jsx(_e,{opened:h,onClose:()=>m(!1),selectedLocation:e==null?void 0:e.location}),s.jsx(me,{title:t._({id:"igx8Og"}),subtitle:(q=e.part_detail)==null?void 0:q.full_name,imageUrl:(E=e.part_detail)==null?void 0:E.thumbnail,detail:s.jsx(ae,{color:"teal",title:"Stock Item",children:s.jsxs(Q,{children:["Quantity: ",e.quantity??"idk"]})}),breadcrumbs:C,breadcrumbAction:()=>{m(!0)},actions:D}),s.jsx(ue,{pageKey:"stockitem",panels:K}),j.modal,g.modal,v.modal,y.modal,P.modal]})}export{Ut as default};
