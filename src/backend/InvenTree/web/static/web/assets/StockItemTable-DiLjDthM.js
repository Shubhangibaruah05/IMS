import{r as h,j as t,h as o,G as F}from"./vendor-C5fHLTDD.js";import{a as R,M as m,A as v,i as e,U as p,l as q}from"./index-DX4YmBvQ.js";import{A as w}from"./AddItemButton-BjrbTsCx.js";import{A as M}from"./ActionDropdown-C-AjyTLr.js";import{P as E,D as G,e as U,S as L,r as y,g as Q}from"./ColumnRenderers-Dz-jxqgo.js";import{a as V,b as X,c as J,d as Y,e as H,f as Z,g as B,h as N,i as O}from"./StockForms-yHG_9MvM.js";import{a as c}from"./ApiForm-Dtyf-xF2.js";import{u as W,g as $,I as K,S as ee}from"./InvenTreeTable-LkhQVMZE.js";import{a as ie}from"./UseForm-Btt47jru.js";import{u as te}from"./DesktopAppView-DlNUv0Ur.js";function se(){return[{accessor:"part",sortable:!0,render:i=>E(i==null?void 0:i.part_detail)},G({accessor:"part_detail.description"}),{accessor:"quantity",ordering:"stock",sortable:!0,title:e._({id:"blbbPS"}),render:i=>{let a=(i==null?void 0:i.quantity)??0,u=(i==null?void 0:i.allocated)??0,l=a-u,n=a,_=(i==null?void 0:i.part_detail)??{},s=[],d;return i.serial&&a==1&&(n=`# ${i.serial}`),i.is_building&&(d="blue",s.push(t.jsx(o,{size:"sm",children:e._({id:"fh2Vf5"})},"production"))),i.sales_order&&s.push(t.jsx(o,{size:"sm",children:e._({id:"X1BIR/"})},"sales-order")),i.customer&&s.push(t.jsx(o,{size:"sm",children:e._({id:"fHlvYo"})},"customer")),i.belongs_to&&s.push(t.jsx(o,{size:"sm",children:e._({id:"bGwMIh"})},"belongs-to")),i.consumed_by&&s.push(t.jsx(o,{size:"sm",children:e._({id:"Xig/cj"})},"consumed-by")),i.expired?s.push(t.jsx(o,{size:"sm",children:e._({id:"x/QIhZ"})},"expired")):i.stale&&s.push(t.jsx(o,{size:"sm",children:e._({id:"UtuqjX"})},"stale")),u>0&&(u>=a?(d="orange",s.push(t.jsx(o,{size:"sm",children:e._({id:"L1D5PL"})},"fully-allocated"))):s.push(t.jsx(o,{size:"sm",children:e._({id:"PjVOCj"})},"partially-allocated"))),l!=a&&(l>0?s.push(t.jsx(o,{size:"sm",color:"orange",children:e._({id:"csDS2L"})+`: ${l}`},"available")):s.push(t.jsx(o,{size:"sm",color:"red",children:e._({id:"a5n/wL"})},"no-stock"))),a<=0&&(d="red",s.push(t.jsx(o,{size:"sm",children:e._({id:"ddPzUj"})},"depleted"))),t.jsx(U,{value:t.jsxs(F,{spacing:"xs",position:"left",noWrap:!0,children:[t.jsx(o,{color:d,children:n}),_.units&&t.jsxs(o,{size:"xs",color:d,children:["[",_.units,"]"]})]}),title:e._({id:"odasNw"}),extra:s})}},L(m.stockitem),{accessor:"batch",sortable:!0},{accessor:"location",sortable:!0,render:function(i){var a;return((a=i==null?void 0:i.location_detail)==null?void 0:a.pathstring)??i.location??"-"}},{accessor:"expiry_date",sortable:!0,switchable:!0,render:i=>y(i.expiry_date)},{accessor:"updated",sortable:!0,switchable:!0,render:i=>y(i.updated)},{accessor:"purchase_price",sortable:!0,switchable:!0,render:i=>Q(i.purchase_price,{currency:i.purchase_price_currency})}]}function oe(){return[{name:"active",label:e._({id:"F6pfE9"}),description:e._({id:"UjHL/d"})},{name:"status",label:e._({id:"uAQUqI"}),description:e._({id:"+Jr1e4"}),choiceFunction:ee(m.stockitem)},{name:"assembly",label:e._({id:"WL36Yh"}),description:e._({id:"iG2HTd"})},{name:"allocated",label:e._({id:"A/ybx7"}),description:e._({id:"pxiNcZ"})},{name:"available",label:e._({id:"csDS2L"}),description:e._({id:"kbUAFH"})},{name:"cascade",label:e._({id:"VY386J"}),description:e._({id:"fMbOmV"})},{name:"depleted",label:e._({id:"9/P0N3"}),description:e._({id:"0n9TfP"})},{name:"in_stock",label:e._({id:"zn38D/"}),description:e._({id:"oXdFGe"})},{name:"is_building",label:e._({id:"BE5Q6v"}),description:e._({id:"c64azd"})},{name:"include_variants",label:e._({id:"/g9i/Z"}),description:e._({id:"n9gDGi"})},{name:"installed",label:e._({id:"eQkgKV"}),description:e._({id:"GQ73kf"})},{name:"sent_to_customer",label:e._({id:"XwjZor"}),description:e._({id:"LPuYfz"})},{name:"serialized",label:e._({id:"SkCY/+"}),description:e._({id:"S5yS1f"})},{name:"has_batch",label:e._({id:"qPCbMt"}),description:e._({id:"rc/Y1E"})},{name:"tracked",label:e._({id:"EaG6cP"}),description:e._({id:"TRFyJq"})},{name:"has_purchase_price",label:e._({id:"+MprDT"}),description:e._({id:"tAFrkr"})},{name:"external",label:e._({id:"k7rbV9"}),description:e._({id:"ETtRZU"})}]}function be({params:i={}}){let a=h.useMemo(()=>se(),[]),u=h.useMemo(()=>oe(),[]);const l=W("stockitems"),n=R(),_=te(),s=h.useMemo(()=>({items:l.selectedRecords,model:m.stockitem,refresh:l.refreshTable}),[l]),d=V({create:!0}),k=ie({url:v.stock_item_list,title:e._({id:"bJLEQT"}),fields:d,initialData:{part:i.part,location:i.location},onFormSuccess:b=>{b.pk&&_($(m.stockitem,b.pk))}}),f=X(s),x=J(s),S=Y(s),j=H(s),g=Z(s),C=B(s),I=N(s),T=O(s),z=h.useMemo(()=>{let b=n.hasDeleteRole(p.stock),r=n.hasAddRole(p.stock),A=n.hasAddRole(p.stocktake),P=n.hasAddRole(p.purchase_order),D=n.hasChangeRole(p.purchase_order);return[t.jsx(M,{icon:t.jsx(c,{icon:"stock"}),disabled:l.selectedRecords.length===0,actions:[{name:e._({id:"vq/m8u"}),icon:t.jsx(c,{icon:"add",iconProps:{color:"green"}}),tooltip:e._({id:"wiTIgC"}),disabled:!r,onClick:()=>{x.open()}},{name:e._({id:"qpe+W0"}),icon:t.jsx(c,{icon:"remove",iconProps:{color:"red"}}),tooltip:e._({id:"vP4ilC"}),disabled:!r,onClick:()=>{S.open()}},{name:"Count Stock",icon:t.jsx(c,{icon:"stocktake",iconProps:{color:"blue"}}),tooltip:"Count Stock",disabled:!A,onClick:()=>{j.open()}},{name:e._({id:"+OxnAC"}),icon:t.jsx(c,{icon:"transfer",iconProps:{color:"blue"}}),tooltip:e._({id:"lgwXs+"}),disabled:!r,onClick:()=>{f.open()}},{name:e._({id:"E6cz5z"}),icon:t.jsx(c,{icon:"info",iconProps:{color:"blue"}}),tooltip:e._({id:"/gndGd"}),disabled:!r,onClick:()=>{g.open()}},{name:e._({id:"3iu3Xl"}),icon:t.jsx(c,{icon:"merge"}),tooltip:e._({id:"V22osk"}),disabled:!r,onClick:()=>{C.open()}},{name:e._({id:"G4SnGh"}),icon:t.jsx(c,{icon:"buy"}),tooltip:e._({id:"iihIqf"}),disabled:!P||!D},{name:e._({id:"chR2IB"}),icon:t.jsx(c,{icon:"customer"}),tooltip:e._({id:"iihIqf"}),disabled:!r,onClick:()=>{I.open()}},{name:e._({id:"6vqSiF"}),icon:t.jsx(c,{icon:"delete",iconProps:{color:"red"}}),tooltip:e._({id:"y5SdJc"}),disabled:!b,onClick:()=>{T.open()}}]},"stockoperations"),t.jsx(w,{hidden:!n.hasAddRole(p.stock),tooltip:e._({id:"bJLEQT"}),onClick:()=>k.open()})]},[n,l]);return t.jsxs(t.Fragment,{children:[k.modal,f.modal,S.modal,x.modal,j.modal,g.modal,C.modal,I.modal,T.modal,t.jsx(K,{url:q(v.stock_item_list),tableState:l,columns:a,props:{enableDownload:!0,enableSelection:!0,tableFilters:u,tableActions:z,modelType:m.stockitem,params:{...i,part_detail:!0,location_detail:!0,supplier_part_detail:!0}}})]})}export{be as S};
