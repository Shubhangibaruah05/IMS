import{r as n,j as e,G as P,h as u,a9 as D,S as r,z as B,B as z,T as k,ar as I,aa as A}from"./vendor-C5fHLTDD.js";import{m as H,T as h}from"./BaseContext-BGXKB9QI.js";import{g as Y,a as J,h as N,i as s,l as M,A as c,n as p,j as K,s as Q}from"./index-DX4YmBvQ.js";import{A as W}from"./ActionButton-seel8ZoK.js";import{A as U,E as X}from"./ActionDropdown-C-AjyTLr.js";import{I as o}from"./InfoItem-Blmt5-7-.js";import{S as q}from"./StylishText-CD9I8-X7.js";import{D as $}from"./DetailDrawer-UU2gEx54.js";import{P as ee}from"./SettingList-DDWUNgd-.js";import{h as se,p as ie}from"./ApiForm-Dtyf-xF2.js";import{a as te,u as ae,b as le}from"./UseForm-Btt47jru.js";import{u as oe}from"./UseInstance-rwUPjJ4i.js";import{u as ne,I as re}from"./InvenTreeTable-LkhQVMZE.js";import{u as ce}from"./DesktopAppView-DlNUv0Ur.js";import{I as T}from"./IconCircleCheck-CZpHYTUf.js";import{I as v}from"./IconCircleX-5L0NjJlg.js";import{I as S}from"./IconRefresh-ClXNAr2V.js";import{I as de}from"./IconInfoCircle-D5K91YCo.js";import"./notifications-DM-9a7Is.js";import"./IconQrcode-DcoHpd2K.js";import"./IconEdit-DwKL16RF.js";import"./IconTrash-KFql82qv.js";import"./YesNoButton-DIAHIY63.js";import"./Instance-c0njg-mI.js";import"./IconExternalLink-CDh1KHXW.js";import"./ModelType-C8nSW6qW.js";import"./IconSearch-CKaD9XHL.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var pe=Y("outline","help-circle","IconHelpCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 16v.01",key:"svg-1"}],["path",{d:"M12 13a2 2 0 0 0 .914 -3.782a1.98 1.98 0 0 0 -2.414 .483",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ue=Y("outline","playlist-add","IconPlaylistAdd",[["path",{d:"M19 8h-14",key:"svg-0"}],["path",{d:"M5 12h9",key:"svg-1"}],["path",{d:"M11 16h-6",key:"svg-2"}],["path",{d:"M15 16h6",key:"svg-3"}],["path",{d:"M18 13v6",key:"svg-4"}]]);function me({id:a,refreshTable:j}){var g,b;const{instance:i,refreshInstance:d,instanceQuery:{isFetching:_,error:m}}=oe({endpoint:c.plugin_list,pk:a,throwError:!0}),f=n.useCallback(()=>{j(),d()},[j,d]);return _?e.jsx(B,{visible:!0}):m?e.jsx(u,{children:((g=m==null?void 0:m.response)==null?void 0:g.status)===404?e.jsx(h,{id:"OC2EKF",values:{id:a}}):e.jsx(h,{id:"1eDLl4"})}):e.jsxs(r,{spacing:"xs",children:[e.jsxs(P,{position:"apart",children:[e.jsx(z,{}),e.jsxs(P,{spacing:"xs",children:[i&&Z(i),e.jsx(k,{order:4,children:((b=i==null?void 0:i.meta)==null?void 0:b.human_name)??(i==null?void 0:i.name)??"-"})]}),e.jsx(U,{tooltip:s._({id:"etUvlY"}),icon:e.jsx(se,{}),actions:[X({tooltip:s._({id:"CL5Gfb"}),onClick:()=>{ie({title:s._({id:"CL5Gfb"}),url:c.plugin_list,pk:a,fields:{active:{}},onClose:f})}}),{name:s._({id:"HpK/8d"}),tooltip:s._({id:"HpK/8d"}),icon:e.jsx(S,{}),onClick:d}]})]}),e.jsx(B,{visible:_,overlayOpacity:0}),e.jsx(I,{withBorder:!0,children:e.jsxs(r,{spacing:"md",children:[e.jsx(k,{order:4,children:e.jsx(h,{id:"t4Dg7a"})}),e.jsxs(r,{pos:"relative",spacing:"xs",children:[e.jsx(o,{type:"text",name:s._({id:"6YtxFj"}),value:i==null?void 0:i.name}),e.jsx(o,{type:"text",name:s._({id:"Nu4oKW"}),value:i==null?void 0:i.meta.description}),e.jsx(o,{type:"text",name:s._({id:"VbeIOx"}),value:i==null?void 0:i.meta.author}),e.jsx(o,{type:"text",name:s._({id:"mYGY3B"}),value:i==null?void 0:i.meta.pub_date}),e.jsx(o,{type:"text",name:s._({id:"eE0JZ4"}),value:i==null?void 0:i.meta.version}),e.jsx(o,{type:"boolean",name:s._({id:"F6pfE9"}),value:i==null?void 0:i.active})]})]})}),e.jsx(I,{withBorder:!0,children:e.jsxs(r,{spacing:"md",children:[e.jsx(k,{order:4,children:e.jsx(h,{id:"sxxj4o"})}),e.jsxs(r,{pos:"relative",spacing:"xs",children:[(i==null?void 0:i.is_package)&&e.jsx(o,{type:"text",name:s._({id:"/L+cAM"}),value:i==null?void 0:i.package_name}),e.jsx(o,{type:"text",name:s._({id:"AJd5vK"}),value:i==null?void 0:i.meta.package_path}),e.jsx(o,{type:"boolean",name:s._({id:"++LBSt"}),value:i==null?void 0:i.is_builtin}),e.jsx(o,{type:"boolean",name:s._({id:"mGYa19"}),value:i==null?void 0:i.is_package})]})]})}),i&&i.active&&e.jsx(I,{withBorder:!0,children:e.jsxs(r,{spacing:"md",children:[e.jsx(k,{order:4,children:e.jsx(h,{id:"xWsR91"})}),e.jsx(ee,{pluginPk:a})]})})]})}function Z(a){return a.is_installed?a.active?e.jsx(A,{label:s._({id:"QqLLp2"}),children:e.jsx(T,{color:"green"})}):e.jsx(A,{label:s._({id:"s99Mc1"}),children:e.jsx(v,{color:"red"})}):e.jsx(A,{label:s._({id:"LtEW/l"}),children:e.jsx(pe,{})})}function Re(){const a=ne("plugin"),j=ce(),i=J(),[d,_]=N(t=>[t.server.plugins_enabled,t.server.plugins_install_disabled]),m=n.useMemo(()=>[{accessor:"name",title:s._({id:"fOuPPd"}),sortable:!0,render:function(t){return e.jsxs(P,{position:"left",children:[e.jsx(Z,{...t}),e.jsx(u,{children:t.name})]})}},{accessor:"meta.description",title:s._({id:"Nu4oKW"}),sortable:!1,render:function(t){return t.active?t.meta.description:e.jsx(u,{italic:!0,children:s._({id:"9YdyZU"})})}},{accessor:"meta.version",title:s._({id:"eE0JZ4"}),sortable:!1},{accessor:"meta.author",title:"Author",sortable:!1}],[]),f=n.useCallback((t,l,x)=>{H.openConfirmModal({title:e.jsx(q,{children:x?s._({id:"2RHgaV"}):s._({id:"KyWCx1"})}),children:e.jsx(D,{color:"green",icon:e.jsx(T,{}),title:x?s._({id:"fLe7w+"}):s._({id:"oBCe/M"}),children:e.jsxs(r,{spacing:"xs",children:[e.jsxs(u,{children:[x?s._({id:"LZ82cI"}):s._({id:"DSZP3u"}),":"]}),e.jsx(u,{size:"lg",italic:!0,children:l})]})}),labels:{cancel:s._({id:"dEgA5A"}),confirm:s._({id:"7VpPHA"})},onConfirm:()=>{let V=M(c.plugin_activate,t);const y="plugin-activate";p.show({id:y,message:x?s._({id:"zKwhqX"}):s._({id:"31OZWt"}),loading:!0}),K.patch(V,{active:x},{timeout:30*1e3}).then(()=>{a.refreshTable(),p.hide(y),p.show({title:s._({id:"lOONZM"}),message:x?s._({id:"VAuM5b"}):s._({id:"ysKQPq"}),color:"green"})}).catch(xe=>{p.hide(y),p.show({title:s._({id:"SlfejT"}),message:s._({id:"ycupYY"}),color:"red"})})}})},[]),g=n.useCallback(t=>{let l=[];return!t.is_builtin&&t.is_installed&&(t.active?l.push({title:s._({id:"5y3O+A"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{f(t.pk,t.name,!1)}}):l.push({title:s._({id:"FQBaXG"}),color:"green",icon:e.jsx(T,{}),onClick:()=>{f(t.pk,t.name,!0)}})),t.active&&t.is_package&&t.package_name&&l.push({title:s._({id:"EkH9pt"}),color:"blue",icon:e.jsx(S,{}),onClick:()=>{w(t.package_name),C.open()}}),!t.active&&t.is_installed&&t.is_package&&t.package_name&&l.push({title:s._({id:"fo0VXg"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{F(t.pk),L.open()},disabled:_||!1}),t.is_installed||l.push({title:s._({id:"cnGeoo"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{F(t.pk),O.open()}}),l},[i,d]),[b,w]=n.useState(""),C=te({title:s._({id:"R7k68Z"}),url:c.plugin_install,timeout:3e4,fields:{packagename:{},url:{},version:{},confirm:{}},initialData:{packagename:b},closeOnClickOutside:!1,submitText:s._({id:"TKQ7K+"}),successMessage:void 0,onFormSuccess:t=>{p.show({title:s._({id:"MiYlP5"}),message:t.result,autoClose:3e4,color:"green"}),a.refreshTable()}}),[E,F]=n.useState(-1),L=ae({title:s._({id:"mXzRzO"}),url:c.plugin_uninstall,pk:E,fetchInitialData:!1,timeout:3e4,fields:{delete_config:{}},preFormContent:e.jsx(D,{color:"red",icon:e.jsx(de,{}),title:s._({id:"6onEou"}),children:e.jsxs(r,{spacing:"xs",children:[e.jsx(u,{children:s._({id:"nh4MTY"})}),e.jsx(u,{children:s._({id:"2xOCJW"})})]})}),onFormSuccess:t=>{p.show({title:s._({id:"MAZU/W"}),message:t.result,autoClose:3e4,color:"green"}),a.refreshTable()}}),O=le({url:c.plugin_list,pk:E,title:s._({id:"nud26y"}),onFormSuccess:a.refreshTable,preFormWarning:s._({id:"vb5uIh"})}),R=n.useCallback(()=>{K.post(M(c.plugin_reload),{full_reload:!0,force_reload:!0,collect_plugins:!0}).then(()=>{Q({title:s._({id:"Bs76+T"}),message:s._({id:"js1VzJ"}),color:"green"}),a.refreshTable()})},[]),G=n.useMemo(()=>{var l;let t=[];return(l=i.user)!=null&&l.is_superuser&&d&&(t.push(e.jsx(W,{color:"green",icon:e.jsx(S,{}),tooltip:s._({id:"2VWTDu"}),onClick:R})),t.push(e.jsx(W,{color:"green",icon:e.jsx(ue,{}),tooltip:s._({id:"0O/OZv"}),onClick:()=>{w(""),C.open()},disabled:_||!1}))),t},[i,d]);return e.jsxs(e.Fragment,{children:[C.modal,L.modal,O.modal,e.jsx($,{title:s._({id:"NCjc4L"}),size:"50%",renderContent:t=>t?e.jsx(me,{id:t,refreshTable:a.refreshTable}):!1}),e.jsx(re,{url:M(c.plugin_list),tableState:a,columns:m,props:{enableDownload:!1,rowActions:g,onRowClick:t=>j(`${t.pk}/`),tableActions:G,tableFilters:[{name:"active",label:s._({id:"F6pfE9"}),type:"boolean"},{name:"builtin",label:s._({id:"++LBSt"}),type:"boolean"},{name:"sample",label:s._({id:"LcJmOR"}),type:"boolean"},{name:"installed",label:s._({id:"eQkgKV"}),type:"boolean"}]}})]})}export{me as PluginDrawer,Re as default};
