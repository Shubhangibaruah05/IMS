import{r as d,j as e,h as n,G as I,a4 as b,aK as k,S,z}from"./vendor-C5fHLTDD.js";import{g as U,a as L,i,l as P,A as p,M as r,U as C}from"./index-DX4YmBvQ.js";import{I as G,D as x}from"./ItemDetails-DTEWr5C0.js";import{D as w}from"./DetailsImage-Y3z_v9dS.js";import{A as g,V as E,L as F,U as K,E as N,a as R}from"./ActionDropdown-C-AjyTLr.js";import{P as O}from"./PageDetail-BwkjpKwR.js";import{P as Q}from"./PanelGroup-CWuySmV8.js";import{P as H,S as V}from"./Instance-c0njg-mI.js";import{N as X}from"./MarkdownEditor-CY0oiYAG.js";import{B as Z,b as Y}from"./BuildOrderTable-DzfedSzv.js";import{u as J}from"./UseForm-Btt47jru.js";import{u as W}from"./UseInstance-rwUPjJ4i.js";import{P as $}from"./ProgressBar-BhbAlmdB.js";import{u as ee,I as te,g as ie}from"./InvenTreeTable-LkhQVMZE.js";import{e as ae,B as M}from"./ColumnRenderers-Dz-jxqgo.js";import{u as se,d as le}from"./DesktopAppView-DlNUv0Ur.js";import{I as ne}from"./IconArrowRight-I69ZJa1E.js";import{c as oe,P as re,K as de,x as me,z as pe,f as ce,g as ue,v as _e,h as be}from"./ApiForm-Dtyf-xF2.js";import{A as xe}from"./AttachmentTable-AC0GadOO.js";import{S as A}from"./StockItemTable-DiLjDthM.js";import{I as he}from"./IconInfoCircle-D5K91YCo.js";import{I as fe}from"./IconClipboardCheck-B4GX13zY.js";import{I as je}from"./IconQrcode-DcoHpd2K.js";import{I as ke}from"./IconFileTypePdf-ST3WfDb7.js";import"./StylishText-CD9I8-X7.js";import"./YesNoButton-DIAHIY63.js";import"./ModelType-C8nSW6qW.js";import"./BaseContext-BGXKB9QI.js";import"./index-DtVngfXu.js";import"./ActionButton-seel8ZoK.js";import"./notifications-DM-9a7Is.js";import"./IconEdit-DwKL16RF.js";import"./IconTrash-KFql82qv.js";import"./Placeholder-C1-1kY0o.js";import"./AddItemButton-BjrbTsCx.js";import"./IconPlus-QsNVBJ5N.js";import"./IconSearch-CKaD9XHL.js";import"./IconRefresh-ClXNAr2V.js";import"./IconExternalLink-CDh1KHXW.js";import"./StockForms-yHG_9MvM.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ge=U("outline","list-check","IconListCheck",[["path",{d:"M3.5 5.5l1.5 1.5l2.5 -2.5",key:"svg-0"}],["path",{d:"M3.5 11.5l1.5 1.5l2.5 -2.5",key:"svg-1"}],["path",{d:"M3.5 17.5l1.5 1.5l2.5 -2.5",key:"svg-2"}],["path",{d:"M11 6l9 0",key:"svg-3"}],["path",{d:"M11 12l9 0",key:"svg-4"}],["path",{d:"M11 18l9 0",key:"svg-5"}]]);function ve({params:o={}}){const u=ee("buildline"),a=L(),h=se(),c=d.useMemo(()=>[{name:"allocated",description:i._({id:"qhfAiQ"})},{name:"available",label:i._({id:"csDS2L"}),description:i._({id:"INp5cq"})},{name:"consumable",label:i._({id:"duCsZf"}),description:i._({id:"4xoOP+"})},{name:"optional",label:i._({id:"LLAa/9"}),description:i._({id:"JZ0XU+"})}],[]),f=d.useCallback(t=>{let s=(t==null?void 0:t.bom_item_detail)??{},l=[],m=t==null?void 0:t.available_stock;return t.available_substitute_stock>0&&(m+=t.available_substitute_stock,l.push(e.jsx(n,{size:"sm",children:i._({id:"XTe+lK"})},"substitite"))),s.allow_variants&&t.available_variant_stock>0&&(m+=t.available_variant_stock,l.push(e.jsx(n,{size:"sm",children:i._({id:"LdvJ9e"})},"variant"))),t.in_production>0&&l.push(e.jsxs(n,{size:"sm",children:[i._({id:"G1xXyB"}),": ",t.in_production]},"production")),t.on_order>0&&l.push(e.jsxs(n,{size:"sm",children:[i._({id:"/MB+gl"}),": ",t.on_order]},"on-order")),t.external_stock>0&&l.push(e.jsxs(n,{size:"sm",children:[i._({id:"e8fwfT"}),": ",t.external_stock]},"external")),e.jsx(ae,{value:m>0?m:e.jsx(n,{color:"red",italic:!0,children:i._({id:"a5n/wL"})}),title:i._({id:"oGd3rK"}),extra:l})},[]),j=d.useMemo(()=>[{accessor:"bom_item",sortable:!0,switchable:!1,render:t=>e.jsx(H,{part:t.part_detail})},{accessor:"bom_item_detail.reference"},M({accessor:"bom_item_detail.consumable"}),M({accessor:"bom_item_detail.optional"}),{accessor:"bom_item_detail.quantity",sortable:!0,title:i._({id:"O7oMsT"}),ordering:"unit_quantity",render:t=>{var s,l;return e.jsxs(I,{position:"apart",children:[e.jsx(n,{children:(s=t.bom_item_detail)==null?void 0:s.quantity}),((l=t==null?void 0:t.part_detail)==null?void 0:l.units)&&e.jsxs(n,{size:"xs",children:["[",t.part_detail.units,"]"]})]})}},{accessor:"quantity",sortable:!0,render:t=>{var s;return e.jsxs(I,{position:"apart",children:[e.jsx(n,{children:t.quantity}),((s=t==null?void 0:t.part_detail)==null?void 0:s.units)&&e.jsxs(n,{size:"xs",children:["[",t.part_detail.units,"]"]})]})}},{accessor:"available_stock",sortable:!0,switchable:!1,render:f},{accessor:"allocated",switchable:!1,render:t=>{var s;return(s=t==null?void 0:t.bom_item_detail)!=null&&s.consumable?e.jsx(n,{italic:!0,children:i._({id:"f/GbFw"})}):e.jsx($,{progressLabel:!0,value:t.allocated,maximum:t.quantity})}}],[]),_=d.useCallback(t=>{var l;let s=t.part_detail;return(l=t==null?void 0:t.bom_item_detail)!=null&&l.consumable?[]:[{icon:e.jsx(ne,{}),title:i._({id:"L1LMmH"}),hidden:t.allocated>=t.quantity,color:"green"},{icon:e.jsx(oe,{}),title:i._({id:"cUzrZK"}),hidden:!(s!=null&&s.purchaseable),color:"blue"},{icon:e.jsx(re,{}),title:i._({id:"vgTd7I"}),hidden:!(s!=null&&s.assembly),color:"blue"}]},[a]);return e.jsx(te,{url:P(p.build_line_list),tableState:u,columns:j,props:{params:{...o,part_detail:!0},tableFilters:c,rowActions:_,onRowClick:t=>{var s;(s=t==null?void 0:t.part_detail)!=null&&s.pk&&h(ie(r.part,t.part_detail.pk))}}})}function dt(){var l,m;const{id:o}=le(),u=L(),{instance:a,refreshInstance:h,instanceQuery:c}=W({endpoint:p.build_order_list,pk:o,params:{part_detail:!0},refetchOnMount:!0}),f=d.useMemo(()=>{var v,y;if(c.isFetching)return e.jsx(b,{});let T=[{type:"link",name:"part",label:i._({id:"vgP+9p"}),model:r.part},{type:"status",name:"status",label:i._({id:"uAQUqI"}),model:r.build},{type:"text",name:"reference",label:i._({id:"N2C89m"})},{type:"text",name:"title",label:i._({id:"Nu4oKW"}),icon:"description"},{type:"link",name:"parent",icon:"builds",label:i._({id:"jqsG41"}),model_field:"reference",model:r.build,hidden:!a.parent}],B=[{type:"text",name:"quantity",label:i._({id:"Ee+3kG"})},{type:"progressbar",name:"completed",icon:"progress",total:a.quantity,progress:a.completed,label:i._({id:"Mzv4va"})},{type:"link",name:"sales_order",label:i._({id:"LozYBo"}),icon:"sales_orders",model:r.salesorder,model_field:"reference",hidden:!a.sales_order}],q=[{type:"text",name:"issued_by",label:i._({id:"kmUN8p"}),badge:"user"},{type:"text",name:"responsible",label:i._({id:"XQACoK"}),badge:"owner",hidden:!a.responsible}],D=[{type:"link",name:"take_from",icon:"location",model:r.stocklocation,label:i._({id:"/00Ond"}),backup_value:i._({id:"aZD9Yv"})},{type:"link",name:"destination",icon:"location",model:r.stocklocation,label:i._({id:"o35LCI"}),hidden:!a.destination}];return e.jsxs(G,{children:[e.jsxs(k,{children:[e.jsx(k.Col,{span:4,children:e.jsx(w,{appRole:C.part,apiPath:p.part_list,src:((v=a.part_detail)==null?void 0:v.image)??((y=a.part_detail)==null?void 0:y.thumbnail),pk:a.part})}),e.jsx(k.Col,{span:8,children:e.jsx(x,{fields:T,item:a})})]}),e.jsx(x,{fields:B,item:a}),e.jsx(x,{fields:q,item:a}),e.jsx(x,{fields:D,item:a})]})},[a,c]),j=d.useMemo(()=>[{name:"details",label:i._({id:"98Q4bz"}),icon:e.jsx(he,{}),content:f},{name:"allocate-stock",label:i._({id:"L1LMmH"}),icon:e.jsx(ge,{}),content:a!=null&&a.pk?e.jsx(ve,{params:{build:o,tracked:!1}}):e.jsx(b,{})},{name:"incomplete-outputs",label:i._({id:"E9en8O"}),icon:e.jsx(de,{})},{name:"complete-outputs",label:i._({id:"Mzv4va"}),icon:e.jsx(fe,{}),content:e.jsx(A,{params:{build:o,is_building:!1}})},{name:"consumed-stock",label:i._({id:"US3GCq"}),icon:e.jsx(me,{}),content:e.jsx(A,{params:{consumed_by:o}})},{name:"child-orders",label:i._({id:"CVlgqS"}),icon:e.jsx(pe,{}),content:a.pk?e.jsx(Z,{parentBuildId:a.pk}):e.jsx(b,{})},{name:"attachments",label:i._({id:"w/Sphq"}),icon:e.jsx(ce,{}),content:e.jsx(xe,{endpoint:p.build_order_attachment_list,model:"build",pk:Number(o)})},{name:"notes",label:i._({id:"1DBGsz"}),icon:e.jsx(ue,{}),content:e.jsx(X,{url:P(p.build_order_list,a.pk),data:a.notes??"",allowEdit:!0})}],[a,o]),_=J({url:p.build_order_list,pk:a.pk,title:i._({id:"B7ynKf"}),fields:Y(),onFormSuccess:()=>{h()}}),t=d.useMemo(()=>[e.jsx(g,{tooltip:i._({id:"heU0Hk"}),icon:e.jsx(je,{}),actions:[E({}),F({hidden:a==null?void 0:a.barcode_hash}),K({hidden:!(a!=null&&a.barcode_hash)})]},"barcode"),e.jsx(g,{tooltip:i._({id:"Tyj32s"}),icon:e.jsx(_e,{}),actions:[{icon:e.jsx(ke,{}),name:i._({id:"gjpdaf"}),tooltip:i._({id:"V7w5fl"})}]},"report"),e.jsx(g,{tooltip:i._({id:"tDgG1Y"}),icon:e.jsx(be,{}),actions:[N({onClick:()=>_.open(),hidden:!u.hasChangeRole(C.build)}),R({})]},"build")],[o,a,u]),s=d.useMemo(()=>a!=null&&a.status?V({status:a.status,type:r.build}):e.jsx(b,{}),[a,o]);return e.jsxs(e.Fragment,{children:[_.modal,e.jsxs(S,{spacing:"xs",children:[e.jsx(z,{visible:c.isFetching}),e.jsx(O,{title:a.reference,subtitle:a.title,detail:s,imageUrl:((l=a.part_detail)==null?void 0:l.image)??((m=a.part_detail)==null?void 0:m.thumbnail),breadcrumbs:[{name:i._({id:"RCVhIP"}),url:"/build"},{name:a.reference,url:`/build/${a.pk}`}],actions:t}),e.jsx(Q,{pageKey:"build",panels:j})]})]})}export{dt as default};
