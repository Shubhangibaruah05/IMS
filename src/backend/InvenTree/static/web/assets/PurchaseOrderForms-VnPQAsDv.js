import{r as l,j as e,aS as z,_ as R,ec as D,ax as L,aG as U,ed as W,ee as X,b7 as Z,i as n,as as Q,aW as Y,ad as $,aD as ee,c5 as m,w as te,ef as ie,b_ as ae,ba as _,bW as C,cV as ne,G as se,l as le}from"./vendor-B0vSnHFf.js";import{e as b,A as v,M as oe,d as re}from"./index-CDdQlqFV.js";import{A as r}from"./ActionButton-Br0cBRLA.js";import{a as ce,S as de,T as j}from"./UseForm-BimrM1zK.js";import{T as ue}from"./Instance-Co8OMzcE.js";import{P as pe}from"./ColumnRenderers-CwItNORh.js";import{S as _e}from"./StylishText-CrpvZzAV.js";import{I as o}from"./BaseContext-DSwOqL9e.js";import{u as fe,a as xe}from"./UseGenerator-C7bjPlPb.js";function Ie({supplierId:t,orderId:i,create:f}){const[d,x]=l.useState(""),[u,a]=l.useState(!0);return l.useEffect(()=>{u&&x("")},[u]),l.useEffect(()=>{a(d==="")},[d]),l.useMemo(()=>{const p={order:{filters:{supplier_detail:!0},disabled:!0},part:{filters:{part_detail:!0,supplier_detail:!0,active:!0,part_active:!0},adjustFilters:g=>({...g.filters,supplier:t})},quantity:{},reference:{},purchase_price:{icon:e.jsx(Q,{}),value:d,onValueChange:x},purchase_price_currency:{icon:e.jsx(D,{})},auto_pricing:{value:u,onValueChange:a},target_date:{icon:e.jsx(L,{})},destination:{icon:e.jsx(Y,{})},notes:{icon:e.jsx($,{})},link:{icon:e.jsx(ee,{})}};return f&&(p.merge_items={}),p},[f,i,t,u,d])}function Ae(){return l.useMemo(()=>({reference:{icon:e.jsx(z,{})},description:{},supplier:{filters:{is_supplier:!0,active:!0}},supplier_reference:{},project_code:{icon:e.jsx(R,{})},order_currency:{icon:e.jsx(D,{})},target_date:{icon:e.jsx(L,{})},link:{},contact:{icon:e.jsx(U,{}),adjustFilters:t=>({...t.filters,company:t.data.supplier})},address:{icon:e.jsx(W,{}),adjustFilters:t=>({...t.filters,company:t.data.supplier})},responsible:{filters:{is_active:!0},icon:e.jsx(X,{})}}),[])}function ge({input:t,record:i,statuses:f}){var q;const[d,{open:x,close:u}]=m(!1),[a,c]=l.useState(t.item.location??i.part_detail.default_location??i.part_detail.category_default_location),[p,g]=m(!!a,{onClose:()=>t.changeFn(t.idx,"location",null),onOpen:()=>t.changeFn(t.idx,"location",a)});l.useEffect(()=>{t.changeFn(t.idx,"location",a)},[a]);const P=fe(s=>{A||B(s)}),E=xe(s=>{T||N(s)}),[F,G]=m(!1,{onClose:()=>{t.changeFn(t.idx,"packaging",void 0)}}),[I,M]=m(!1,{onClose:()=>{t.changeFn(t.idx,"note",void 0)}}),[A,B]=l.useState(""),[T,N]=l.useState(""),[y,H]=m(!1,{onClose:()=>{t.changeFn(t.idx,"batch_code",void 0),t.changeFn(t.idx,"serial_numbers","")},onOpen:()=>{var s,O;P.update({part:(s=i==null?void 0:i.supplier_part_detail)==null?void 0:s.part,order:i==null?void 0:i.order}),E.update({part:(O=i==null?void 0:i.supplier_part_detail)==null?void 0:O.part,quantity:t.item.quantity})}}),[S,J]=m(!1,{onClose:()=>t.changeFn(t.idx,"status",10)}),[h,w]=l.useState(""),[k,V]=l.useState(null);l.useEffect(()=>{t.changeFn(t.idx,"barcode",k)},[k]),l.useEffect(()=>{if(!d)return;const s=setTimeout(()=>{V(h.length?h:null),u(),w("")},500);return()=>clearTimeout(s)},[h]);const K=l.useMemo(()=>{let s=n._({id:"RL9/J8"});return a===null?s:a===i.destination?n._({id:"LNKjyK"}):!i.destination&&!i.destination_detail&&a===i.part_detail.category_default_location?n._({id:"q3WAIO"}):!i.destination&&i.destination_detail&&a===i.destination_detail.pk&&i.received>0?n._({id:"K1Mf+T"}):a===i.part_detail.default_location?n._({id:"ALFlH9"}):s},[a]);return e.jsxs(e.Fragment,{children:[e.jsx(te,{opened:d,onClose:u,title:e.jsx(_e,{children:n._({id:"fNvDwV"})}),children:e.jsx(ie,{children:e.jsx(ae,{label:"Barcode data","data-autofocus":!0,value:h,onChange:s=>w(s.target.value)})})}),e.jsxs(_.Tr,{children:[e.jsx(_.Td,{children:e.jsxs(C,{gap:"sm",align:"center",children:[e.jsx(ue,{size:40,src:i.part_detail.thumbnail,align:"center"}),e.jsx("div",{children:i.part_detail.name})]})}),e.jsx(_.Td,{children:i.supplier_part_detail.SKU}),e.jsx(_.Td,{children:e.jsx(pe,{value:i.received,maximum:i.quantity,progressLabel:!0})}),e.jsx(_.Td,{style:{width:"1%",whiteSpace:"nowrap"},children:e.jsx(ne,{value:t.item.quantity,style:{width:"100px"},max:t.item.quantity,min:0,onChange:s=>t.changeFn(t.idx,"quantity",s)})}),e.jsx(_.Td,{style:{width:"1%",whiteSpace:"nowrap"},children:e.jsxs(C,{gap:"1px",children:[e.jsx(r,{size:"sm",onClick:()=>g.toggle(),icon:e.jsx(o,{icon:"location"}),tooltip:n._({id:"TJYLHZ"}),tooltipAlignment:"top",variant:p?"filled":"transparent"}),e.jsx(r,{size:"sm",onClick:()=>H.toggle(),icon:e.jsx(o,{icon:"batch_code"}),tooltip:n._({id:"G8Z9OY",values:{0:i.trackable&&" and Serial Numbers"}}),tooltipAlignment:"top",variant:y?"filled":"transparent"}),e.jsx(r,{size:"sm",icon:e.jsx(o,{icon:"packaging"}),tooltip:n._({id:"O7MZ1G"}),onClick:()=>G.toggle(),variant:F?"filled":"transparent"}),e.jsx(r,{onClick:()=>J.toggle(),icon:e.jsx(o,{icon:"status"}),tooltip:n._({id:"Gt4cm5"}),tooltipAlignment:"top",variant:S?"filled":"transparent"}),e.jsx(r,{icon:e.jsx(o,{icon:"note"}),tooltip:n._({id:"nxv8yE"}),tooltipAlignment:"top",variant:I?"filled":"transparent",onClick:()=>M.toggle()}),k?e.jsx(r,{icon:e.jsx(o,{icon:"unlink"}),tooltip:n._({id:"ut1J8k"}),tooltipAlignment:"top",variant:"filled",color:"red",onClick:()=>V(null)}):e.jsx(r,{icon:e.jsx(o,{icon:"barcode"}),tooltip:n._({id:"fNvDwV"}),tooltipAlignment:"top",variant:"transparent",onClick:()=>x()}),e.jsx(r,{onClick:()=>t.removeFn(t.idx),icon:e.jsx(o,{icon:"square_x"}),tooltip:n._({id:"zMFs5V"}),tooltipAlignment:"top",color:"red"})]})})]}),p&&e.jsx(_.Tr,{children:e.jsx(_.Td,{colSpan:10,children:e.jsxs(se,{grow:!0,preventGrowOverflow:!1,justify:"flex-apart",p:"xs",children:[e.jsx(le,{flex:0,p:"xs",children:e.jsx(o,{icon:"downright"})}),e.jsx(de,{fieldDefinition:{field_type:"related field",model:oe.stocklocation,api_url:b(v.stock_location_list),filters:{structural:!1},onValueChange:s=>{c(s)},description:K,value:a,label:n._({id:"wJijgU"}),icon:e.jsx(o,{icon:"location"})},defaultValue:i.destination??(i.destination_detail?i.destination_detail.pk:null)}),e.jsxs(C,{style:{marginBottom:"7px"},children:[(i.part_detail.default_location||i.part_detail.category_default_location)&&e.jsx(r,{icon:e.jsx(o,{icon:"default_location"}),tooltip:n._({id:"j9qXAA"}),onClick:()=>c(i.part_detail.default_location??i.part_detail.category_default_location),tooltipAlignment:"top"}),i.destination&&e.jsx(r,{icon:e.jsx(o,{icon:"destination"}),tooltip:n._({id:"NOgnJu"}),onClick:()=>c(i.destination),tooltipAlignment:"top"}),!i.destination&&i.destination_detail&&i.received>0&&e.jsx(r,{icon:e.jsx(o,{icon:"repeat_destination"}),tooltip:n._({id:"CKgjtC"}),onClick:()=>c(i.destination_detail.pk),tooltipAlignment:"top"})]})]})})}),e.jsx(j,{visible:y,onValueChange:s=>t.changeFn(t.idx,"batch",s),fieldDefinition:{field_type:"string",label:n._({id:"Vea6Aj"}),value:A}}),e.jsx(j,{visible:y&&i.trackable,onValueChange:s=>t.changeFn(t.idx,"serial_numbers",s),fieldDefinition:{field_type:"string",label:n._({id:"GFtCDL"}),value:T}}),e.jsx(j,{visible:F,onValueChange:s=>t.changeFn(t.idx,"packaging",s),fieldDefinition:{field_type:"string",label:n._({id:"pD/Ew0"})},defaultValue:(q=i==null?void 0:i.supplier_part_detail)==null?void 0:q.packaging}),e.jsx(j,{visible:S,defaultValue:10,onValueChange:s=>t.changeFn(t.idx,"status",s),fieldDefinition:{field_type:"choice",api_url:b(v.stock_status),choices:f,label:n._({id:"uAQUqI"})}}),e.jsx(j,{visible:I,onValueChange:s=>t.changeFn(t.idx,"note",s),fieldDefinition:{field_type:"string",label:n._({id:"KiJn9B"})}})]})}function Te(t){const{data:i}=Z({queryKey:["stock","status"],queryFn:async()=>re.get(b(v.stock_status)).then(a=>{if(a.status===200)return Object.values(a.data.values).map(g=>({value:g.key,display_name:g.label}))})}),f=Object.fromEntries(t.items.map(a=>[a.pk,a])),d=t.items.filter(a=>a.quantity!==a.received),x={id:{value:t.orderPk,hidden:!0},items:{field_type:"table",value:d.map((a,c)=>{var p;return{line_item:a.pk,location:a.destination??((p=a.destination_detail)==null?void 0:p.pk)??null,quantity:a.quantity-a.received,batch_code:"",serial_numbers:"",status:10,barcode:null}}),modelRenderer:a=>{const c=f[a.item.line_item];return e.jsx(ge,{input:a,record:c,statuses:i},c.pk)},headers:[n._({id:"vgP+9p"}),n._({id:"y90mqQ"}),n._({id:"fZ5Vnu"}),n._({id:"VbWX2u"}),n._({id:"7L01XJ"})]},location:{filters:{structural:!1}}},u=b(v.purchase_order_receive,null,{id:t.orderPk});return ce({...t.formProps,url:u,title:n._({id:"MXlhj9"}),fields:x,initialData:{location:null},size:"xl"})}export{Te as a,Ie as b,Ae as u};
