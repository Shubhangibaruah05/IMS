import{r as c,i as r,j as e,bf as k,fx as F,fy as y,bc as M,m as b,S as g,G as C,T as w,bd as W,z as Q,fz as Y,fA as E,b8 as G,A as $}from"./vendor-B0vSnHFf.js";import{T as a}from"./BaseContext-DSwOqL9e.js";import{u as T,L as X}from"./DesktopAppView-CofLSp00.js";import{G as q}from"./SettingList-CP9YLWgd.js";import{A as U}from"./AddItemButton-CD0U_4gd.js";import{A as Z}from"./AdminButton-Cl1ixKQi.js";import{b as D,a as L,E as I}from"./UseForm-BimrM1zK.js";import{D as v,a as H}from"./DetailDrawer-DenR9muX.js";import{a as S,M as x,A as p,e as P}from"./index-CDdQlqFV.js";import{u as R}from"./UseInstance-Bcp_oSAZ.js";import{u as B,R as O,a as z,I as N}from"./InvenTreeTable-D26a1r6-.js";import{B as A}from"./ColumnRenderers-CwItNORh.js";import"./Boundary-CysPC9mI.js";import"./ActionButton-Br0cBRLA.js";import"./Instance-Co8OMzcE.js";import"./StylishText-CrpvZzAV.js";import"./YesNoButton-1B57tnbm.js";function J({id:t,refreshTable:f}){var d;const{instance:s,refreshInstance:m,instanceQuery:{isFetching:_,error:l}}=R({endpoint:p.group_list,pk:t,throwError:!0,params:{permission_detail:!0}}),j=c.useMemo(()=>{if(!(s!=null&&s.permissions))return null;const u=s.permissions;return e.jsx(k,{w:"100%",children:Object.keys(u).map(o=>e.jsxs(k.Item,{value:o,children:[e.jsxs(k.Control,{children:[e.jsx(F,{children:s.permissions[o].length})," ",o]}),e.jsx(k.Panel,{children:e.jsx(y,{children:u[o].map(h=>e.jsx(F,{children:h},h))})})]},o))})},[s]);return _?e.jsx(M,{visible:!0}):l?e.jsx(b,{children:((d=l==null?void 0:l.response)==null?void 0:d.status)===404?e.jsx(a,{id:"yO7e9w",values:{id:t}}):e.jsx(a,{id:"rubZxD"})}):e.jsxs(g,{children:[e.jsx(I,{props:{url:p.group_list,pk:t,fields:{name:{}},onFormSuccess:()=>{f(),m()}},id:`group-detail-drawer-${t}`}),e.jsxs(C,{justify:"space-between",children:[e.jsx(w,{order:5,children:e.jsx(a,{id:"B7dQAo"})}),e.jsx(Z,{model:x.group,pk:s.pk})]}),e.jsx(C,{children:j})]})}function K(){const t=B("groups"),f=T(),s=S(),m=c.useCallback(i=>{s.hasChangePermission(x.group)&&f(`group-${i}/`)},[s]),_=c.useMemo(()=>[{accessor:"name",sortable:!0,title:r._({id:"6YtxFj"}),switchable:!1}],[]),l=c.useCallback(i=>[O({onClick:()=>m(i.pk),hidden:!s.hasChangePermission(x.group)}),z({hidden:!s.hasDeletePermission(x.group),onClick:()=>{d(i.pk),u.open()}})],[s]),[j,d]=c.useState(-1),u=D({url:p.group_list,pk:j,title:r._({id:"k/RLDM"}),successMessage:r._({id:"qYB1E/"}),table:t,preFormWarning:r._({id:"X8Qpil"})}),o=L({url:p.group_list,title:r._({id:"bm8pgG"}),fields:{name:{}},table:t}),h=c.useMemo(()=>{let i=[];return i.push(e.jsx(U,{onClick:()=>o.open(),tooltip:r._({id:"bm8pgG"}),hidden:!s.hasAddPermission(x.group)},"add-group")),i},[s]);return e.jsxs(e.Fragment,{children:[o.modal,u.modal,e.jsx(v,{title:r._({id:"46SUtl"}),renderContent:i=>!i||!i.startsWith("group-")?!1:e.jsx(J,{id:i.replace("group-",""),refreshTable:t.refreshTable})}),e.jsx(N,{url:P(p.group_list),tableState:t,columns:_,props:{rowActions:l,tableActions:h,onRowClick:i=>m(i.pk)}})]})}function V({id:t,refreshTable:f}){var u,o,h;const{instance:s,refreshInstance:m,instanceQuery:{isFetching:_,error:l}}=R({endpoint:p.user_list,pk:t,throwError:!0}),j=S(i=>{var n;return(n=i.user)==null?void 0:n.pk}),d=c.useMemo(()=>j===parseInt(t,10),[j,t]);return _?e.jsx(M,{visible:!0}):l?e.jsx(b,{children:((u=l==null?void 0:l.response)==null?void 0:u.status)===404?e.jsx(a,{id:"z0pfhl",values:{id:t}}):e.jsx(a,{id:"h/t9U9"})}):e.jsxs(g,{children:[e.jsx(I,{props:{url:p.user_list,pk:t,fields:{username:{},first_name:{},last_name:{},email:{},is_active:{label:r._({id:"bhnh17"}),description:r._({id:"xYgjoW"}),disabled:d},is_staff:{label:r._({id:"F5kfLm"}),description:r._({id:"paSmTV"}),disabled:d},is_superuser:{label:r._({id:"tIIrDc"}),description:r._({id:"dNitd2"}),disabled:d}},postFormContent:d?e.jsx(W,{title:e.jsx(a,{id:"CE+M2e"}),color:"blue",icon:e.jsx(Q,{}),children:e.jsx(a,{id:"bDFcjC"})}):void 0,onFormSuccess:()=>{f(),m()}},id:`user-detail-drawer-${t}`}),e.jsxs(g,{children:[e.jsx(w,{order:5,children:e.jsx(a,{id:"zhrjek"})}),e.jsx(Y,{maxHeight:125,showLabel:"Show More",hideLabel:"Show Less",children:e.jsx(b,{ml:"md",children:s!=null&&s.groups&&((o=s==null?void 0:s.groups)==null?void 0:o.length)>0?e.jsx(E,{children:(h=s==null?void 0:s.groups)==null?void 0:h.map(i=>e.jsx(E.Item,{children:e.jsx(H,{to:`../group-${i.pk}`,text:i.name})},i.pk))}):e.jsx(a,{id:"n7RDzR"})})})]})]})}function ee(){const t=B("users"),f=T(),s=S(),m=c.useCallback(n=>{s.hasChangePermission(x.user)&&f(`user-${n}/`)},[s]),_=c.useMemo(()=>[{accessor:"username",sortable:!0,switchable:!1},{accessor:"first_name",sortable:!0},{accessor:"last_name",sortable:!0},{accessor:"email",sortable:!0},{accessor:"groups",title:r._({id:"zhrjek"}),sortable:!0,switchable:!0,render:n=>n.groups.length},A({accessor:"is_staff"}),A({accessor:"is_superuser"}),A({accessor:"is_active"})],[]),[l,j]=c.useState(-1),d=c.useCallback(n=>[O({onClick:()=>m(n.pk),hidden:!s.hasChangePermission(x.user)}),z({hidden:!s.hasDeletePermission(x.user),onClick:()=>{j(n.pk),u.open()}})],[s]),u=D({url:p.user_list,pk:l,title:r._({id:"E33LRn"}),successMessage:r._({id:"Z1AUmg"}),table:t,preFormWarning:r._({id:"af4xhp"})}),o=L({url:p.user_list,title:r._({id:"UbwSmF"}),fields:{username:{},email:{},first_name:{},last_name:{}},table:t,successMessage:r._({id:"e7XEqK"})}),h=c.useMemo(()=>{let n=[];return n.push(e.jsx(U,{onClick:o.open,tooltip:r._({id:"UbwSmF"}),hidden:!s.hasAddPermission(x.user)},"add-user")),n},[s]),i=c.useMemo(()=>[{name:"is_active",label:r._({id:"F6pfE9"}),description:r._({id:"Y4Mpdd"})},{name:"is_staff",label:r._({id:"uXsB4R"}),description:r._({id:"wrd7Ba"})},{name:"is_superuser",label:r._({id:"agYOFs"}),description:r._({id:"e1FtjW"})}],[]);return e.jsxs(e.Fragment,{children:[o.modal,u.modal,e.jsx(v,{title:r._({id:"poTr35"}),renderContent:n=>!n||!n.startsWith("user-")?!1:e.jsx(V,{id:n.replace("user-",""),refreshTable:t.refreshTable})}),e.jsx(N,{url:P(p.user_list),tableState:t,columns:_,props:{rowActions:d,tableActions:h,tableFilters:i,onRowClick:n=>m(n.pk)}})]})}function _e(){return e.jsxs(g,{gap:"xs",children:[e.jsx(w,{order:5,children:e.jsx(a,{id:"Sxm8rQ"})}),e.jsx(ee,{}),e.jsx(G,{}),e.jsx(w,{order:5,children:e.jsx(a,{id:"zhrjek"})}),e.jsx(K,{}),e.jsx(G,{}),e.jsxs(g,{gap:0,children:[e.jsx(b,{children:e.jsx(a,{id:"Tz0i8g"})}),e.jsxs(C,{children:[e.jsx(b,{c:"dimmed",children:e.jsx(a,{id:"L83fOm"})}),e.jsx($,{component:X,to:"/settings/system",children:e.jsx(a,{id:"D4SseJ"})})]})]}),e.jsx(q,{keys:["LOGIN_ENABLE_REG","SIGNUP_GROUP","LOGIN_ENABLE_SSO_REG"]})]})}export{_e as default};
