import{j as e,c3 as P,r as p,G as x,m as j,b9 as z,i as n,c6 as Q,B as K,b7 as q,n as ee,ap as se,S as m,T as b,aL as te,c1 as A,cj as k,b6 as T,bc as G,bW as ie,fA as L,dP as R,bb as N}from"./vendor-B0vSnHFf.js";import{T as c}from"./BaseContext-DSwOqL9e.js";import{A as F,e as C,d as B}from"./index-CDdQlqFV.js";import{A as re}from"./AddItemButton-CD0U_4gd.js";import{Y as Z}from"./YesNoButton-1B57tnbm.js";import{u as U,I as V,A as ne,E as le,D as ae}from"./InvenTreeTable-D26a1r6-.js";import{I as d}from"./InfoItem-DSTJmwsR.js";import{D as Y,a as J}from"./DetailDrawer-DenR9muX.js";import{d as oe,S as de}from"./Instance-Co8OMzcE.js";import{M as O}from"./SettingList-CP9YLWgd.js";import{a as ce,u as xe,b as ue}from"./UseForm-BimrM1zK.js";import{B as E}from"./ColumnRenderers-CwItNORh.js";import{u as W}from"./DesktopAppView-CofLSp00.js";import"./ActionButton-Br0cBRLA.js";import"./Boundary-CysPC9mI.js";import"./StylishText-CrpvZzAV.js";function S(){return e.jsx(P,{size:18,color:"red"})}function D({machine:i}){const o={marginLeft:"4px"};if(!i.active)return e.jsx(Q,{style:o,color:"gray",children:e.jsx(K,{})});let l="green";i.machine_errors.length>0||!i.is_driver_available||i.status>=300?l="red":i.status>=200&&(l="orange");const a=i.initialized&&i.status>0&&i.status<300;return e.jsx(Q,{processing:a,style:o,color:l,children:e.jsx(K,{})})}function $({includeTypes:i=!0,includeDrivers:o=!0}={}){const{data:l,isFetching:s,refetch:a}=q({enabled:i,queryKey:["machine-types"],queryFn:()=>B.get(C(F.machine_types_list)).then(u=>u.data),staleTime:1e4}),{data:t,isFetching:h,refetch:g}=q({enabled:o,queryKey:["machine-drivers"],queryFn:()=>B.get(C(F.machine_driver_list)).then(u=>u.data),staleTime:10*1e3}),y=p.useCallback(()=>{a(),g()},[g,a]);return{machineTypes:l,machineDrivers:t,isFetching:s||h,refresh:y}}function je({machinePk:i,refreshTable:o}){const l=W(),{data:s,refetch:a,isFetching:t}=q({enabled:!0,queryKey:["machine-detail",i],queryFn:()=>B.get(C(F.machine_list,i)).then(w=>w.data)}),{machineTypes:h,machineDrivers:g,isFetching:y}=$(),u=t||y,_=p.useMemo(()=>h&&s?h.find(w=>w.slug===s.machine_type):void 0,[s==null?void 0:s.machine_type,h]),f=p.useMemo(()=>g&&s?g.find(w=>w.slug===s.driver):void 0,[s==null?void 0:s.driver,g]),M=p.useCallback(()=>{a(),o()},[a,o]),r=p.useCallback(w=>{B.post(C(F.machine_restart,void 0,{machine:w})).then(()=>{M(),ee.show({message:n._({id:"8hvWaA"}),color:"green",icon:e.jsx(se,{size:"1rem"})})})},[M]),v=xe({title:n._({id:"RBquff"}),url:F.machine_list,pk:i,fields:p.useMemo(()=>({name:{},active:{}}),[]),onClose:()=>M()}),I=ue({title:n._({id:"5ihjEH"}),successMessage:n._({id:"ZbXCol"}),url:F.machine_list,pk:i,preFormContent:e.jsx(j,{children:n._({id:"Y9eJUJ",values:{0:s==null?void 0:s.name}})}),onFormSuccess:()=>{o(),l(-1)}});return e.jsxs(m,{gap:"xs",children:[v.modal,I.modal,e.jsxs(x,{justify:"space-between",children:[e.jsx(K,{}),e.jsxs(x,{children:[s&&e.jsx(D,{machine:s}),e.jsx(b,{order:4,children:s==null?void 0:s.name})]}),e.jsxs(x,{children:[(s==null?void 0:s.restart_required)&&e.jsx(z,{color:"red",children:e.jsx(c,{id:"dKwnjv"})}),e.jsx(ne,{tooltip:n._({id:"72f9dQ"}),icon:e.jsx(te,{}),actions:[le({tooltip:n._({id:"RBquff"}),onClick:v.open}),ae({tooltip:n._({id:"5ihjEH"}),onClick:I.open}),{icon:e.jsx(A,{}),name:n._({id:"6z9W13"}),tooltip:n._({id:"Plnldt"})+(s!=null&&s.restart_required?" ("+n._({id:"kbLjlB"})+")":""),indicator:s!=null&&s.restart_required?{color:"red"}:void 0,onClick:()=>s&&r(s==null?void 0:s.pk)}]})]})]}),e.jsx(k,{withBorder:!0,children:e.jsxs(m,{gap:"md",children:[e.jsxs(x,{justify:"space-between",children:[e.jsx(b,{order:4,children:e.jsx(c,{id:"TXZA6i"})}),e.jsx(T,{variant:"outline",onClick:()=>a(),children:e.jsx(A,{})})]}),e.jsxs(m,{pos:"relative",gap:"xs",children:[e.jsx(G,{visible:u,overlayProps:{opacity:0}}),e.jsx(d,{name:n._({id:"pwL+bm"}),children:e.jsxs(x,{gap:"xs",children:[_?e.jsx(J,{to:`../type-${s==null?void 0:s.machine_type}`,text:_.name}):e.jsx(j,{children:s==null?void 0:s.machine_type}),s&&!_&&e.jsx(S,{})]})}),e.jsx(d,{name:n._({id:"3ADt1I"}),children:e.jsxs(x,{gap:"xs",children:[f?e.jsx(J,{to:`../driver-${s==null?void 0:s.driver}`,text:f.name}):e.jsx(j,{children:s==null?void 0:s.driver}),!(s!=null&&s.is_driver_available)&&e.jsx(S,{})]})}),e.jsx(d,{name:n._({id:"nsu9Un"}),children:e.jsx(Z,{value:(s==null?void 0:s.initialized)||!1})}),e.jsx(d,{name:n._({id:"F6pfE9"}),children:e.jsx(Z,{value:(s==null?void 0:s.active)||!1})}),e.jsx(d,{name:n._({id:"uAQUqI"}),children:e.jsxs(ie,{direction:"column",children:[(s==null?void 0:s.status)===-1?e.jsx(j,{fz:"xs",children:"No status"}):de({status:`${(s==null?void 0:s.status)||-1}`,type:`MachineStatus__${s==null?void 0:s.status_model}`}),e.jsx(j,{fz:"sm",children:s==null?void 0:s.status_text})]})}),e.jsxs(x,{justify:"space-between",gap:"xs",children:[e.jsxs(j,{fz:"sm",fw:700,children:[e.jsx(c,{id:"UirGxE"}),":"]}),s&&(s==null?void 0:s.machine_errors.length)>0?e.jsx(z,{color:"red",style:{marginLeft:"10px"},children:s==null?void 0:s.machine_errors.length}):e.jsx(j,{fz:"xs",children:e.jsx(c,{id:"hIOaIF"})}),e.jsx(L,{w:"100%",children:s==null?void 0:s.machine_errors.map((w,X)=>e.jsx(L.Item,{children:e.jsx(R,{children:w})},X))})]})]})]})}),e.jsx(N,{h:"10px"}),(s==null?void 0:s.is_driver_available)&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{withBorder:!0,children:[e.jsx(b,{order:5,pb:4,children:e.jsx(c,{id:"m57e2B"})}),e.jsx(O,{machinePk:i,configType:"M",onChange:M})]}),e.jsxs(k,{withBorder:!0,children:[e.jsx(b,{order:5,pb:4,children:e.jsx(c,{id:"fWJCep"})}),e.jsx(O,{machinePk:i,configType:"D",onChange:M})]})]})]})}function H({props:i,renderMachineDrawer:o=!0,createProps:l}){const{machineTypes:s,machineDrivers:a}=$(),t=U("machine"),h=W(),g=p.useMemo(()=>[{accessor:"name",sortable:!0,render:function(r){return e.jsxs(x,{justify:"left",wrap:"nowrap",children:[e.jsx(D,{machine:r}),e.jsx(j,{children:r.name}),r.restart_required&&e.jsx(z,{color:"red",children:e.jsx(c,{id:"dKwnjv"})})]})}},{accessor:"machine_type",sortable:!0,render:r=>{const v=s==null?void 0:s.find(I=>I.slug===r.machine_type);return e.jsxs(x,{gap:"xs",children:[e.jsx(j,{children:v?v.name:r.machine_type}),s&&!v&&e.jsx(S,{})]})}},{accessor:"driver",sortable:!0,render:r=>{const v=a==null?void 0:a.find(I=>I.slug===r.driver);return e.jsxs(x,{gap:"xs",children:[e.jsx(j,{children:v?v.name:r.driver}),!r.is_driver_available&&e.jsx(S,{})]})}},E({accessor:"initialized"}),E({accessor:"active"}),{accessor:"status",sortable:!1,render:r=>{const v=oe(`MachineStatus__${r.status_model}`);if(v&&r.status!==-1)return v(r)}}],[s]),[y,u]=p.useState(null),_=p.useMemo(()=>a?a.filter(r=>r.machine_type===y).map(r=>({value:r.slug,display_name:r.name})):[],[a,y]),f=ce({title:n._({id:"kZ/tbb"}),url:F.machine_list,fields:{name:{},machine_type:{hidden:!!(l!=null&&l.machine_type),...l!=null&&l.machine_type?{value:l.machine_type}:{},field_type:"choice",choices:s?s.map(r=>({value:r.slug,display_name:r.name})):[],onValueChange:r=>u(r)},driver:{hidden:!!(l!=null&&l.driver),...l!=null&&l.driver?{value:l.driver}:{},field_type:"choice",disabled:!y,choices:_},active:{}},onFormSuccess:r=>{t.refreshTable(),h(o?`machine-${r.pk}/`:`../machine-${r.pk}/`)},onClose:()=>{u(null)}}),M=p.useMemo(()=>[e.jsx(re,{variant:"outline",onClick:()=>{u(null),f.open()}})],[f.open]);return e.jsxs(e.Fragment,{children:[f.modal,o&&e.jsx(Y,{title:n._({id:"dGaozN"}),size:"lg",renderContent:r=>!r||!r.startsWith("machine-")?!1:e.jsx(je,{machinePk:r.replace("machine-",""),refreshTable:t.refreshTable})}),e.jsx(V,{url:C(F.machine_list),tableState:t,columns:g,props:{...i,enableDownload:!1,onRowClick:r=>h(o?`machine-${r.pk}/`:`../machine-${r.pk}/`),tableActions:M,params:{...i.params},tableFilters:[{name:"active",label:n._({id:"F6pfE9"}),type:"boolean"},{name:"machine_type",label:n._({id:"pwL+bm"}),type:"choice",choiceFunction:()=>s?s.map(r=>({value:r.slug,label:r.name})):[]},{name:"driver",label:n._({id:"6ccUsd"}),type:"choice",choiceFunction:()=>a?a.map(r=>({value:r.slug,label:r.name})):[]}]}})]})}function pe({machineTypeSlug:i}){var y,u,_;const o=W(),{machineTypes:l,refresh:s,isFetching:a}=$({includeDrivers:!1}),t=p.useMemo(()=>l==null?void 0:l.find(f=>f.slug===i),[l,i]),h=U("machineDrivers"),g=p.useMemo(()=>[{accessor:"name",title:n._({id:"6YtxFj"})},{accessor:"description",title:n._({id:"Nu4oKW"})},E({accessor:"is_builtin",title:n._({id:"argeGI"})})],[]);return e.jsxs(m,{children:[e.jsx(x,{justify:"center",children:e.jsx(b,{order:4,children:t?t.name:i})}),!t&&e.jsx(j,{style:{fontStyle:"italic"},children:e.jsx(c,{id:"FW2Ygg"})}),e.jsx(k,{withBorder:!0,children:e.jsxs(m,{gap:"md",children:[e.jsxs(x,{justify:"space-between",children:[e.jsx(b,{order:4,children:e.jsx(c,{id:"IBrg3Y"})}),e.jsx(T,{variant:"outline",onClick:()=>s(),children:e.jsx(A,{})})]}),e.jsxs(m,{pos:"relative",gap:"xs",children:[e.jsx(G,{visible:a,overlayProps:{opacity:0}}),e.jsx(d,{name:n._({id:"6YtxFj"}),value:t==null?void 0:t.name,type:"text"}),e.jsx(d,{name:n._({id:"L85WcV"}),value:t==null?void 0:t.slug,type:"text"}),e.jsx(d,{name:n._({id:"Nu4oKW"}),value:t==null?void 0:t.description,type:"text"}),!(t!=null&&t.is_builtin)&&e.jsx(d,{name:n._({id:"umAemZ"}),value:(y=t==null?void 0:t.provider_plugin)==null?void 0:y.name,type:"text",link:((u=t==null?void 0:t.provider_plugin)==null?void 0:u.pk)!==null?`../../plugin/${(_=t==null?void 0:t.provider_plugin)==null?void 0:_.pk}/`:void 0,detailDrawerLink:!0}),e.jsx(d,{name:n._({id:"jfVQG5"}),value:t==null?void 0:t.provider_file,type:"code"}),e.jsx(d,{name:n._({id:"++LBSt"}),value:t==null?void 0:t.is_builtin,type:"boolean"})]})]})}),e.jsx(k,{withBorder:!0,children:e.jsxs(m,{gap:"md",children:[e.jsx(b,{order:4,children:e.jsx(c,{id:"7wk8VI"})}),e.jsx(V,{url:C(F.machine_driver_list),tableState:h,columns:g,props:{dataFormatter:f=>f.filter(M=>M.machine_type===i),enableDownload:!1,enableSearch:!1,onRowClick:f=>o(`../driver-${f.slug}/`)}})]})})]})}function he({machineDriverSlug:i}){var g,y,u;const{machineDrivers:o,machineTypes:l,refresh:s,isFetching:a}=$(),t=p.useMemo(()=>o==null?void 0:o.find(_=>_.slug===i),[o,i]),h=p.useMemo(()=>l==null?void 0:l.find(_=>_.slug===(t==null?void 0:t.machine_type)),[o,l]);return e.jsxs(m,{children:[e.jsx(x,{justify:"center",children:e.jsx(b,{order:4,children:t?t.name:i})}),!t&&e.jsx(j,{style:{fontStyle:"italic"},children:e.jsx(c,{id:"p6inm0"})}),e.jsx(k,{withBorder:!0,children:e.jsxs(m,{gap:"md",children:[e.jsxs(x,{justify:"space-between",children:[e.jsx(b,{order:4,children:e.jsx(c,{id:"Dm7Jy5"})}),e.jsx(T,{variant:"outline",onClick:()=>s(),children:e.jsx(A,{})})]}),e.jsxs(m,{pos:"relative",gap:"xs",children:[e.jsx(G,{visible:a,overlayProps:{opacity:0}}),e.jsx(d,{name:n._({id:"6YtxFj"}),value:t==null?void 0:t.name,type:"text"}),e.jsx(d,{name:n._({id:"L85WcV"}),value:t==null?void 0:t.slug,type:"text"}),e.jsx(d,{name:n._({id:"Nu4oKW"}),value:t==null?void 0:t.description,type:"text"}),e.jsx(d,{name:n._({id:"I+nMNp"}),value:h?h.name:t==null?void 0:t.machine_type,type:"text",link:h?`../type-${t==null?void 0:t.machine_type}`:void 0,detailDrawerLink:!0}),!(t!=null&&t.is_builtin)&&e.jsx(d,{name:n._({id:"umAemZ"}),value:(g=t==null?void 0:t.provider_plugin)==null?void 0:g.name,type:"text",link:((y=t==null?void 0:t.provider_plugin)==null?void 0:y.pk)!==null?`../../plugin/${(u=t==null?void 0:t.provider_plugin)==null?void 0:u.pk}/`:void 0,detailDrawerLink:!0}),e.jsx(d,{name:n._({id:"jfVQG5"}),value:t==null?void 0:t.provider_file,type:"code"}),e.jsx(d,{name:n._({id:"++LBSt"}),value:t==null?void 0:t.is_builtin,type:"boolean"}),e.jsxs(x,{justify:"space-between",gap:"xs",children:[e.jsxs(j,{fz:"sm",fw:700,children:[e.jsx(c,{id:"UirGxE"}),":"]}),t&&(t==null?void 0:t.driver_errors.length)>0?e.jsx(z,{color:"red",style:{marginLeft:"10px"},children:t.driver_errors.length}):e.jsx(j,{fz:"xs",children:e.jsx(c,{id:"hIOaIF"})}),e.jsx(L,{w:"100%",children:t==null?void 0:t.driver_errors.map((_,f)=>e.jsx(L.Item,{children:e.jsx(R,{children:_})},f))})]})]})]})}),e.jsx(k,{withBorder:!0,children:e.jsxs(m,{gap:"md",children:[e.jsx(b,{order:4,children:e.jsx(c,{id:"Qf5DYN"})}),e.jsx(H,{props:{params:{driver:i}},renderMachineDrawer:!1,createProps:{machine_type:t==null?void 0:t.machine_type,driver:i}})]})})]})}function _e({props:i}){const o=U("machineTypes"),l=W(),s=p.useMemo(()=>[{accessor:"name",title:n._({id:"6YtxFj"})},{accessor:"description",title:n._({id:"Nu4oKW"})},E({accessor:"is_builtin",title:n._({id:"eBtH/D"})})],[]);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:n._({id:"9Lc7+e"}),size:"lg",renderContent:a=>!a||!a.startsWith("type-")?!1:e.jsx(pe,{machineTypeSlug:a.replace("type-","")})}),e.jsx(Y,{title:n._({id:"VDbgpF"}),size:"lg",renderContent:a=>!a||!a.startsWith("driver-")?!1:e.jsx(he,{machineDriverSlug:a.replace("driver-","")})}),e.jsx(V,{url:C(F.machine_types_list),tableState:o,columns:s,props:{...i,enableDownload:!1,enableSearch:!1,onRowClick:a=>l(`type-${a.slug}/`),params:{...i.params}}})]})}function qe(){var l;const{data:i,refetch:o}=q({queryKey:["machine-registry-status"],queryFn:()=>B.get(C(F.machine_registry_status)).then(s=>s.data),staleTime:1e4});return e.jsxs(m,{children:[e.jsx(H,{props:{}}),e.jsx(N,{h:"10px"}),e.jsxs(m,{gap:"xs",children:[e.jsx(b,{order:5,children:e.jsx(c,{id:"LuGy8Q"})}),e.jsx(_e,{props:{}})]}),e.jsx(N,{h:"10px"}),e.jsxs(m,{gap:"xs",children:[e.jsxs(x,{children:[e.jsx(b,{order:5,children:e.jsx(c,{id:"1ctV9a"})}),e.jsx(T,{variant:"outline",onClick:()=>o(),children:e.jsx(A,{})})]}),i!=null&&i.registry_errors&&i.registry_errors.length===0?e.jsx(j,{style:{fontStyle:"italic"},children:e.jsx(c,{id:"LK9cs2"})}):e.jsx(L,{children:(l=i==null?void 0:i.registry_errors)==null?void 0:l.map((s,a)=>e.jsx(L.Item,{children:e.jsx(R,{children:s.message})},a))})]})]})}export{qe as default};
