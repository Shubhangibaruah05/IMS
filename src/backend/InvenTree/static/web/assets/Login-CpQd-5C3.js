import{c5 as y,j as e,G as m,b6 as P,f6 as V,C as M,b5 as Z,f7 as Y,m as h,q as L,f8 as W,f9 as K,fa as X,fb as J,fc as Q,fd as $,fe as ee,ff as se,fg as te,fh as ie,fi as ne,fj as re,r as S,b8 as w,i,S as E,b_ as _,fk as T,A as k,L as oe,ai as ae,B as le,v as de,fl as ce,bb as ue,eQ as O,T as xe,cm as me,ap as je,l as pe,c4 as ge}from"./vendor-B0vSnHFf.js";import{T as a}from"./BaseContext-DSwOqL9e.js";import{u as C,b as R,g as he,h as fe}from"./DesktopAppView-CofLSp00.js";import{c as I,d as N,e as H,A as U,a as be,C as q,D as b,E as _e,u as D,F as Ie,G as ve}from"./index-CDdQlqFV.js";import{L as Le,C as Se}from"./LanguageSelect-D9NdyCAr.js";import{u as F}from"./use-form-CVpPkiYA.js";import{E as z}from"./EditButton-CoIrf_EI.js";function we(){const[t,l]=y();return e.jsxs(m,{justify:"center",style:{border:t===!0?"1px dashed ":"",margin:t===!0?2:12,padding:t===!0?8:0},children:[e.jsx(P,{onClick:()=>l.toggle(),size:"lg",variant:"transparent",children:e.jsx(V,{})}),t&&e.jsx(m,{children:e.jsx(Le,{})})]})}function ke({hostname:t,toggleHostEdit:l}){const[s]=I(d=>[d.server]);return e.jsx(M,{mx:"md",children:e.jsxs(m,{children:[e.jsx(Se,{}),e.jsx(we,{}),window.INVENTREE_SETTINGS.show_server_selector&&e.jsx(Z,{label:t,children:e.jsx(Y,{onClick:l})}),e.jsxs(h,{c:"dimmed",children:[s.version," | ",s.apiVersion]})]})})}const Fe={google:e.jsx(K,{}),github:e.jsx(X,{}),facebook:e.jsx(J,{}),discord:e.jsx(Q,{}),twitter:e.jsx($,{}),bitbucket:e.jsx(ee,{}),flickr:e.jsx(se,{}),gitlab:e.jsx(te,{}),reddit:e.jsx(ie,{}),twitch:e.jsx(ne,{}),microsoft:e.jsx(re,{})};function G({provider:t}){function l(){N.put(H(U.ui_preference),{preferred_method:"pui"},{headers:{Authorization:""}}).then(()=>{window.location.href=t.login})}return e.jsxs(L,{leftSection:Ee(t),radius:"xl",component:"a",onClick:l,children:[t.display_name," "]})}function Ee(t){return Fe[t.id]||e.jsx(W,{})}function Te(){const t=F({initialValues:{username:"",password:""}}),l=F({initialValues:{email:""}}),[s,d]=y(!0),[n]=I(o=>[o.auth_settings]),u=C(),j=R(),{isLoggedIn:r}=be(),[p,g]=S.useState(!1);function c(){g(!0),s===!0?q(t.values.username,t.values.password).then(()=>{var o;g(!1),r()?(b({title:i._({id:"6cPKtu"}),message:i._({id:"uKMMk4"})}),u(((o=j==null?void 0:j.state)==null?void 0:o.redirectFrom)??"/home")):b({title:i._({id:"4GKuCs"}),message:i._({id:"tnaYa/"}),success:!1})}):_e(l.values.email).then(o=>{g(!1),(o==null?void 0:o.status)==="ok"?b({title:i._({id:"XAIcYu"}),message:i._({id:"R2JMfc"})}):b({title:i._({id:"MMJM0z"}),message:i._({id:"tnaYa/"}),success:!1})})}return e.jsxs(e.Fragment,{children:[(n==null?void 0:n.sso_enabled)===!0?e.jsxs(e.Fragment,{children:[e.jsx(m,{grow:!0,mb:"md",mt:"md",children:n.providers.map(o=>e.jsx(G,{provider:o},o.id))}),e.jsx(w,{label:i._({id:"zTZjMy"}),labelPosition:"center",my:"lg"})]}):null,e.jsxs("form",{onSubmit:t.onSubmit(()=>{}),children:[s?e.jsxs(E,{gap:0,children:[e.jsx(_,{required:!0,label:i._({id:"7sNhEz"}),placeholder:i._({id:"k1RkIL"}),...t.getInputProps("username")}),e.jsx(T,{required:!0,label:i._({id:"8ZsakT"}),placeholder:i._({id:"9TO8nT"}),...t.getInputProps("password")}),(n==null?void 0:n.password_forgotten_enabled)===!0&&e.jsx(m,{justify:"space-between",mt:"0",children:e.jsx(k,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>u("/reset-password"),children:e.jsx(a,{id:"RfwZxd"})})})]}):e.jsx(E,{children:e.jsx(_,{required:!0,label:i._({id:"O3oNi5"}),description:i._({id:"Wr5sDQ"}),placeholder:"email@example.org",...l.getInputProps("email")})}),e.jsxs(m,{justify:"space-between",mt:"xl",children:[e.jsx(k,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>d.toggle(),children:s?e.jsx(a,{id:"7ZOmjI"}):e.jsx(a,{id:"vZk5Sm"})}),e.jsx(L,{type:"submit",disabled:p,onClick:c,children:p?e.jsx(oe,{size:"sm"}):e.jsx(e.Fragment,{children:s?e.jsx(a,{id:"ADVQ46"}):e.jsx(a,{id:"i/TzEU"})})})]})]})]})}function ye(){const t=F({initialValues:{username:"",email:"",password1:"",password2:""}}),l=C(),[s]=I(r=>[r.auth_settings]),[d,n]=S.useState(!1);function u(){n(!0),N.post(H(U.user_register),t.values,{headers:{Authorization:""}}).then(r=>{(r==null?void 0:r.status)===204&&(n(!1),b({title:i._({id:"EoCs7m"}),message:i._({id:"n2c6Ul"})}),l("/home"))}).catch(r=>{var p,g;if(r.response.status===400){n(!1);for(const[o,f]of Object.entries(r.response.data))t.setFieldError(o,f);let c="";(g=(p=r.response)==null?void 0:p.data)!=null&&g.non_field_errors&&(c=r.response.data.non_field_errors),b({title:i._({id:"ccnxuA"}),message:i._({id:"tnaYa/"})+c,success:!1})}})}const j=(s==null?void 0:s.registration_enabled)&&(s==null?void 0:s.sso_registration);return e.jsxs(e.Fragment,{children:[(s==null?void 0:s.registration_enabled)&&e.jsxs("form",{onSubmit:t.onSubmit(()=>{}),children:[e.jsxs(E,{gap:0,children:[e.jsx(_,{required:!0,label:i._({id:"7sNhEz"}),placeholder:i._({id:"k1RkIL"}),...t.getInputProps("username")}),e.jsx(_,{required:!0,label:i._({id:"O3oNi5"}),description:i._({id:"kXXdWU"}),placeholder:"email@example.org",...t.getInputProps("email")}),e.jsx(T,{required:!0,label:i._({id:"8ZsakT"}),placeholder:i._({id:"9TO8nT"}),...t.getInputProps("password1")}),e.jsx(T,{required:!0,label:i._({id:"NK5XEe"}),placeholder:i._({id:"R1OtIL"}),...t.getInputProps("password2")})]}),e.jsx(m,{justify:"space-between",mt:"xl",children:e.jsx(L,{type:"submit",disabled:d,onClick:u,fullWidth:!0,children:e.jsx(a,{id:"fgLNSM"})})})]}),j&&e.jsx(w,{label:i._({id:"IES56a"}),labelPosition:"center",my:"lg"}),(s==null?void 0:s.sso_registration)===!0&&e.jsx(m,{grow:!0,mb:"md",mt:"md",children:s.providers.map(r=>e.jsx(G,{provider:r},r.id))})]})}function Ce({loginMode:t,setMode:l}){const[s]=I(n=>[n.auth_settings]);return((s==null?void 0:s.registration_enabled)||(s==null?void 0:s.sso_registration)||!1)===!1?null:e.jsx(h,{ta:"center",size:"xs",mt:"md",children:t?e.jsxs(e.Fragment,{children:[e.jsx(a,{id:"ln9/n9"})," ",e.jsx(k,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>l.close(),children:e.jsx(a,{id:"fgLNSM"})})]}):e.jsx(k,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>l.open(),children:e.jsx(a,{id:"jZUk0D"})})})}function Be({data:t,saveOptions:l}){const s=F({initialValues:t});function d(u){const j=s.values;delete j[u],s.setValues(j)}const n=Object.entries(s.values).map(([u])=>e.jsx(m,{mt:"xs",children:s.values[u]!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(_,{placeholder:i._({id:"Ai2U7L"}),withAsterisk:!0,style:{flex:1},...s.getInputProps(`${u}.host`)}),e.jsx(_,{placeholder:i._({id:"6YtxFj"}),withAsterisk:!0,style:{flex:1},...s.getInputProps(`${u}.name`)}),e.jsx(P,{color:"red",onClick:()=>{d(u)},variant:"default",children:e.jsx(ae,{})})]})},u));return e.jsx("form",{onSubmit:s.onSubmit(l),children:e.jsxs(le,{style:{maxWidth:500},mx:"auto",children:[n.length>0?e.jsxs(m,{mb:"xs",children:[e.jsx(h,{fw:500,size:"sm",style:{flex:1},children:e.jsx(a,{id:"Ai2U7L"})}),e.jsx(h,{fw:500,size:"sm",style:{flex:1},children:e.jsx(a,{id:"6YtxFj"})})]}):e.jsx(h,{c:"dimmed",ta:"center",children:e.jsx(a,{id:"yWMzcH"})}),n,e.jsxs(m,{mt:"md",children:[e.jsxs(L,{onClick:()=>s.setFieldValue(`${de()}`,{name:"",host:""}),children:[e.jsx(ce,{}),e.jsx(a,{id:"UYWLpE"})]}),e.jsx(ue,{style:{flex:1}}),e.jsx(L,{type:"submit",children:e.jsx(a,{id:"tfDRzk"})})]})]})})}function Ae({hostKey:t,ChangeHost:l,setHostEdit:s}){const[d,n]=O([!1,!0]),[u,j,r]=D(c=>[c.setHost,c.setHostList,c.hostList]),p=Object.keys(r).map(c=>{var o;return{value:c,label:(o=r[c])==null?void 0:o.name}});function g(c){j(c),c[t]===void 0&&u("",""),n()}return e.jsxs(e.Fragment,{children:[e.jsx(xe,{order:3,children:e.jsx(a,{id:"GG8+B2"})}),e.jsxs(m,{children:[e.jsxs(m,{children:[e.jsx(me,{value:t,onChange:l,data:p,disabled:d}),e.jsx(z,{setEditing:n,editing:d,disabled:d})]}),e.jsx(z,{setEditing:s,editing:!0,disabled:d,saveIcon:e.jsx(je,{})})]}),d?e.jsxs(e.Fragment,{children:[e.jsx(w,{my:"sm"}),e.jsx(h,{children:e.jsx(a,{id:"uqEJlE"})}),e.jsx(Be,{data:r,saveOptions:g})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{my:"sm"}),e.jsx(ze,{hostList:r,hostKey:t})]})]})}function ze({hostList:t,hostKey:l}){var d;const[s]=I(n=>[n.server]);return e.jsxs(h,{children:[(d=t[l])==null?void 0:d.host,e.jsx("br",{}),e.jsx(a,{id:"GUtCZC",values:{0:s.version}}),e.jsx("br",{}),e.jsx(a,{id:"4/F1y3",values:{0:s.apiVersion}}),e.jsx("br",{}),e.jsx(a,{id:"UVRlfm",values:{0:s.instance}}),e.jsx("br",{}),e.jsx(a,{id:"ed0N/H",values:{0:s.worker_pending_tasks,1:s.plugins_enabled?` (${s.active_plugins.length})`:null},components:{0:e.jsx(h,{span:!0,c:s.worker_running?"green":"red"}),1:e.jsx(h,{span:!0,c:s.plugins_enabled?"green":"red"})}})]})}function qe(){var A;const[t,l,s]=D(x=>[x.hostKey,x.setHost,x.hostList]),[d,n]=I(x=>[x.server,x.fetchServerApiState]),u=s[t]===void 0?i._({id:"bX1aQ5"}):(A=s[t])==null?void 0:A.name,[j,r]=O([!1,!0]),[p,g]=y(!0),c=C(),o=R(),[f]=he();function B(x){var v;x!==null&&(l((v=s[x])==null?void 0:v.host,x),ve(),n())}return S.useEffect(()=>{var x;t===""&&B(fe),Ie(c,(x=o==null?void 0:o.state)==null?void 0:x.redirectFrom,!0),f.has("login")&&f.has("password")&&q(f.get("login")??"",f.get("password")??"").then(()=>{var v;c(((v=o==null?void 0:o.state)==null?void 0:v.redirectFrom)??"/home")})},[]),S.useEffect(()=>{d.server===null&&n()},[d]),e.jsx(M,{mih:"100vh",children:e.jsx(pe,{w:"md",miw:400,children:j?e.jsx(Ae,{hostKey:t,ChangeHost:B,setHostEdit:r}):e.jsxs(e.Fragment,{children:[e.jsxs(ge,{radius:"md",p:"xl",withBorder:!0,children:[e.jsx(h,{size:"lg",fw:500,children:p?e.jsx(a,{id:"BL4vL0"}):e.jsx(a,{id:"qJ5FUT"})}),p?e.jsx(Te,{}):e.jsx(ye,{}),e.jsx(Ce,{loginMode:p,setMode:g})]}),e.jsx(ke,{hostname:u,toggleHostEdit:r})]})})})}export{qe as default};
