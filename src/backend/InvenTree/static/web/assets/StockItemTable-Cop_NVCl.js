import{r as b,i as e,j as i,m as l,G as w}from"./vendor-B0vSnHFf.js";import{A as D}from"./AddItemButton-CD0U_4gd.js";import{u as F,A as L,I as E,S as M}from"./InvenTreeTable-D26a1r6-.js";import{a as G,D as U,g as V,S as X,i as Q,j as h,d as Y,k as J}from"./ColumnRenderers-CwItNORh.js";import{a as N,M as r,A as v,U as m,w as H,e as O}from"./index-CDdQlqFV.js";import{a as Z,b as B,c as K,d as W,e as $,f as ee,g as te,h as ie,i as se}from"./StockForms-DLBgZVBa.js";import{I as c}from"./BaseContext-DSwOqL9e.js";import{a as ae}from"./UseForm-BimrM1zK.js";function le(){return[{accessor:"part",sortable:!0,render:t=>G(t==null?void 0:t.part_detail)},{accessor:"part_detail.IPN",title:e._({id:"3wXEsN"}),sortable:!0},{accessor:"part_detail.revision",title:e._({id:"6LTyxl"}),sortable:!0},U({accessor:"part_detail.description"}),{accessor:"quantity",ordering:"stock",sortable:!0,title:e._({id:"blbbPS"}),render:t=>{let n=(t==null?void 0:t.quantity)??0,d=(t==null?void 0:t.allocated)??0,u=n-d,p=n,o=(t==null?void 0:t.part_detail)??{},s=[],a,k=!(t!=null&&t.belongs_to)&&!(t!=null&&t.consumed_by)&&!(t!=null&&t.customer)&&!(t!=null&&t.is_building)&&!(t!=null&&t.sales_order)&&!(t!=null&&t.expired)&&(t==null?void 0:t.quantity)&&(t==null?void 0:t.quantity)>0;return t.serial&&n==1&&(p=`# ${t.serial}`),t.is_building&&(a="blue",s.push(i.jsx(l,{size:"sm",children:e._({id:"fh2Vf5"})},"production"))),t.sales_order&&s.push(i.jsx(l,{size:"sm",children:e._({id:"X1BIR/"})},"sales-order")),t.customer&&s.push(i.jsx(l,{size:"sm",children:e._({id:"fHlvYo"})},"customer")),t.belongs_to&&s.push(i.jsx(l,{size:"sm",children:e._({id:"bGwMIh"})},"belongs-to")),t.consumed_by&&s.push(i.jsx(l,{size:"sm",children:e._({id:"Xig/cj"})},"consumed-by")),t.expired?s.push(i.jsx(l,{size:"sm",children:e._({id:"x/QIhZ"})},"expired")):t.stale&&s.push(i.jsx(l,{size:"sm",children:e._({id:"UtuqjX"})},"stale")),d>0&&(d>=n?(a="orange",s.push(i.jsx(l,{size:"sm",children:e._({id:"L1D5PL"})},"fully-allocated"))):s.push(i.jsx(l,{size:"sm",children:e._({id:"PjVOCj"})},"partially-allocated"))),u!=n&&(u>0?s.push(i.jsx(l,{size:"sm",color:"orange",children:e._({id:"csDS2L"})+`: ${u}`},"available")):s.push(i.jsx(l,{size:"sm",color:"red",children:e._({id:"a5n/wL"})},"no-stock"))),n<=0&&s.push(i.jsx(l,{size:"sm",children:e._({id:"ddPzUj"})},"depleted")),k||(a="red"),i.jsx(V,{value:i.jsxs(w,{gap:"xs",justify:"left",wrap:"nowrap",children:[i.jsx(l,{c:a,children:p}),o.units&&i.jsxs(l,{size:"xs",color:a,children:["[",o.units,"]"]})]}),title:e._({id:"odasNw"}),extra:s})}},X({model:r.stockitem}),{accessor:"batch",sortable:!0},Q({accessor:"location_detail"}),h({accessor:"stocktake_date",title:e._({id:"6OScNP"}),sortable:!0}),h({title:e._({id:"uaSvqt"}),accessor:"expiry_date"}),h({title:e._({id:"K7P0jz"}),accessor:"updated"}),{accessor:"purchase_price",sortable:!0,switchable:!0,render:t=>Y(t.purchase_price,{currency:t.purchase_price_currency})},{accessor:"packaging",sortable:!0},{accessor:"stock_value",title:e._({id:"g9RfVq"}),sortable:!1,render:t=>{var p,o;let n=t.purchase_price||((p=t.part_detail)==null?void 0:p.pricing_min),d=t.purchase_price||((o=t.part_detail)==null?void 0:o.pricing_max),u=t.purchase_price_currency||void 0;return J(n,d,{currency:u,multiplier:t.quantity})}},{accessor:"notes",sortable:!1}]}function oe(){return[{name:"active",label:e._({id:"F6pfE9"}),description:e._({id:"UjHL/d"})},{name:"status",label:e._({id:"uAQUqI"}),description:e._({id:"+Jr1e4"}),choiceFunction:M(r.stockitem)},{name:"assembly",label:e._({id:"WL36Yh"}),description:e._({id:"iG2HTd"})},{name:"allocated",label:e._({id:"A/ybx7"}),description:e._({id:"pxiNcZ"})},{name:"available",label:e._({id:"csDS2L"}),description:e._({id:"kbUAFH"})},{name:"cascade",label:e._({id:"VY386J"}),description:e._({id:"fMbOmV"})},{name:"depleted",label:e._({id:"9/P0N3"}),description:e._({id:"0n9TfP"})},{name:"in_stock",label:e._({id:"zn38D/"}),description:e._({id:"oXdFGe"})},{name:"is_building",label:e._({id:"BE5Q6v"}),description:e._({id:"c64azd"})},{name:"include_variants",label:e._({id:"/g9i/Z"}),description:e._({id:"n9gDGi"})},{name:"installed",label:e._({id:"eQkgKV"}),description:e._({id:"GQ73kf"})},{name:"sent_to_customer",label:e._({id:"XwjZor"}),description:e._({id:"LPuYfz"})},{name:"serialized",label:e._({id:"SkCY/+"}),description:e._({id:"S5yS1f"})},{name:"has_batch",label:e._({id:"qPCbMt"}),description:e._({id:"rc/Y1E"})},{name:"tracked",label:e._({id:"EaG6cP"}),description:e._({id:"TRFyJq"})},{name:"has_purchase_price",label:e._({id:"+MprDT"}),description:e._({id:"tAFrkr"})},{name:"external",label:e._({id:"k7rbV9"}),description:e._({id:"ETtRZU"})}]}function be({params:t={},allowAdd:n=!1,tableName:d="stockitems"}){let u=b.useMemo(()=>le(),[]),p=b.useMemo(()=>oe(),[]);const o=F(d),s=N(),a=b.useMemo(()=>({items:o.selectedRecords,model:r.stockitem,refresh:o.refreshTable,filters:{in_stock:!0}}),[o]),k=Z({create:!0}),f=ae({url:v.stock_item_list,title:e._({id:"bJLEQT"}),fields:k,initialData:{part:t.part,location:t.location},follow:!0,modelType:r.stockitem}),x=B(a),j=K(a),S=W(a),g=$(a),C=ee(a),y=te(a),I=ie(a),T=se(a),P=b.useMemo(()=>{let z=s.hasDeleteRole(m.stock),_=s.hasAddRole(m.stock),A=s.hasAddRole(m.stocktake),R=s.hasAddRole(m.purchase_order),q=s.hasChangeRole(m.purchase_order);return[i.jsx(L,{tooltip:e._({id:"bbA1t1"}),icon:i.jsx(c,{icon:"stock"}),disabled:o.selectedRecords.length===0,actions:[{name:e._({id:"vq/m8u"}),icon:i.jsx(c,{icon:"add",iconProps:{color:"green"}}),tooltip:e._({id:"wiTIgC"}),disabled:!_,onClick:()=>{j.open()}},{name:e._({id:"qpe+W0"}),icon:i.jsx(c,{icon:"remove",iconProps:{color:"red"}}),tooltip:e._({id:"vP4ilC"}),disabled:!_,onClick:()=>{S.open()}},{name:"Count Stock",icon:i.jsx(c,{icon:"stocktake",iconProps:{color:"blue"}}),tooltip:"Count Stock",disabled:!A,onClick:()=>{g.open()}},{name:e._({id:"+OxnAC"}),icon:i.jsx(c,{icon:"transfer",iconProps:{color:"blue"}}),tooltip:e._({id:"lgwXs+"}),disabled:!_,onClick:()=>{x.open()}},{name:e._({id:"E6cz5z"}),icon:i.jsx(c,{icon:"info",iconProps:{color:"blue"}}),tooltip:e._({id:"/gndGd"}),disabled:!_,onClick:()=>{C.open()}},{name:e._({id:"3iu3Xl"}),icon:i.jsx(c,{icon:"merge"}),tooltip:e._({id:"V22osk"}),disabled:!_,onClick:()=>{y.open()}},{name:e._({id:"G4SnGh"}),icon:i.jsx(c,{icon:"buy"}),tooltip:e._({id:"iihIqf"}),disabled:!R||!q,onClick:H},{name:e._({id:"chR2IB"}),icon:i.jsx(c,{icon:"customer"}),tooltip:e._({id:"iihIqf"}),disabled:!_,onClick:()=>{I.open()}},{name:e._({id:"6vqSiF"}),icon:i.jsx(c,{icon:"delete",iconProps:{color:"red"}}),tooltip:e._({id:"y5SdJc"}),disabled:!z,onClick:()=>{T.open()}}]}),i.jsx(D,{hidden:!n||!s.hasAddRole(m.stock),tooltip:e._({id:"bJLEQT"}),onClick:()=>f.open()})]},[s,o,n]);return i.jsxs(i.Fragment,{children:[f.modal,x.modal,S.modal,j.modal,g.modal,C.modal,y.modal,I.modal,T.modal,i.jsx(E,{url:O(v.stock_item_list),tableState:o,columns:u,props:{enableDownload:!0,enableSelection:!0,enableLabels:!0,enableReports:!0,tableFilters:p,tableActions:P,modelType:r.stockitem,params:{...t,part_detail:!0,location_detail:!0,supplier_part_detail:!0}}})]})}export{be as S};
