import{r as t,j as c,_ as j,aW as y,a7 as F,ax as v,aD as g,aG as E,aH as M,i as s,S as R,bd as T,m as I}from"./vendor-B0vSnHFf.js";import{A as U}from"./AddItemButton-CD0U_4gd.js";import{a as O,S as k,R as A,P as D,c as P,C as q,T as B,j as L,e as V}from"./ColumnRenderers-CwItNORh.js";import{h as w}from"./Instance-Co8OMzcE.js";import{s as G,d as W,e as C,A as f,M as h,a as Q,U as N}from"./index-CDdQlqFV.js";import{Y as H,S as X,u as Y,I as K}from"./InvenTreeTable-D26a1r6-.js";import{A as $}from"./ActionButton-Br0cBRLA.js";import{I as z}from"./BaseContext-DSwOqL9e.js";import{a as S}from"./UseForm-BimrM1zK.js";import{u as J}from"./UseGenerator-C7bjPlPb.js";import{u as Z,a as ee}from"./UseFilter-Blar5lCV.js";function te({create:e}){const[r,u]=t.useState(null),[o,d]=t.useState(""),i=J(n=>{o||d(n)}),p=G();return t.useMemo(()=>{let n={reference:{},part:{disabled:!e,filters:{assembly:!0,virtual:!1,active:p.isSet("BUILDORDER_REQUIRE_ACTIVE_PART")?!0:void 0,locked:p.isSet("BUILDORDER_REQUIRE_LOCKED_PART")?!0:void 0},onValueChange(a,m){m&&u(m.default_location||m.category_default_location),i.update({part:a})}},title:{},quantity:{},project_code:{icon:c.jsx(j,{})},priority:{},parent:{icon:c.jsx(y,{}),filters:{part_detail:!0}},sales_order:{icon:c.jsx(F,{})},batch:{value:o,onValueChange:a=>d(a)},target_date:{icon:c.jsx(v,{})},take_from:{},destination:{filters:{structural:!1},value:r},link:{icon:c.jsx(g,{})},issued_by:{icon:c.jsx(E,{}),filters:{is_active:!0}},responsible:{icon:c.jsx(M,{}),filters:{is_active:!0}}};return e&&(n.create_child_builds={}),n},[e,r,o,p])}function me({build:e}){const r=t.useMemo(()=>{var a;return((a=e.part_detail)==null?void 0:a.trackable)??!1},[e.part_detail]),[u,o]=t.useState(null);t.useEffect(()=>{var a;o(e.location||((a=e.part_detail)==null?void 0:a.default_location)||null)},[e.location,e.part_detail]);const[d,i]=t.useState(0);t.useEffect(()=>{let a=e.quantity??0,m=e.completed??0;i(Math.max(0,a-m))},[e]);const[p,n]=t.useState("");return t.useEffect(()=>{r?W.get(C(f.part_serial_numbers,e.part_detail.pk)).then(a=>{var m,l;(m=a.data)!=null&&m.next?n(s._({id:"TVYdHj"})+" - "+a.data.next):(l=a.data)!=null&&l.latest?n(s._({id:"S1C0yM"})+" - "+a.data.latest):n("")}).catch(()=>{n("")}):n("")},[e,r]),t.useMemo(()=>({quantity:{value:d,onValueChange:a=>{i(a)}},serial_numbers:{hidden:!r,placeholder:p},batch_code:{},location:{value:u,onValueChange:a=>{i(a)}},auto_allocate:{hidden:!r}}),[d,p,r])}function x(e,r){return c.jsx(H,{idAccessor:"pk",records:e,columns:[{accessor:"part",title:s._({id:"vgP+9p"}),render:u=>O(u.part_detail)},{accessor:"quantity",title:s._({id:"VbWX2u"}),render:u=>u.serial?`# ${u.serial}`:u.quantity},k({model:h.stockitem,sortable:!1}),{accessor:"actions",title:"",render:u=>c.jsx($,{tooltip:s._({id:"GyFGex"}),icon:c.jsx(z,{icon:"cancel"}),color:"red",onClick:()=>r(u),disabled:e.length<=1},`remove-output-${u.pk}`)}]})}function _e({build:e,outputs:r,onFormSuccess:u}){const[o,d]=t.useState([]),[i,p]=t.useState(null);t.useEffect(()=>{d(r)},[r]),t.useEffect(()=>{var l;i||p(e.destination||((l=e.part_detail)==null?void 0:l.default_location)||null)},[i,e.destination,e.part_detail]);const n=t.useCallback(l=>{d(o.filter(b=>b.pk!=l.pk))},[o]),a=t.useMemo(()=>x(o,n),[o,n]),m=t.useMemo(()=>({outputs:{hidden:!0,value:o.map(l=>({output:l.pk}))},status_custom_key:{},location:{filters:{structural:!1},value:i,onValueChange:l=>{p(l)}},notes:{},accept_incomplete_allocation:{}}),[o,i]);return S({url:C(f.build_output_complete,e.pk),method:"POST",title:s._({id:"0iR9fu"}),fields:m,onFormSuccess:u,preFormContent:a,successMessage:s._({id:"N3avUJ"})})}function fe({build:e,outputs:r,onFormSuccess:u}){const[o,d]=t.useState(null),[i,p]=t.useState([]);t.useEffect(()=>{p(r)},[r]);const n=t.useCallback(l=>{p(i.filter(b=>b.pk!=l.pk))},[i]);t.useEffect(()=>{var l;o||d(e.destination||((l=e.part_detail)==null?void 0:l.default_location)||null)},[o,e.destination,e.part_detail]);const a=t.useMemo(()=>x(i,n),[i,n]),m=t.useMemo(()=>({outputs:{hidden:!0,value:i.map(l=>({output:l.pk,quantity:l.quantity}))},location:{value:o,onValueChange:l=>{d(l)}},notes:{},discard_allocations:{}}),[o,i]);return S({url:C(f.build_output_scrap,e.pk),method:"POST",title:s._({id:"69qbY/"}),fields:m,onFormSuccess:u,preFormContent:a,successMessage:s._({id:"C+tSd4"})})}function be({build:e,outputs:r,onFormSuccess:u}){const[o,d]=t.useState([]);t.useEffect(()=>{d(r)},[r]);const i=t.useCallback(a=>{d(o.filter(m=>m.pk!=a.pk))},[o]),p=t.useMemo(()=>c.jsxs(R,{gap:"xs",children:[c.jsx(T,{color:"red",title:s._({id:"xS5DxW"}),children:c.jsx(I,{children:s._({id:"duNUx4"})})}),x(o,i)]}),[o,i]),n=t.useMemo(()=>({outputs:{hidden:!0,value:o.map(a=>({output:a.pk}))}}),[o]);return S({url:C(f.build_output_delete,e.pk),method:"POST",title:s._({id:"xS5DxW"}),fields:n,preFormContent:p,onFormSuccess:u,successMessage:s._({id:"cdFWk4"})})}function he({partId:e,parentBuildId:r,salesOrderId:u}){const o=t.useMemo(()=>[A({}),{accessor:"part",sortable:!0,switchable:!1,render:_=>O(_.part_detail)},{accessor:"part_detail.IPN",sortable:!0,switchable:!0,title:s._({id:"3wXEsN"})},{accessor:"title",sortable:!1},{accessor:"completed",sortable:!0,switchable:!1,render:_=>c.jsx(D,{progressLabel:!0,value:_.completed,maximum:_.quantity})},k({model:h.build}),P({}),{accessor:"level",sortable:!0,switchable:!0,hidden:!r},{accessor:"priority",sortable:!0},q({}),B({}),L({accessor:"completion_date",sortable:!0}),{accessor:"issued_by",sortable:!0,render:_=>c.jsx(w,{instance:_==null?void 0:_.issued_by_detail})},V({})],[r]),d=Z(),i=ee(),p=t.useMemo(()=>[{name:"active",type:"boolean",label:s._({id:"F6pfE9"}),description:s._({id:"Or8Url"})},{name:"status",label:s._({id:"uAQUqI"}),description:s._({id:"OIH7WF"}),choiceFunction:X(h.build)},{name:"overdue",label:s._({id:"ddrz1m"}),type:"boolean",description:s._({id:"bWsuU0"})},{name:"assigned_to_me",type:"boolean",label:s._({id:"iU3XRS"}),description:s._({id:"BnF3ID"})},{name:"project_code",label:s._({id:"Sdfr6G"}),description:s._({id:"8sHFLc"}),choices:d.choices},{name:"has_project_code",label:s._({id:"e7gdBS"}),description:s._({id:"IuQlCq"})},{name:"issued_by",label:s._({id:"kmUN8p"}),description:s._({id:"OEh/FL"}),choices:i.choices},{name:"assigned_to",label:s._({id:"XQACoK"}),description:s._({id:"OVVPn5"}),choices:i.choices}],[r,d.choices,i.choices]),n=Q(),a=Y("buildorder"),m=te({create:!0}),l=S({url:f.build_order_list,title:s._({id:"59jtLx"}),fields:m,initialData:{part:e,sales_order:u,parent:r},follow:!0,modelType:h.build}),b=t.useMemo(()=>[c.jsx(U,{hidden:!n.hasAddRole(N.build),tooltip:s._({id:"59jtLx"}),onClick:()=>l.open()},"add-build-order")],[n]);return c.jsxs(c.Fragment,{children:[l.modal,c.jsx(K,{url:C(f.build_order_list),tableState:a,columns:o,props:{params:{part:e,ancestor:r,part_detail:!0},tableActions:b,tableFilters:p,modelType:h.build,enableSelection:!0,enableReports:!0,enableDownload:!0}})]})}export{he as B,me as a,_e as b,fe as c,be as d,te as u};
