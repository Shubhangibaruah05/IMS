import{r as n,i as a,j as t,af as U,ay as G,S as L,c4 as J,G as D,e4 as S,ag as V,m as _,b9 as Z,n as T}from"./vendor-B0vSnHFf.js";import{a as h}from"./NotesEditor-DCyldUZp.js";import{a as B,e as Q,A as Y,d as q}from"./index-CDdQlqFV.js";import{A as v}from"./ActionButton-Br0cBRLA.js";import{A as w}from"./AttachmentLink-CL1ofkZf.js";import{f as H}from"./ColumnRenderers-CwItNORh.js";import{a as K,u as O,b as W}from"./UseForm-BimrM1zK.js";import{u as X,R as $,a as y,I as N}from"./InvenTreeTable-D26a1r6-.js";function ee(){return[{accessor:"attachment",sortable:!1,switchable:!1,noWrap:!0,render:e=>e.attachment?t.jsx(w,{attachment:e.attachment}):e.link?t.jsx(w,{attachment:e.link,external:!0}):"-"},{accessor:"comment",sortable:!1,render:e=>e.comment},{accessor:"upload_date",sortable:!0,render:e=>t.jsxs(D,{justify:"space-between",children:[t.jsx(_,{children:e.upload_date}),e.user_detail&&t.jsx(Z,{size:"xs",children:e.user_detail.username})]})},{accessor:"file_size",sortable:!0,switchable:!0,render:e=>e.attachment?H(e.file_size):"-"}]}function ce({model_type:e,model_id:o}){const r=B(),i=X(`${e}-attachments`),C=n.useMemo(()=>ee(),[]),l=Q(Y.attachment_list),b=n.useMemo(()=>o>0,[o]),[I,j]=n.useState(!1),M=n.useMemo(()=>r.hasAddPermission(e),[r,e]);function E(s){s.forEach(x=>{let m=new FormData;m.append("attachment",x),m.append("model_type",e),m.append("model_id",o.toString()),j(!0),q.post(l,m).then(u=>(T.show({title:a._({id:"FJqE4H"}),message:a._({id:"3LxYDr",values:{0:x.name}}),color:"green"}),i.refreshTable(),u)).catch(u=>(console.error("error uploading attachment:",x,"->",u),T.show({title:a._({id:"ae3dey"}),message:a._({id:"GZnmeE"}),color:"red"}),u)).finally(()=>{j(!1)})})}const[p,A]=n.useState("attachment"),[c,d]=n.useState(void 0),k=n.useMemo(()=>{let s={model_type:{value:e,hidden:!0},model_id:{value:o,hidden:!0},attachment:{},link:{},comment:{}};return p!="link"&&delete s.link,(p!="attachment"||c)&&delete s.attachment,s},[e,o,p,c]),f=K({url:l,title:a._({id:"p1w/D6"}),fields:k,onFormSuccess:()=>{i.refreshTable()}}),g=O({url:l,pk:c,title:a._({id:"MVvhJ1"}),fields:k,onFormSuccess:s=>{s.pk?i.updateRecord(s):i.refreshTable()}}),F=W({url:l,pk:c,title:a._({id:"hZfPb3"}),onFormSuccess:()=>{i.refreshTable()}}),z=n.useMemo(()=>[{name:"is_link",label:a._({id:"3QegpG"}),description:a._({id:"r1FQZj"})},{name:"is_file",label:a._({id:"JT83gz"}),description:a._({id:"5LI39K"})}],[]),P=n.useMemo(()=>[t.jsx(v,{tooltip:a._({id:"V8euYO"}),hidden:!r.hasAddPermission(e),icon:t.jsx(U,{}),onClick:()=>{A("attachment"),d(void 0),f.open()}},"add-attachment"),t.jsx(v,{tooltip:a._({id:"DpV4ac"}),hidden:!r.hasAddPermission(e),icon:t.jsx(G,{}),onClick:()=>{A("link"),d(void 0),f.open()}},"add-external-link")],[r,e]),R=n.useCallback(s=>[$({hidden:!r.hasChangePermission(e),onClick:()=>{d(s.pk),g.open()}}),y({hidden:!r.hasDeletePermission(e),onClick:()=>{d(s.pk),F.open()}})],[r,e]);return t.jsxs(t.Fragment,{children:[f.modal,g.modal,F.modal,t.jsxs(L,{gap:"xs",children:[b&&t.jsx(N,{url:l,tableState:i,columns:C,props:{noRecordsText:a._({id:"32o8IC"}),enableSelection:!0,tableActions:P,tableFilters:z,rowActions:R,params:{model_type:e,model_id:o}}},"attachment-table"),M&&b&&t.jsx(J,{p:"md",shadow:"xs",radius:"md",children:t.jsx(h,{onDrop:E,loading:I,children:t.jsxs(D,{justify:"center",gap:"lg",mih:100,children:[t.jsx(h.Accept,{children:t.jsx(S,{style:{color:"var(--mantine-color-blue-6)"},stroke:1.5})}),t.jsx(h.Reject,{children:t.jsx(V,{style:{color:"var(--mantine-color-red-6)"},stroke:1.5})}),t.jsx(h.Idle,{children:t.jsx(S,{style:{color:"var(--mantine-color-dimmed)"},stroke:1.5})}),t.jsx(_,{size:"sm",children:a._({id:"1cbxaa"})})]})},"attachment-dropzone")})]})]})}export{ce as A};
