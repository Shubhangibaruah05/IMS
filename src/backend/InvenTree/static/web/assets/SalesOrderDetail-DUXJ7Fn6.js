import{r as m,i as s,j as t,m as L,eD as oe,O as Q,P as ne,a7 as J,bK as W,cY as q,z as re,_ as de,bf as D,ey as ce,ac as me,ad as pe,aL as ue,S as _e}from"./vendor-B0vSnHFf.js";import{A as he}from"./AdminButton-Cl1ixKQi.js";import{P as B}from"./PrimaryActionButton-C__mfMnP.js";import{u as $,R as ee,f as xe,a as se,I as te,B as be,P as ke,A as fe,E as ge,d as ye,H as je,C as Se}from"./InvenTreeTable-D26a1r6-.js";import{I as Ce,D as N,a as Ie}from"./InstanceDetail-Cejekc8J.js";import{D as Ae,N as De}from"./NotesEditor-DCyldUZp.js";import{S as Y}from"./StylishText-CrpvZzAV.js";import{P as Pe}from"./PageDetail-B4PsctWo.js";import{P as Fe}from"./PanelGroup-DRVQKYn0.js";import{S as Re}from"./Instance-Co8OMzcE.js";import{a as Ee,d as G,j as K,g as we,P as V,L as ae,N as Oe}from"./ColumnRenderers-CwItNORh.js";import{a as z,A as o,M as c,U as r,w as U,e as F,s as Te}from"./index-CDdQlqFV.js";import{b as Z,c as X,a as Le}from"./SalesOrderForms-BD5fZ2Wy.js";import{a as j,u as H,b as ie}from"./UseForm-BimrM1zK.js";import{u as Ne}from"./UseInstance-Bcp_oSAZ.js";import{u as ve}from"./UseStatusCodes-FmkSIrlp.js";import{u as Me,B as qe}from"./BuildOrderTable-bQe5ddnA.js";import{A as Be}from"./AttachmentTable-Mxcn-H07.js";import{E as Ge}from"./ExtraLineItemTable-COgtfa1u.js";import{S as Ke}from"./SalesOrderAllocationTable-kY828FjS.js";import{A as le}from"./AddItemButton-CD0U_4gd.js";import{d as Ue}from"./DesktopAppView-CofLSp00.js";import"./ActionButton-Br0cBRLA.js";import"./BaseContext-DSwOqL9e.js";import"./Boundary-CysPC9mI.js";import"./YesNoButton-1B57tnbm.js";import"./GenericErrorPage-BifXQa91.js";import"./NotFound-DXIcBWRy.js";import"./PermissionDenied-Cl_T9Vqt.js";import"./UseGenerator-C7bjPlPb.js";import"./UseFilter-Blar5lCV.js";import"./AttachmentLink-CL1ofkZf.js";import"./CommonForms-B4xIycy4.js";function ze({orderId:u,currency:d,customerId:h,editable:e}){const l=z(),_=$("sales-order-line-item"),R=m.useMemo(()=>[{accessor:"part",sortable:!0,switchable:!1,render:a=>Ee(a==null?void 0:a.part_detail)},{accessor:"part_detail.IPN",title:s._({id:"3wXEsN"}),switchable:!0},{accessor:"part_detail.description",title:s._({id:"Nu4oKW"}),sortable:!1,switchable:!0},{accessor:"reference",sortable:!1,switchable:!0},{accessor:"quantity",sortable:!0},{accessor:"sale_price",render:a=>G(a.sale_price,{currency:a.sale_price_currency})},{accessor:"total_price",title:s._({id:"KyZVKD"}),render:a=>G(a.sale_price,{currency:a.sale_price_currency,multiplier:a.quantity})},K({accessor:"target_date",sortable:!0,title:s._({id:"ZmykKo"})}),{accessor:"stock",title:s._({id:"oGd3rK"}),render:a=>{let n=(a==null?void 0:a.available_stock)??0,b=(a==null?void 0:a.available_variant_stock)??0,x=n+b,w=Math.max(a.quantity-a.allocated-a.shipped,0),y,A=`${x}`,T=[];return x<=0?(y="red",A=s._({id:"a5n/wL"})):x<w&&(y="orange"),b>0&&T.push(t.jsx(L,{size:"sm",children:s._({id:"LdvJ9e"})})),a.building>0&&T.push(t.jsxs(L,{size:"sm",children:[s._({id:"G1xXyB"}),": ",a.building]})),a.on_order>0&&T.push(t.jsxs(L,{size:"sm",children:[s._({id:"/MB+gl"}),": ",a.on_order]})),t.jsx(we,{value:t.jsx(L,{color:y,children:A}),extra:T,title:s._({id:"odasNw"})})}},{accessor:"allocated",render:a=>t.jsx(V,{progressLabel:!0,value:a.allocated,maximum:a.quantity})},{accessor:"shipped",render:a=>t.jsx(V,{progressLabel:!0,value:a.shipped,maximum:a.quantity})},{accessor:"notes"},ae({accessor:"link"})],[]),[k,S]=m.useState(0),[i,f]=m.useState({}),C=Z({orderId:u,customerId:h,create:!0}),g=j({url:o.sales_order_line_list,title:s._({id:"pwb7Yo"}),fields:C,initialData:{...i,sale_price_currency:d},table:_}),E=Z({orderId:u,customerId:h,create:!1}),p=H({url:o.sales_order_line_list,pk:k,title:s._({id:"vgosWS"}),fields:E,table:_}),I=ie({url:o.sales_order_line_list,pk:k,title:s._({id:"tpKh8C"}),table:_}),O=Me({create:!0}),P=j({url:o.build_order_list,title:s._({id:"UcPKar"}),fields:O,initialData:i,follow:!0,modelType:c.build}),v=m.useMemo(()=>[t.jsx(le,{tooltip:s._({id:"2vqtLo"}),onClick:()=>{f({order:u}),g.open()},hidden:!e||!l.hasAddRole(r.sales_order)})],[l,u]),M=m.useCallback(a=>{var b,x;const n=((a==null?void 0:a.allocated)??0)>((a==null?void 0:a.quantity)??0);return[{hidden:n||!e||!l.hasChangeRole(r.sales_order),title:s._({id:"/x4Ue4"}),icon:t.jsx(oe,{}),color:"green",onClick:U},{hidden:n||!l.hasAddRole(r.build)||!((b=a==null?void 0:a.part_detail)!=null&&b.assembly),title:s._({id:"NH34YB"}),icon:t.jsx(Q,{}),color:"blue",onClick:()=>{f({part:a.part,quantity:((a==null?void 0:a.quantity)??1)-((a==null?void 0:a.allocated)??0),sales_order:u}),P.open()}},{hidden:n||!l.hasAddRole(r.purchase_order)||!((x=a==null?void 0:a.part_detail)!=null&&x.purchaseable),title:s._({id:"G4SnGh"}),icon:t.jsx(ne,{}),color:"blue",onClick:U},ee({hidden:!e||!l.hasChangeRole(r.sales_order),onClick:()=>{S(a.pk),p.open()}}),xe({hidden:!e||!l.hasAddRole(r.sales_order),onClick:()=>{f(a),g.open()}}),se({hidden:!e||!l.hasDeleteRole(r.sales_order),onClick:()=>{S(a.pk),I.open()}})]},[l,e]);return t.jsxs(t.Fragment,{children:[p.modal,I.modal,g.modal,P.modal,t.jsx(te,{url:F(o.sales_order_line_list),tableState:_,columns:R,props:{enableSelection:!0,enableDownload:!0,params:{order:u,part_detail:!0},rowActions:M,tableActions:v,modelType:c.part,modelField:"part"}})]})}function He({orderId:u}){const d=z(),h=$("sales-order-shipment"),[e,l]=m.useState(0),_=X(),R=X(),k=j({url:o.sales_order_shipment_list,fields:_,title:s._({id:"qU3Y7+"}),table:h,initialData:{order:u}}),S=ie({url:o.sales_order_shipment_list,pk:e,title:s._({id:"GicrKZ"}),table:h}),i=H({url:o.sales_order_shipment_list,pk:e,fields:R,title:s._({id:"rX/5YH"}),table:h}),f=m.useMemo(()=>[{accessor:"reference",title:s._({id:"Dwgrby"}),switchable:!1},{accessor:"allocations",title:s._({id:"BzfzPK"}),render:p=>((p==null?void 0:p.allocations)??[]).length},K({accessor:"shipment_date",title:s._({id:"MFQxyA"})}),K({accessor:"delivery_date",title:s._({id:"ovm9ir"})}),{accessor:"tracking_number"},{accessor:"invoice_number"},ae({accessor:"link"}),Oe({accessor:"notes"})],[]),C=m.useCallback(p=>[{hidden:!!p.shipment_date||!d.hasChangeRole(r.sales_order),title:s._({id:"/IxVda"}),icon:t.jsx(J,{}),onClick:U},ee({hidden:!d.hasChangeRole(r.sales_order),onClick:()=>{l(p.pk),i.open()}}),se({hidden:!d.hasDeleteRole(r.sales_order),onClick:()=>{l(p.pk),S.open()}})],[d]),g=m.useMemo(()=>[t.jsx(le,{tooltip:s._({id:"77d67d"}),hidden:!d.hasAddRole(r.sales_order),onClick:()=>{k.open()}})],[d]),E=m.useMemo(()=>[{name:"shipped",label:s._({id:"AoOqHM"}),description:s._({id:"zxYkrg"})},{name:"delivered",label:s._({id:"BTOhSm"}),description:s._({id:"DOexmc"})}],[]);return t.jsxs(t.Fragment,{children:[k.modal,i.modal,S.modal,t.jsx(te,{url:F(o.sales_order_shipment_list),tableState:h,columns:f,props:{tableActions:g,tableFilters:E,rowActions:C,params:{order:u}}})]})}function Is(){var a;const{id:u}=Ue(),d=z(),h=Te(),{instance:e,instanceQuery:l,refreshInstance:_,requestStatus:R}=Ne({endpoint:o.sales_order_list,pk:u,params:{customer_detail:!0}}),k=m.useMemo(()=>{var n;return e.order_currency||((n=e.customer_detail)==null?void 0:n.currency)||h.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,h]),S=m.useMemo(()=>{var y;if(l.isFetching)return t.jsx(W,{});let n=[{type:"text",name:"reference",label:s._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:s._({id:"ZVUe1A"}),copy:!0,hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:s._({id:"876pfE"}),model:c.company},{type:"text",name:"description",label:s._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:s._({id:"uAQUqI"}),model:c.salesorder}],b=[{type:"progressbar",name:"completed",icon:"progress",label:s._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"progressbar",name:"shipments",icon:"shipment",label:s._({id:"polrQd"}),total:e.shipments,progress:e.completed_shipments,hidden:!e.shipments},{type:"text",name:"currency",label:s._({id:"0UZTSq"}),value_formatter:()=>(e==null?void 0:e.order_currency)??(e==null?void 0:e.customer_detail.currency)},{type:"text",name:"total_price",label:s._({id:"A6C0pv"}),value_formatter:()=>{var A;return G(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)??((A=e==null?void 0:e.customer_detail)==null?void 0:A.currency)})}}],x=[{type:"link",external:!0,name:"link",label:s._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"link",model:c.contact,link:!1,name:"contact",label:s._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact}],w=[{type:"text",name:"creation_date",label:s._({id:"x9P/+F"}),icon:"calendar"},{type:"text",name:"target_date",label:s._({id:"ZmykKo"}),icon:"calendar",hidden:!e.target_date},{type:"text",name:"responsible",label:s._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}];return t.jsxs(Ce,{children:[t.jsxs(q,{children:[t.jsx(q.Col,{span:4,children:t.jsx(Ae,{appRole:r.purchase_order,apiPath:o.company_list,src:(y=e.customer_detail)==null?void 0:y.image,pk:e.customer})}),t.jsx(q.Col,{span:8,children:t.jsx(N,{fields:n,item:e})})]}),t.jsx(N,{fields:b,item:e}),t.jsx(N,{fields:x,item:e}),t.jsx(N,{fields:w,item:e})]})},[e,l]),i=ve({modelType:c.salesorder}),f=Le(),C=H({url:o.sales_order_list,pk:e.pk,title:s._({id:"nEK4wx"}),fields:f,onFormSuccess:()=>{_()}}),g=j({url:o.sales_order_list,title:s._({id:"VzdnWM"}),fields:f,initialData:{...e,reference:void 0},follow:!0,modelType:c.salesorder}),E=m.useMemo(()=>[{name:"detail",label:s._({id:"Tol4BF"}),icon:t.jsx(re,{}),content:S},{name:"line-items",label:s._({id:"SgduFH"}),icon:t.jsx(de,{}),content:t.jsxs(D,{multiple:!0,defaultValue:["line-items","extra-items"],children:[t.jsxs(D.Item,{value:"line-items",children:[t.jsx(D.Control,{children:t.jsx(Y,{size:"lg",children:s._({id:"SgduFH"})})}),t.jsx(D.Panel,{children:t.jsx(ze,{orderId:e.pk,currency:k,customerId:e.customer,editable:e.status!=i.COMPLETE&&e.status!=i.CANCELLED})})]},"lineitems"),t.jsxs(D.Item,{value:"extra-items",children:[t.jsx(D.Control,{children:t.jsx(Y,{size:"lg",children:s._({id:"l11DG/"})})}),t.jsx(D.Panel,{children:t.jsx(Ge,{endpoint:o.sales_order_extra_line_list,orderId:e.pk,currency:k,role:r.sales_order})})]},"extraitems")]})},{name:"shipments",label:s._({id:"aljM0q"}),icon:t.jsx(J,{}),content:t.jsx(He,{orderId:e.pk})},{name:"allocations",label:s._({id:"MD2yP5"}),icon:t.jsx(ce,{}),content:t.jsx(Ke,{orderId:e.pk,showPartInfo:!0,allowEdit:!0,modelField:"item",modelTarget:c.stockitem})},{name:"build-orders",label:s._({id:"RCVhIP"}),icon:t.jsx(Q,{}),content:e!=null&&e.pk?t.jsx(qe,{salesOrderId:e.pk}):t.jsx(W,{})},{name:"attachments",label:s._({id:"w/Sphq"}),icon:t.jsx(me,{}),content:t.jsx(Be,{model_type:c.salesorder,model_id:e.pk})},{name:"notes",label:s._({id:"1DBGsz"}),icon:t.jsx(pe,{}),content:t.jsx(De,{modelType:c.salesorder,modelId:e.pk,editable:d.hasChangeRole(r.sales_order)})}],[e,u,d,i]),p=j({url:F(o.sales_order_issue,e.pk),title:s._({id:"Zk75Wf"}),onFormSuccess:_,preFormWarning:s._({id:"lLiNZC"}),successMessage:s._({id:"R/WvFK"})}),I=j({url:F(o.sales_order_cancel,e.pk),title:s._({id:"GYdhXE"}),onFormSuccess:_,preFormWarning:s._({id:"MPFqR0"}),successMessage:s._({id:"H5qWhm"})}),O=j({url:F(o.sales_order_hold,e.pk),title:s._({id:"Pgi6wT"}),onFormSuccess:_,preFormWarning:s._({id:"3Wfk51"}),successMessage:s._({id:"0NH/ob"})}),P=j({url:F(o.sales_order_complete,e.pk),title:s._({id:"O1h5Uc"}),onFormSuccess:_,preFormWarning:s._({id:"DYITap"}),successMessage:s._({id:"W7TghJ"}),fields:{accept_incomplete:{}}}),v=m.useMemo(()=>{const n=d.hasChangeRole(r.sales_order),b=n&&(e.status==i.PENDING||e.status==i.ON_HOLD),x=n&&(e.status==i.PENDING||e.status==i.ON_HOLD||e.status==i.IN_PROGRESS),w=n&&(e.status==i.PENDING||e.status==i.IN_PROGRESS),y=n&&e.status==i.IN_PROGRESS,A=n&&e.status==i.SHIPPED;return[t.jsx(B,{title:s._({id:"WajCDs"}),icon:"issue",hidden:!b,color:"blue",onClick:p.open}),t.jsx(B,{title:s._({id:"7I7mfp"}),icon:"deliver",hidden:!y,color:"blue",onClick:P.open}),t.jsx(B,{title:s._({id:"NPZqBL"}),icon:"complete",hidden:!A,color:"green",onClick:P.open}),t.jsx(he,{model:c.salesorder,pk:e.pk}),t.jsx(be,{model:c.salesorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),t.jsx(ke,{modelType:c.salesorder,items:[e.pk],enableReports:!0}),t.jsx(fe,{tooltip:s._({id:"/IKytX"}),icon:t.jsx(ue,{}),actions:[ge({hidden:!n,onClick:C.open,tooltip:s._({id:"mVeaUg"})}),ye({hidden:!d.hasAddRole(r.sales_order),onClick:g.open,tooltip:s._({id:"oi/3Pq"})}),je({tooltip:s._({id:"20mLBC"}),hidden:!w,onClick:O.open}),Se({tooltip:s._({id:"tVJk4q"}),hidden:!x,onClick:I.open})]})]},[d,e,i]),M=m.useMemo(()=>l.isLoading?[]:[t.jsx(Re,{status:e.status_custom_key,type:c.salesorder,options:{size:"lg"}},e.pk)],[e,l]);return t.jsxs(t.Fragment,{children:[p.modal,I.modal,O.modal,P.modal,C.modal,g.modal,t.jsx(Ie,{status:R,loading:l.isFetching,children:t.jsxs(_e,{gap:"xs",children:[t.jsx(Pe,{title:s._({id:"LozYBo"})+`: ${e.reference}`,subtitle:e.description,imageUrl:(a=e.customer_detail)==null?void 0:a.image,badges:M,actions:v,breadcrumbs:[{name:s._({id:"mUv9U4"}),url:"/sales/"}],editAction:C.open,editEnabled:d.hasChangePermission(c.salesorder)}),t.jsx(Fe,{pageKey:"salesorder",panels:E})]})})]})}export{Is as default};
