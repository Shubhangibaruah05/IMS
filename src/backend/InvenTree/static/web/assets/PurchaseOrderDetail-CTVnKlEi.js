import{r as c,i as t,j as s,m as B,eD as G,en as te,bK as se,cY as U,z as ae,_ as ie,bf as y,H as re,ac as le,ad as ne,aL as oe,S as ce}from"./vendor-B0vSnHFf.js";import{A as de}from"./AdminButton-Cl1ixKQi.js";import{P as H}from"./PrimaryActionButton-C__mfMnP.js";import{u as pe,R as ue,f as me,a as _e,I as he,B as fe,P as xe,A as be,E as ye,d as ge,H as ke,C as Ce}from"./InvenTreeTable-D26a1r6-.js";import{I as je,D as O,a as Ae}from"./InstanceDetail-Cejekc8J.js";import{D as Se,N as Pe}from"./NotesEditor-DCyldUZp.js";import{S as V}from"./StylishText-CrpvZzAV.js";import{P as Ie}from"./PageDetail-B4PsctWo.js";import{P as De}from"./PanelGroup-DRVQKYn0.js";import{l as Re,S as ve}from"./Instance-Co8OMzcE.js";import{a as Fe,R as Le,g as Te,P as Ee,n as Ne,o as qe,T as Me,N as Oe,L as We,d as we}from"./ColumnRenderers-CwItNORh.js";import{a as Q,M as o,A as d,U as _,e as F,s as Ke}from"./index-CDdQlqFV.js";import{a as Ue,b as z,u as Be}from"./PurchaseOrderForms-VnPQAsDv.js";import{a as g,u as Z,b as Ge}from"./UseForm-BimrM1zK.js";import{u as He}from"./UseInstance-Bcp_oSAZ.js";import{u as J}from"./UseStatusCodes-FmkSIrlp.js";import{A as Ve}from"./AttachmentTable-Mxcn-H07.js";import{E as ze}from"./ExtraLineItemTable-COgtfa1u.js";import{A as X}from"./ActionButton-Br0cBRLA.js";import{A as Xe}from"./AddItemButton-CD0U_4gd.js";import{I as Qe,d as Ze}from"./ImporterForms-Bk-qT70E.js";import{S as Je}from"./StockItemTable-Cop_NVCl.js";import{d as Ye}from"./DesktopAppView-CofLSp00.js";import"./BaseContext-DSwOqL9e.js";import"./Boundary-CysPC9mI.js";import"./YesNoButton-1B57tnbm.js";import"./GenericErrorPage-BifXQa91.js";import"./NotFound-DXIcBWRy.js";import"./PermissionDenied-Cl_T9Vqt.js";import"./UseGenerator-C7bjPlPb.js";import"./AttachmentLink-CL1ofkZf.js";import"./CommonForms-B4xIycy4.js";import"./StockForms-DLBgZVBa.js";function $e({order:r,orderId:l,currency:L,supplierId:e,params:f}){const n=pe("purchase-order-line-item"),p=Q(),[T,I]=c.useState(!1),[k,D]=c.useState(void 0),W=c.useMemo(()=>{var i;let a=Ze();return a.model_type.hidden=!0,a.model_type.value=o.purchaseorderlineitem,a.field_overrides.value={order:l},a.field_defaults.value={purchase_price_currency:(r==null?void 0:r.order_currency)||((i=r==null?void 0:r.supplier_detail)==null?void 0:i.currency)||void 0},a.field_filters.value={part:{supplier:e,active:!0}},a},[r,l,e]),E=g({url:d.import_session_list,title:t._({id:"yWWRAr"}),fields:W,onFormSuccess:a=>{D(a.pk),I(!0)}}),[m,R]=c.useState(null),C=Ue({items:m?[m]:n.selectedRecords,orderPk:l,formProps:{onClose:()=>{n.refreshTable(),setTimeout(()=>R(null),500)}}}),N=c.useMemo(()=>[{accessor:"part",title:t._({id:"GNd5ad"}),sortable:!0,switchable:!1,render:a=>Fe(a.part_detail)},{accessor:"description",title:t._({id:"5ZWiLz"}),sortable:!1,render:a=>{var i;return(i=a==null?void 0:a.part_detail)==null?void 0:i.description}},Le({}),{accessor:"quantity",title:t._({id:"VbWX2u"}),sortable:!0,switchable:!1,render:a=>{let i=(a==null?void 0:a.supplier_part_detail)??{},P=(a==null?void 0:a.part_detail)??(i==null?void 0:i.part_detail)??{},K=[];if(i.pack_quantity_native!=1){let ee=a.quantity*i.pack_quantity_native;K.push(s.jsxs(B,{children:[t._({id:"J9LTXQ"}),": ",i.pack_quantity]},"pack-quantity")),K.push(s.jsxs(B,{children:[t._({id:"GbI1d2"}),": ",ee," ",P==null?void 0:P.units]},"total-quantity"))}return s.jsx(Te,{value:a.quantity,extra:K,title:t._({id:"VbWX2u"})})}},{accessor:"received",title:t._({id:"fZ5Vnu"}),sortable:!1,render:a=>s.jsx(Ee,{progressLabel:!0,value:a.received,maximum:a.quantity})},{accessor:"supplier_part_detail.packaging",sortable:!1,title:t._({id:"pD/Ew0"})},{accessor:"supplier_part_detail.pack_quantity",sortable:!1,title:t._({id:"J9LTXQ"})},{accessor:"supplier_part_detail.SKU",title:t._({id:"PeuqsI"}),switchable:!1,sortable:!0,ordering:"SKU"},{accessor:"supplier_link",title:t._({id:"h3/Rpt"}),sortable:!1,render:a=>{var i;return(i=a==null?void 0:a.supplier_part_detail)==null?void 0:i.link}},{accessor:"MPN",title:t._({id:"u7qly3"}),sortable:!0,render:a=>{var i,P;return(P=(i=a==null?void 0:a.supplier_part_detail)==null?void 0:i.manufacturer_part_detail)==null?void 0:P.MPN}},Ne({accessor:"purchase_price",title:t._({id:"vWelsN"})}),qe(),Me({}),{accessor:"destination",title:t._({id:"Enslfm"}),sortable:!1,render:a=>a.destination?Re({instance:a.destination_detail}):"-"},Oe({}),We({})],[l,p]),q=z({create:!0,orderId:l,supplierId:e}),[w,M]=c.useState({}),j=g({url:d.purchase_order_line_list,title:t._({id:"pwb7Yo"}),fields:q,initialData:{...w,purchase_price_currency:L},table:n}),[u,A]=c.useState(0),v=z({create:!1,orderId:l,supplierId:e}),S=Z({url:d.purchase_order_line_list,pk:u,title:t._({id:"vgosWS"}),fields:v,table:n}),x=Ge({url:d.purchase_order_line_list,pk:u,title:t._({id:"tpKh8C"}),table:n}),h=J({modelType:o.purchaseorder}),b=c.useMemo(()=>r.status==h.PENDING||r.status==h.PLACED||r.status==h.ON_HOLD,[r,h]),Y=c.useCallback(a=>[{hidden:((a==null?void 0:a.received)??0)>=((a==null?void 0:a.quantity)??0)||!b,title:t._({id:"ul9IpB"}),icon:s.jsx(G,{}),color:"green",onClick:()=>{R(a),C.open()}},ue({hidden:!p.hasChangeRole(_.purchase_order),onClick:()=>{A(a.pk),S.open()}}),me({hidden:!b||!p.hasAddRole(_.purchase_order),onClick:()=>{M({...a}),j.open()}}),_e({hidden:!p.hasDeleteRole(_.purchase_order),onClick:()=>{A(a.pk),x.open()}})],[l,p,b]),$=c.useMemo(()=>[s.jsx(X,{hidden:!b||!p.hasAddRole(_.purchase_order),tooltip:t._({id:"yWWRAr"}),icon:s.jsx(te,{}),onClick:()=>E.open()}),s.jsx(Xe,{tooltip:t._({id:"2vqtLo"}),onClick:()=>{M({order:l}),j.open()},hidden:!b||!(p!=null&&p.hasAddRole(_.purchase_order))}),s.jsx(X,{text:t._({id:"gyK1dv"}),icon:s.jsx(G,{}),onClick:()=>C.open(),disabled:n.selectedRecords.length===0,hidden:!b||!p.hasChangeRole(_.purchase_order)})],[l,p,n,b]);return s.jsxs(s.Fragment,{children:[E.modal,C.modal,j.modal,S.modal,x.modal,s.jsx(he,{url:F(d.purchase_order_line_list),tableState:n,columns:N,props:{enableSelection:!0,enableDownload:!0,params:{...f,order:l,part_detail:!0},rowActions:Y,tableActions:$,modelType:o.supplierpart,modelField:"part"}}),s.jsx(Qe,{sessionId:k??-1,opened:k!=null&&T,onClose:()=>{D(void 0),I(!1),n.refreshTable()}})]})}function Tt(){var j;const{id:r}=Ye(),l=Q(),L=Ke(),{instance:e,instanceQuery:f,refreshInstance:n,requestStatus:p}=He({endpoint:d.purchase_order_list,pk:r,params:{supplier_detail:!0},refetchOnMount:!0}),T=c.useMemo(()=>{var u;return e.order_currency||((u=e.supplier_detail)==null?void 0:u.currency)||L.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,L]),I=Be(),k=Z({url:d.purchase_order_list,pk:r,title:t._({id:"lAF9Uk"}),fields:I,onFormSuccess:()=>{n()}}),D=g({url:d.purchase_order_list,title:t._({id:"XRoR1U"}),fields:I,initialData:{...e,reference:void 0},follow:!0,modelType:o.purchaseorder}),W=c.useMemo(()=>{var x;if(f.isFetching)return s.jsx(se,{});let u=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"supplier_reference",label:t._({id:"K7PVg3"}),icon:"reference",hidden:!e.supplier_reference,copy:!0},{type:"link",name:"supplier",icon:"suppliers",label:t._({id:"PYTEl0"}),model:o.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:o.purchaseorder}],A=[{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>{var h;return(e==null?void 0:e.order_currency)??((h=e==null?void 0:e.supplier_detail)==null?void 0:h.currency)}},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var h;return we(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)??((h=e==null?void 0:e.supplier_detail)==null?void 0:h.currency)})}}],v=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"link",model:o.contact,link:!1,name:"contact",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact}],S=[{type:"text",name:"creation_date",label:t._({id:"x9P/+F"}),icon:"calendar"},{type:"text",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",hidden:!e.target_date},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}];return s.jsxs(je,{children:[s.jsxs(U,{children:[s.jsx(U.Col,{span:4,children:s.jsx(Se,{appRole:_.purchase_order,apiPath:d.company_list,src:(x=e.supplier_detail)==null?void 0:x.image,pk:e.supplier})}),s.jsx(U.Col,{span:8,children:s.jsx(O,{fields:u,item:e})})]}),s.jsx(O,{fields:A,item:e}),s.jsx(O,{fields:v,item:e}),s.jsx(O,{fields:S,item:e})]})},[e,f]),E=c.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:s.jsx(ae,{}),content:W},{name:"line-items",label:t._({id:"SgduFH"}),icon:s.jsx(ie,{}),content:s.jsxs(y,{multiple:!0,defaultValue:["line-items","extra-items"],children:[s.jsxs(y.Item,{value:"line-items",children:[s.jsx(y.Control,{children:s.jsx(V,{size:"lg",children:t._({id:"SgduFH"})})}),s.jsx(y.Panel,{children:s.jsx($e,{order:e,currency:T,orderId:Number(r),supplierId:Number(e.supplier)})})]},"lineitems"),s.jsxs(y.Item,{value:"extra-items",children:[s.jsx(y.Control,{children:s.jsx(V,{size:"lg",children:t._({id:"l11DG/"})})}),s.jsx(y.Panel,{children:s.jsx(ze,{endpoint:d.purchase_order_extra_line_list,orderId:e.pk,currency:T,role:_.purchase_order})})]},"extraitems")]})},{name:"received-stock",label:t._({id:"b447qM"}),icon:s.jsx(re,{}),content:s.jsx(Je,{tableName:"received-stock",params:{purchase_order:r}})},{name:"attachments",label:t._({id:"w/Sphq"}),icon:s.jsx(le,{}),content:s.jsx(Ve,{model_type:o.purchaseorder,model_id:e.pk})},{name:"notes",label:t._({id:"1DBGsz"}),icon:s.jsx(ne,{}),content:s.jsx(Pe,{modelType:o.purchaseorder,modelId:e.pk,editable:l.hasChangeRole(_.purchase_order)})}],[e,r,l]),m=J({modelType:o.purchaseorder}),R=g({url:F(d.purchase_order_issue,e.pk),title:t._({id:"keApR9"}),onFormSuccess:n,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),C=g({url:F(d.purchase_order_cancel,e.pk),title:t._({id:"98xQHK"}),onFormSuccess:n,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),N=g({url:F(d.purchase_order_hold,e.pk),title:t._({id:"vJaCK0"}),onFormSuccess:n,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),q=g({url:F(d.purchase_order_complete,e.pk),title:t._({id:"CWbcdO"}),successMessage:t._({id:"W7TghJ"}),timeout:1e4,fields:{accept_incomplete:{}},onFormSuccess:n,preFormWarning:t._({id:"DYITap"})}),w=c.useMemo(()=>{const u=l.hasChangeRole(_.purchase_order),A=u&&(e.status==m.PENDING||e.status==m.ON_HOLD),v=u&&(e.status==m.PENDING||e.status==m.PLACED),S=u&&e.status==m.PLACED,x=u&&e.status!=m.CANCELLED&&e.status!=m.COMPLETE;return[s.jsx(H,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!A,color:"blue",onClick:R.open}),s.jsx(H,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!S,color:"green",onClick:q.open}),s.jsx(de,{model:o.purchaseorder,pk:e.pk}),s.jsx(fe,{model:o.purchaseorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),s.jsx(xe,{modelType:o.purchaseorder,items:[e.pk],enableReports:!0}),s.jsx(be,{tooltip:t._({id:"/IKytX"}),icon:s.jsx(oe,{}),actions:[ye({hidden:!u,tooltip:t._({id:"mVeaUg"}),onClick:()=>{k.open()}}),ge({hidden:!l.hasAddRole(_.purchase_order),onClick:()=>D.open(),tooltip:t._({id:"oi/3Pq"})}),ke({tooltip:t._({id:"20mLBC"}),hidden:!v,onClick:N.open}),Ce({tooltip:t._({id:"tVJk4q"}),hidden:!x,onClick:C.open})]})]},[r,e,l,m]),M=c.useMemo(()=>f.isLoading?[]:[s.jsx(ve,{status:e.status_custom_key,type:o.purchaseorder,options:{size:"lg"}})],[e,f]);return s.jsxs(s.Fragment,{children:[R.modal,N.modal,C.modal,q.modal,k.modal,D.modal,s.jsx(Ae,{status:p,loading:f.isFetching,children:s.jsxs(ce,{gap:"xs",children:[s.jsx(Ie,{title:t._({id:"KxySMG"})+`: ${e.reference}`,subtitle:e.description,imageUrl:(j=e.supplier_detail)==null?void 0:j.image,breadcrumbs:[{name:t._({id:"UOTpFa"}),url:"/purchasing/"}],actions:w,badges:M,editAction:k.open,editEnabled:l.hasChangePermission(o.purchaseorder)}),s.jsx(De,{pageKey:"purchaseorder",panels:E})]})})]})}export{Tt as default};
