import{r as d,i,j as n,b7 as z,c5 as V,ba as y,bW as S,G as O,m as C,cV as P,cX as L,bK as U}from"./vendor-B0vSnHFf.js";import{A as _,s as X,M as K,e as q,d as A}from"./index-CDdQlqFV.js";import{A as w}from"./ActionButton-Br0cBRLA.js";import{a as D,b as N,T as Q}from"./UseForm-BimrM1zK.js";import{T as E,S as B}from"./Instance-Co8OMzcE.js";import{S as W}from"./StylishText-CrpvZzAV.js";import{I as T,m as H}from"./BaseContext-DSwOqL9e.js";import{u as Y,a as Z}from"./UseGenerator-C7bjPlPb.js";function $({create:e=!1}){const[s,a]=d.useState(null),[t,l]=d.useState(null),[r,f]=d.useState(""),[m,g]=d.useState(""),[p,j]=d.useState(!1),u=Y(c=>{r||f(c)}),h=Z(c=>{!m&&e&&p&&g(c)});return d.useMemo(()=>({part:{value:s,disabled:!e,onValueChange:(o,F)=>{a(o),j(F.trackable??!1),u.update({part:o}),h.update({part:o}),F.trackable||g(""),l(null)}},supplier_part:{value:t,onValueChange:o=>{l(o)},filters:{part_detail:!0,supplier_detail:!0,...s?{part:s}:{}},adjustFilters:o=>(o.data.part&&(o.filters.part=o.data.part),o.filters)},use_pack_size:{hidden:!e,description:i._({id:"qyS7x9"})},location:{hidden:!e,onValueChange:o=>{u.update({location:o})},filters:{structural:!1}},quantity:{hidden:!e,description:i._({id:"LWFE8j"}),onValueChange:o=>{u.update({quantity:o})}},serial_numbers:{field_type:"string",label:i._({id:"VzQT2x"}),description:i._({id:"0dR85g"}),required:!1,disabled:!p,hidden:!e,value:m,onValueChange:o=>g(o)},serial:{hidden:e},batch:{value:r,onValueChange:o=>f(o)},status:{},expiry_date:{},purchase_price:{},purchase_price_currency:{},packaging:{},link:{},owner:{},delete_on_deplete:{}}),[s,t,r,m,p,e])}function he(){const e=$({create:!0});return D({url:_.stock_item_list,fields:e,title:i._({id:"bJLEQT"})})}function I({stockItem:e,value:s}){const{data:a}=L({queryKey:["location",e.part_detail.default_location??e.part_detail.category_default_location],queryFn:async()=>{const t=q(_.stock_location_list,e.part_detail.default_location??e.part_detail.category_default_location);return A.get(t).then(l=>{switch(l.status){case 200:return l.data;default:return null}}).catch(()=>null)}});return n.jsxs(S,{gap:"sm",justify:"space-evenly",align:"center",children:[n.jsxs(S,{gap:"sm",direction:"column",align:"center",children:[n.jsxs(C,{children:[s," x ",e.part_detail.name]}),n.jsx(E,{src:e.part_detail.thumbnail,size:80,align:"center"})]}),n.jsxs(S,{direction:"column",gap:"sm",align:"center",children:[n.jsx(C,{children:e.location_detail.pathstring}),n.jsx(T,{icon:"arrow_down"}),n.jsx(d.Suspense,{fallback:n.jsx(U,{width:"150px"}),children:n.jsx(C,{children:a==null?void 0:a.pathstring})})]})]})}function ee(e,s,a){H.openConfirmModal({title:n.jsx(W,{children:"Confirm Stock Transfer"}),children:n.jsx(I,{stockItem:e,value:s}),onConfirm:()=>{e.location===e.part_detail.default_location||e.location===e.part_detail.category_default_location||A.post(q(_.stock_transfer),{items:[{pk:e.pk,quantity:s,batch:e.batch,status:e.status}],location:e.part_detail.default_location??e.part_detail.category_default_location}).then(t=>(a(),t.data)).catch(()=>null)}})}function x({input:e,transfer:s=!1,add:a=!1,setMax:t=!1,merge:l=!1,record:r}){var o,F,M,J,R;const f=e.item,[m,g]=d.useState(a?0:f.quantity??0),p=d.useCallback(b=>{g(b),e.changeFn(e.idx,"quantity",b)},[f]);d.useCallback((b,G)=>{e.changeFn(e.idx,b,G)},[e]);const j=()=>{e.removeFn(e.idx)},[u,h]=V(!1,{onOpen:()=>{s&&e.changeFn(e.idx,"packaging",(r==null?void 0:r.packaging)||void 0)},onClose:()=>{s&&e.changeFn(e.idx,"packaging",void 0)}}),c=d.useMemo(()=>r?r.serial?`#${r.serial}`:`${r.quantity}`:"-",[r]);return r?n.jsxs(n.Fragment,{children:[n.jsxs(y.Tr,{children:[n.jsx(y.Td,{children:n.jsxs(S,{gap:"sm",align:"center",children:[n.jsx(E,{size:40,src:(o=r.part_detail)==null?void 0:o.thumbnail,align:"center"}),n.jsx("div",{children:(F=r.part_detail)==null?void 0:F.name})]})}),n.jsx(y.Td,{children:r.location?(M=r.location_detail)==null?void 0:M.pathstring:"-"}),n.jsx(y.Td,{children:n.jsx(S,{align:"center",gap:"xs",children:n.jsxs(O,{justify:"space-between",children:[n.jsx(C,{children:c}),n.jsx(B,{status:r.status,type:K.stockitem})]})})}),!l&&n.jsx(y.Td,{children:n.jsx(P,{value:m,onChange:p,disabled:!!r.serial&&r.quantity==1,max:t?r.quantity:void 0,min:0,style:{maxWidth:"100px"}})}),n.jsx(y.Td,{children:n.jsxs(S,{gap:"3px",children:[s&&n.jsx(w,{onClick:()=>ee(r,m,j),icon:n.jsx(T,{icon:"default_location"}),tooltip:i._({id:"b+SPUR"}),tooltipAlignment:"top",disabled:!((J=r.part_detail)!=null&&J.default_location)&&!((R=r.part_detail)!=null&&R.category_default_location)}),s&&n.jsx(w,{size:"sm",icon:n.jsx(T,{icon:"packaging"}),tooltip:i._({id:"O7MZ1G"}),onClick:()=>h.toggle(),variant:u?"filled":"transparent"}),n.jsx(w,{onClick:()=>e.removeFn(e.idx),icon:n.jsx(T,{icon:"square_x"}),tooltip:i._({id:"zMFs5V"}),tooltipAlignment:"top",color:"red"})]})})]}),s&&n.jsx(Q,{visible:s&&u,onValueChange:b=>{e.changeFn(e.idx,"packaging",b||void 0)},fieldDefinition:{field_type:"string",label:i._({id:"pD/Ew0"})},defaultValue:r.packaging})]}):n.jsx("div",{children:i._({id:"Z3FXyt"})})}function v(e){return e.map(a=>({pk:a.pk,quantity:a.quantity,batch:a.batch,status:a.status,packaging:a.packaging,obj:a}))}function te(e){if(!e)return{};const s=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:v(e),modelRenderer:t=>n.jsx(x,{input:t,transfer:!0,setMax:!0,record:s[t.item.pk]},t.item.pk),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"QWdKwH"}),i._({id:"7L01XJ"})]},location:{filters:{structural:!1}},notes:{}}}function ie(e){if(!e)return{};const s=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:v(e),modelRenderer:t=>n.jsx(x,{input:t,setMax:!0,record:s[t.item.pk]},t.item.pk),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"t/YqKh"}),i._({id:"7L01XJ"})]},notes:{}}}function ne(e){if(!e)return{};const s=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:v(e),modelRenderer:t=>n.jsx(x,{input:t,add:!0,record:s[t.item.pk]},t.item.pk),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"m16xKo"}),i._({id:"7L01XJ"})]},notes:{}}}function se(e){if(!e)return{};const s=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:v(e),modelRenderer:t=>n.jsx(x,{input:t,record:s[t.item.pk]},t.item.pk),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"wBMjJ2"}),i._({id:"7L01XJ"})]},notes:{}}}function ae(e){if(!e)return{};const s=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:e.map(t=>t.pk),modelRenderer:t=>n.jsx(x,{input:t,merge:!0,record:s[t.item]},t.item),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"7L01XJ"})]},status_custom_key:{},note:{}}}function re(e){var t;if(!e)return{};const s=Object.fromEntries(e.map(l=>[l.pk,l]));return{items:{field_type:"table",value:e.map(l=>({item:l.pk,obj:l})),modelRenderer:l=>n.jsx(x,{input:l,merge:!0,record:s[l.item.item]},l.item.item),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"7L01XJ"})]},location:{default:(t=e[0])==null?void 0:t.part_detail.default_location,filters:{structural:!1}},notes:{},allow_mismatched_suppliers:{},allow_mismatched_status:{}}}function oe(e){if(!e)return{};const s=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:e.map(t=>({item:t.pk,obj:t})),modelRenderer:t=>n.jsx(x,{input:t,merge:!0,record:s[t.item.item]},t.item.item),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"7L01XJ"})]},customer:{filters:{is_customer:!0}},notes:{}}}function le(e){if(!e)return{};const s=Object.fromEntries(e.map(t=>[t.pk,t]));return{items:{field_type:"table",value:e.map(t=>t.pk),modelRenderer:t=>n.jsx(x,{input:t,merge:!0,record:s[t.item]},t.item),headers:[i._({id:"vgP+9p"}),i._({id:"wJijgU"}),i._({id:"zn38D/"}),i._({id:"7L01XJ"})]}}}function k({items:e,pk:s,model:a,refresh:t,fieldGenerator:l,endpoint:r,filters:f,title:m,modalFunc:g=D}){const p={part_detail:!0,location_detail:!0,cascade:!1},j=d.useMemo(()=>{let c={...p,...f??{}};return c[a]=s===void 0&&a==="location"?"null":s,c},[p,f,a,s]),{data:u}=z({queryKey:["stockitems",a,s,e,j],queryFn:async()=>{if(e)return Array.isArray(e)?e:[e];const c=q(_.stock_item_list);return A.get(c,{params:j}).then(o=>{if(o.status===200)return o.data}).catch(()=>null)}}),h=d.useMemo(()=>l(u),[u]);return g({url:r,fields:h,title:m,onFormSuccess:()=>t()})}function xe(e){return k({...e,fieldGenerator:ne,endpoint:_.stock_add,title:i._({id:"smUxso"})})}function ke(e){return k({...e,fieldGenerator:ie,endpoint:_.stock_remove,title:i._({id:"dxvf6V"})})}function je(e){return k({...e,fieldGenerator:te,endpoint:_.stock_transfer,title:i._({id:"9efe+k"})})}function be(e){return k({...e,fieldGenerator:se,endpoint:_.stock_count,title:i._({id:"n/p2QJ"})})}function ye(e){return k({...e,fieldGenerator:ae,endpoint:_.stock_change_status,title:i._({id:"Y+vtBl"})})}function Se(e){return k({...e,fieldGenerator:re,endpoint:_.stock_merge,title:i._({id:"z5kN6j"})})}function Fe(e){return k({...e,fieldGenerator:oe,endpoint:_.stock_assign,title:"Assign Stock to Customer"})}function Ce(e){return k({...e,fieldGenerator:le,endpoint:_.stock_item_list,modalFunc:N,title:i._({id:"khKVoc"})})}function Te(){return{parent:{description:i._({id:"9P2CtI"}),required:!1},name:{},description:{},structural:{},external:{},custom_icon:{field_type:"icon"},location_type:{}}}function ve({partId:e,itemId:s,templateId:a,editTemplate:t=!1}){const[l,r]=d.useState([]),[f,m]=d.useState("string"),g=X.getState(),p=d.useMemo(()=>g.isSet("TEST_STATION_DATA"),[g]);return d.useMemo(()=>({stock_item:{value:s,hidden:!0},template:{disabled:!t&&!!a,filters:{include_inherited:!0,part:e},onValueChange:(j,u)=>{if(u!=null&&u.choices){let h=u.choices.split(",");h.length>0?(r(h.map(c=>({label:c.trim(),value:c.trim()}))),m("choice")):(r([]),m("string"))}}},result:{},value:{field_type:f,choices:f==="choice"?l:void 0},attachment:{},notes:{},started_datetime:{hidden:!p},finished_datetime:{hidden:!p},test_station:{hidden:!p}}),[l,t,f,e,s,a,p])}export{$ as a,je as b,xe as c,ke as d,be as e,ye as f,Se as g,Fe as h,Ce as i,ve as j,Te as s,he as u};
