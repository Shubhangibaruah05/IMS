import{r,i as t,j as e,G as P,m as u,S as c,bd as S,I as M,am as v,c1 as B,z as G,bl as J,fC as Q,bc as E,cj as h,B as V,T as b,b5 as C,fD as Z}from"./vendor-B0vSnHFf.js";import{T as _}from"./BaseContext-DSwOqL9e.js";import{a as U,c as X,A as d,d as H,e as F}from"./index-CDdQlqFV.js";import{A as L}from"./ActionButton-Br0cBRLA.js";import{Y as K}from"./YesNoButton-1B57tnbm.js";import{I as l}from"./InfoItem-DSTJmwsR.js";import{D as q}from"./DetailDrawer-DenR9muX.js";import{P as $}from"./SettingList-CP9YLWgd.js";import{u as D,a as ee,b as se}from"./UseForm-BimrM1zK.js";import{u as te}from"./UseInstance-Bcp_oSAZ.js";import{u as ae,I as ie}from"./InvenTreeTable-D26a1r6-.js";import{u as le}from"./DesktopAppView-CofLSp00.js";import"./Boundary-CysPC9mI.js";import"./Instance-Co8OMzcE.js";import"./StylishText-CrpvZzAV.js";function ne({pluginKey:i}){var p,j;const{instance:s,instanceQuery:{isFetching:m,error:o}}=te({endpoint:d.plugin_list,hasPrimaryKey:!0,pk:i,throwError:!0});return!i||m?e.jsx(E,{visible:!0}):!s||o?e.jsx(u,{children:((p=o==null?void 0:o.response)==null?void 0:p.status)===404?e.jsx(_,{id:"j7QLNC",values:{pluginKey:i}}):e.jsx(_,{id:"1eDLl4"})}):e.jsxs(c,{gap:"xs",children:[e.jsx(h,{withBorder:!0,children:e.jsxs(P,{justify:"left",children:[e.jsx(V,{}),e.jsxs(P,{gap:"xs",children:[s&&e.jsx(O,{plugin:s}),e.jsx(b,{order:4,children:((j=s==null?void 0:s.meta)==null?void 0:j.human_name)??(s==null?void 0:s.name)??"-"})]})]})}),e.jsx(E,{visible:m,overlayProps:{opacity:0}}),e.jsx(h,{withBorder:!0,children:e.jsxs(c,{gap:"md",children:[e.jsx(b,{order:4,children:e.jsx(_,{id:"t4Dg7a"})}),s.active?e.jsxs(c,{pos:"relative",gap:"xs",children:[e.jsx(l,{type:"text",name:t._({id:"6YtxFj"}),value:s==null?void 0:s.name}),e.jsx(l,{type:"text",name:t._({id:"Nu4oKW"}),value:s==null?void 0:s.meta.description}),e.jsx(l,{type:"text",name:t._({id:"VbeIOx"}),value:s==null?void 0:s.meta.author}),e.jsx(l,{type:"text",name:t._({id:"mYGY3B"}),value:s==null?void 0:s.meta.pub_date}),e.jsx(l,{type:"text",name:t._({id:"eE0JZ4"}),value:s==null?void 0:s.meta.version}),e.jsx(l,{type:"boolean",name:t._({id:"F6pfE9"}),value:s==null?void 0:s.active})]}):e.jsx(u,{color:"red",children:t._({id:"xwdvWr"})})]})}),s.active&&e.jsx(h,{withBorder:!0,children:e.jsxs(c,{gap:"md",children:[e.jsx(b,{order:4,children:e.jsx(_,{id:"sxxj4o"})}),e.jsxs(c,{pos:"relative",gap:"xs",children:[(s==null?void 0:s.is_package)&&e.jsx(l,{type:"text",name:t._({id:"/L+cAM"}),value:s==null?void 0:s.package_name}),e.jsx(l,{type:"text",name:t._({id:"AJd5vK"}),value:s==null?void 0:s.meta.package_path}),e.jsx(l,{type:"boolean",name:t._({id:"++LBSt"}),value:s==null?void 0:s.is_builtin}),e.jsx(l,{type:"boolean",name:t._({id:"mGYa19"}),value:s==null?void 0:s.is_package})]})]})}),s&&(s==null?void 0:s.active)&&e.jsx(h,{withBorder:!0,children:e.jsxs(c,{gap:"md",children:[e.jsx(b,{order:4,children:e.jsx(_,{id:"xWsR91"})}),e.jsx($,{pluginKey:i})]})})]})}function O({plugin:i}){return i!=null&&i.is_installed?i!=null&&i.active?e.jsx(C,{label:t._({id:"QqLLp2"}),children:e.jsx(M,{color:"green"})}):e.jsx(C,{label:t._({id:"s99Mc1"}),children:e.jsx(v,{color:"red"})}):e.jsx(C,{label:t._({id:"LtEW/l"}),children:e.jsx(Z,{})})}function ge(){const i=ae("plugin"),s=le(),m=U(),[o,p]=X(a=>[a.server.plugins_enabled,a.server.plugins_install_disabled]),j=r.useMemo(()=>[{accessor:"name",title:t._({id:"fOuPPd"}),sortable:!0,render:function(a){if(a)return e.jsxs(P,{justify:"left",children:[e.jsx(O,{plugin:a}),e.jsx(u,{children:a.name})]})}},{accessor:"active",sortable:!0,title:t._({id:"F6pfE9"}),render:a=>e.jsx(K,{value:a.active})},{accessor:"meta.description",title:t._({id:"Nu4oKW"}),sortable:!1,render:function(a){return a.active?a==null?void 0:a.meta.description:e.jsx(u,{style:{fontStyle:"italic"},size:"sm",children:t._({id:"9YdyZU"})})}},{accessor:"meta.version",title:t._({id:"eE0JZ4"}),sortable:!1},{accessor:"meta.author",title:"Author",sortable:!1}],[]),[k,f]=r.useState(""),[x,T]=r.useState(!1),W=r.useMemo(()=>e.jsx(c,{gap:"xs",children:e.jsx(S,{color:x?"green":"red",icon:e.jsx(M,{}),title:x?t._({id:"fLe7w+"}):t._({id:"oBCe/M"}),children:e.jsx(u,{children:x?t._({id:"th4roR"}):t._({id:"WPCUXx"})})})}),[x]),g=D({title:t._({id:"2RHgaV"}),url:d.plugin_activate,pathParams:{key:k},preFormContent:W,fetchInitialData:!1,method:"POST",successMessage:x?"The plugin was activated":"The plugin was deactivated",fields:{active:{value:x,hidden:!0}},table:i}),R=r.useCallback(a=>{let n=[];return!a.is_builtin&&a.is_installed&&(a.active?n.push({title:t._({id:"5y3O+A"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{f(a.key),T(!1),g.open()}}):n.push({title:t._({id:"FQBaXG"}),color:"green",icon:e.jsx(M,{}),onClick:()=>{f(a.key),T(!0),g.open()}})),a.active&&a.is_package&&a.package_name&&n.push({title:t._({id:"EkH9pt"}),color:"blue",icon:e.jsx(B,{}),onClick:()=>{I(a.package_name),y.open()}}),!a.active&&a.is_installed&&a.is_package&&a.package_name&&n.push({title:t._({id:"fo0VXg"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{f(a.key),A.open()},disabled:p||!1}),a.is_installed||n.push({title:t._({id:"cnGeoo"}),color:"red",icon:e.jsx(v,{}),onClick:()=>{f(a.key),w.open()}}),n},[m,o]),[Y,I]=r.useState(""),y=ee({title:t._({id:"R7k68Z"}),url:d.plugin_install,timeout:3e4,fields:{packagename:{},url:{},version:{},confirm:{}},initialData:{packagename:Y},closeOnClickOutside:!1,submitText:t._({id:"TKQ7K+"}),successMessage:t._({id:"MiYlP5"}),table:i}),A=D({title:t._({id:"mXzRzO"}),url:d.plugin_uninstall,pathParams:{key:k},fetchInitialData:!1,timeout:3e4,fields:{delete_config:{}},preFormContent:e.jsx(S,{color:"red",icon:e.jsx(G,{}),title:t._({id:"6onEou"}),children:e.jsxs(c,{gap:"xs",children:[e.jsx(u,{children:t._({id:"nh4MTY"})}),e.jsx(u,{children:t._({id:"2xOCJW"})})]})}),successMessage:t._({id:"MAZU/W"}),table:i}),w=se({url:d.plugin_list,pathParams:{key:k},title:t._({id:"nud26y"}),preFormWarning:t._({id:"vb5uIh"}),table:i}),N=r.useCallback(()=>{H.post(F(d.plugin_reload),{full_reload:!0,force_reload:!0,collect_plugins:!0}).then(()=>{J({title:t._({id:"Bs76+T"}),message:t._({id:"js1VzJ"}),color:"green"}),i.refreshTable()})},[]),z=r.useMemo(()=>{var n;let a=[];return(n=m.user)!=null&&n.is_superuser&&o&&(a.push(e.jsx(L,{color:"green",icon:e.jsx(B,{}),tooltip:t._({id:"2VWTDu"}),onClick:N})),a.push(e.jsx(L,{color:"green",icon:e.jsx(Q,{}),tooltip:t._({id:"0O/OZv"}),onClick:()=>{I(""),y.open()},disabled:p||!1}))),a},[m,o]);return e.jsxs(e.Fragment,{children:[g.modal,y.modal,A.modal,w.modal,e.jsx(q,{title:t._({id:"NCjc4L"}),size:"50%",renderContent:a=>{if(a)return e.jsx(ne,{pluginKey:a})}}),e.jsx(ie,{url:F(d.plugin_list),tableState:i,columns:j,props:{enableDownload:!1,rowActions:R,onRowClick:a=>s(`${a.key}/`),tableActions:z,tableFilters:[{name:"active",label:t._({id:"F6pfE9"}),type:"boolean"},{name:"builtin",label:t._({id:"++LBSt"}),type:"boolean"},{name:"sample",label:t._({id:"LcJmOR"}),type:"boolean"},{name:"installed",label:t._({id:"eQkgKV"}),type:"boolean"}]}})]})}export{ne as PluginDrawer,ge as default};
