import{r as n,i as o,j as t,G as B,bK as W,m as J,z as K,H as P,aW as U,aL as V,S as G}from"./vendor-B0vSnHFf.js";import{A as O}from"./ActionButton-Br0cBRLA.js";import{A as Y}from"./AdminButton-Cl1ixKQi.js";import{u as Z,R as H,I as q,B as X,P as $,A as v,E as ee,D as te}from"./InvenTreeTable-D26a1r6-.js";import{I as oe,D as M,a as se}from"./InstanceDetail-Cejekc8J.js";import{A as f,g as F}from"./Instance-Co8OMzcE.js";import{N as ae}from"./NavigationTree-Cw872Gub.js";import{P as ne}from"./PageDetail-B4PsctWo.js";import{P as ie}from"./PanelGroup-DRVQKYn0.js";import{a as w,e as L,A as c,M as i,U as h,w as A}from"./index-CDdQlqFV.js";import{s as S,b as ce,e as le}from"./StockForms-DLBgZVBa.js";import{I as u}from"./BaseContext-DSwOqL9e.js";import{a as re,u as E,b as me}from"./UseForm-BimrM1zK.js";import{u as de}from"./UseInstance-Bcp_oSAZ.js";import{P as pe}from"./PartTable-CERxeXjr.js";import{S as ue}from"./StockItemTable-Cop_NVCl.js";import{A as ke}from"./AddItemButton-CD0U_4gd.js";import{b as _e}from"./UseFilter-Blar5lCV.js";import{D as be,B as R}from"./ColumnRenderers-CwItNORh.js";import{d as xe,u as fe}from"./DesktopAppView-CofLSp00.js";import"./Boundary-CysPC9mI.js";import"./StylishText-CrpvZzAV.js";import"./YesNoButton-1B57tnbm.js";import"./GenericErrorPage-BifXQa91.js";import"./NotFound-DXIcBWRy.js";import"./PermissionDenied-Cl_T9Vqt.js";import"./UseGenerator-C7bjPlPb.js";import"./PartForms-CPuh80H4.js";function he({parentId:l}){const s=Z("stocklocation"),r=w(),m=_e({url:L(c.stock_location_type_list),transform:a=>({value:a.pk,label:a.name})}),j=n.useMemo(()=>[{name:"cascade",label:o._({id:"VY386J"}),description:o._({id:"Ue7Vtx"})},{name:"structural",label:o._({id:"PRKZBP"}),description:o._({id:"zW8WBT"})},{name:"external",label:o._({id:"bVhrVt"}),description:o._({id:"ckSQBM"})},{name:"has_location_type",label:o._({id:"Sgyhpp"})},{name:"location_type",label:o._({id:"4sg5Qp"}),description:o._({id:"buIdz6"}),choices:m.choices}],[m.choices]),_=n.useMemo(()=>[{accessor:"name",switchable:!1,render:a=>t.jsxs(B,{gap:"xs",children:[a.icon&&t.jsx(f,{name:a.icon}),a.name]})},be({}),{accessor:"pathstring",sortable:!0},{accessor:"items",sortable:!0},R({accessor:"structural"}),R({accessor:"external"}),{accessor:"location_type",sortable:!1,render:a=>{var d;return(d=a.location_type_detail)==null?void 0:d.name}}],[]),e=re({url:c.stock_location_list,title:o._({id:"sklcDg"}),fields:S(),focus:"name",initialData:{parent:l},follow:!0,modelType:i.stocklocation,table:s}),[b,k]=n.useState(-1),x=E({url:c.stock_location_list,pk:b,title:o._({id:"Qdjbg8"}),fields:S(),onFormSuccess:a=>s.updateRecord(a)}),g=n.useMemo(()=>{let a=r.hasAddRole(h.stock_location);return[t.jsx(ke,{tooltip:o._({id:"sklcDg"}),onClick:()=>e.open(),hidden:!a})]},[r]),y=n.useCallback(a=>{let d=r.hasChangeRole(h.stock_location);return[H({hidden:!d,onClick:()=>{k(a.pk),x.open()}})]},[r]);return t.jsxs(t.Fragment,{children:[e.modal,x.modal,t.jsx(q,{url:L(c.stock_location_list),tableState:s,columns:_,props:{enableSelection:!0,enableDownload:!0,enableLabels:!0,enableReports:!0,params:{parent:l,top_level:l===void 0?!0:void 0},tableFilters:j,tableActions:g,rowActions:y,modelType:i.stocklocation}})]})}function Ye(){const{id:l}=xe(),s=n.useMemo(()=>isNaN(parseInt(l||""))?void 0:l,[l]),r=fe(),m=w(),[j,_]=n.useState(!1),{instance:e,refreshInstance:b,instanceQuery:k,requestStatus:x}=de({endpoint:c.stock_location_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),g=n.useMemo(()=>{if(s&&k.isFetching)return t.jsx(W,{});let p=[{type:"text",name:"name",label:o._({id:"6YtxFj"}),copy:!0,value_formatter:()=>t.jsxs(B,{gap:"xs",children:[e.icon&&t.jsx(f,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:o._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:o._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:o._({id:"+o9hiJ"}),model:i.stocklocation,hidden:!(e!=null&&e.parent)}],Q=[{type:"text",name:"items",icon:"stock",label:o._({id:"Jbck4N"}),value_formatter:()=>(e==null?void 0:e.items)||"0"},{type:"text",name:"sublocations",icon:"location",label:o._({id:"L7/8CO"}),hidden:!(e!=null&&e.sublocations)},{type:"boolean",name:"structural",label:o._({id:"PRKZBP"}),icon:"sitemap"},{type:"boolean",name:"external",label:o._({id:"bVhrVt"})},{type:"string",name:"location_type_detail.name",label:o._({id:"4sg5Qp"}),hidden:!(e!=null&&e.location_type),icon:"packages"}];return t.jsxs(oe,{children:[s&&(e!=null&&e.pk)?t.jsx(M,{item:e,fields:p}):t.jsx(J,{children:o._({id:"js9HzF"})}),s&&(e==null?void 0:e.pk)&&t.jsx(M,{item:e,fields:Q})]})},[e,k]),y=n.useMemo(()=>[{name:"details",label:o._({id:"AC8C/Z"}),icon:t.jsx(K,{}),content:g},{name:"stock-items",label:o._({id:"Jbck4N"}),icon:t.jsx(P,{}),content:t.jsx(ue,{tableName:"location-stock",allowAdd:!0,params:{location:s}})},{name:"sublocations",label:o._({id:"1eBWAw"}),icon:t.jsx(U,{}),content:t.jsx(he,{parentId:s})},{name:"default_parts",label:o._({id:"D19W4x"}),icon:t.jsx(P,{}),hidden:!e.pk,content:t.jsx(pe,{props:{params:{default_location:e.pk}}})}],[e,s]),a=E({url:c.stock_location_list,pk:s,title:o._({id:"Qdjbg8"}),fields:S(),onFormSuccess:b}),d=n.useMemo(()=>[{value:0,display_name:"Move items to parent location"},{value:1,display_name:o._({id:"lzGbCT"})}],[]),I=me({url:c.stock_location_list,pk:s,title:o._({id:"lnETLa"}),fields:{delete_stock_items:{label:o._({id:"j3pJx8"}),description:o._({id:"Ml7+Iv"}),field_type:"choice",choices:d},delete_sub_location:{label:o._({id:"+DlcAh"}),description:o._({id:"CEDjmR"}),field_type:"choice",choices:d}},onFormSuccess:()=>{e.parent?r(F(i.stocklocation,e.parent)):r("/stock/")}}),C=n.useMemo(()=>({pk:e.pk,model:"location",refresh:b,filters:{in_stock:!0}}),[e]),T=ce(C),D=le(C),N=n.useMemo(()=>[t.jsx(Y,{model:i.stocklocation,pk:e.pk}),t.jsx(O,{icon:t.jsx(u,{icon:"stocktake"}),onClick:A,variant:"outline",size:"lg"}),e.pk?t.jsx(X,{model:i.stocklocation,pk:e.pk,actions:[{name:"Scan in stock items",icon:t.jsx(u,{icon:"stock"}),tooltip:"Scan items",onClick:A},{name:"Scan in container",icon:t.jsx(u,{icon:"unallocated_stock"}),tooltip:"Scan container",onClick:A}]}):null,t.jsx($,{modelType:i.stocklocation,items:[e.pk??0],hidden:!(e!=null&&e.pk),enableLabels:!0,enableReports:!0}),t.jsx(v,{tooltip:o._({id:"bbA1t1"}),icon:t.jsx(u,{icon:"stock"}),actions:[{name:"Count Stock",icon:t.jsx(u,{icon:"stocktake",iconProps:{color:"blue"}}),tooltip:"Count Stock",onClick:()=>D.open()},{name:"Transfer Stock",icon:t.jsx(u,{icon:"transfer",iconProps:{color:"blue"}}),tooltip:"Transfer Stock",onClick:()=>T.open()}]}),t.jsx(v,{tooltip:o._({id:"Ego4rz"}),icon:t.jsx(V,{}),actions:[ee({hidden:!s||!m.hasChangeRole(h.stock_location),tooltip:o._({id:"Qdjbg8"}),onClick:()=>a.open()}),te({hidden:!s||!m.hasDeleteRole(h.stock_location),tooltip:o._({id:"lnETLa"}),onClick:()=>I.open()})]})],[e,s,m]),z=n.useMemo(()=>[{name:o._({id:"blbbPS"}),url:"/stock"},...(e.path??[]).map(p=>({name:p.name,url:F(i.stocklocation,p.pk),icon:p.icon?t.jsx(f,{name:p.icon}):void 0}))],[e]);return t.jsxs(t.Fragment,{children:[a.modal,I.modal,t.jsx(se,{status:x,loading:s?k.isFetching:!1,children:t.jsxs(G,{children:[t.jsx(ae,{title:o._({id:"1eBWAw"}),modelType:i.stocklocation,endpoint:c.stock_location_tree,opened:j,onClose:()=>_(!1),selectedId:e==null?void 0:e.pk}),t.jsx(ne,{title:o._({id:"Jbck4N"}),subtitle:e==null?void 0:e.name,icon:(e==null?void 0:e.icon)&&t.jsx(f,{name:e==null?void 0:e.icon}),actions:N,editAction:a.open,editEnabled:m.hasChangePermission(i.stocklocation),breadcrumbs:z,breadcrumbAction:()=>{_(!0)}}),t.jsx(ie,{pageKey:"stocklocation",panels:y}),T.modal,D.modal]})})]})}export{Ye as default};
