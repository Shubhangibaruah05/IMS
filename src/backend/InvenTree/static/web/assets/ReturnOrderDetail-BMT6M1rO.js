import{r as l,j as r,ee as H,i as t,eD as V,bK as Z,cY as v,z,_ as Q,bf as h,ac as Y,ad as J,aL as X,S as $}from"./vendor-B0vSnHFf.js";import{A as ee}from"./AdminButton-Cl1ixKQi.js";import{P as M}from"./PrimaryActionButton-C__mfMnP.js";import{u as te,S as re,R as se,a as ie,I as ne,B as oe,P as ae,A as le,E as de,d as ce,H as ue,C as me}from"./InvenTreeTable-D26a1r6-.js";import{I as pe,D as F,a as _e}from"./InstanceDetail-Cejekc8J.js";import{D as he,N as xe}from"./NotesEditor-DCyldUZp.js";import{S as U}from"./StylishText-CrpvZzAV.js";import{P as be}from"./PageDetail-B4PsctWo.js";import{P as fe}from"./PanelGroup-DRVQKYn0.js";import{S as ge}from"./Instance-Co8OMzcE.js";import{a as ye,R as je,S as Ce,d as G,j as w,N as ke,L as Se}from"./ColumnRenderers-CwItNORh.js";import{a as W,A as o,M as i,U as u,w as Ie,e as y,s as Re}from"./index-CDdQlqFV.js";import{u as Ae}from"./SalesOrderForms-BD5fZ2Wy.js";import{a as x,u as B,b as De}from"./UseForm-BimrM1zK.js";import{u as Fe}from"./UseInstance-Bcp_oSAZ.js";import{u as Pe}from"./UseStatusCodes-FmkSIrlp.js";import{A as Ne}from"./AttachmentTable-Mxcn-H07.js";import{E as Ee}from"./ExtraLineItemTable-COgtfa1u.js";import{A as Le}from"./AddItemButton-CD0U_4gd.js";import{d as Oe}from"./DesktopAppView-CofLSp00.js";import"./ActionButton-Br0cBRLA.js";import"./BaseContext-DSwOqL9e.js";import"./Boundary-CysPC9mI.js";import"./YesNoButton-1B57tnbm.js";import"./GenericErrorPage-BifXQa91.js";import"./NotFound-DXIcBWRy.js";import"./PermissionDenied-Cl_T9Vqt.js";import"./AttachmentLink-CL1ofkZf.js";import"./CommonForms-B4xIycy4.js";function q({orderId:d,customerId:n,create:_}){return l.useMemo(()=>({order:{disabled:!0,filters:{customer_detail:!0}},item:{filters:{customer:n,part_detail:!0,serialized:!0}},reference:{},outcome:{hidden:_==!0},price:{},price_currency:{},target_date:{},notes:{},link:{},responsible:{filters:{is_active:!0},icon:r.jsx(H,{})}}),[_,d,n])}function ve({orderId:d,customerId:n,currency:_}){const e=te("return-order-line-item"),a=W(),[p,j]=l.useState(0),C=q({orderId:d,customerId:n,create:!0}),P=q({orderId:d,customerId:n}),k=x({url:o.return_order_line_list,title:t._({id:"pwb7Yo"}),fields:C,initialData:{order:d,price_currency:_},table:e}),S=B({url:o.return_order_line_list,pk:p,title:t._({id:"vgosWS"}),fields:P,table:e}),b=De({url:o.return_order_line_list,pk:p,title:t._({id:"tpKh8C"}),table:e}),f=l.useMemo(()=>[{accessor:"part",title:t._({id:"vgP+9p"}),switchable:!1,render:s=>ye(s==null?void 0:s.part_detail)},{accessor:"item",title:t._({id:"igx8Og"}),switchable:!1},je({}),Ce({model:i.returnorderlineitem,sortable:!0,accessor:"outcome"}),{accessor:"price",render:s=>G(s.price,{currency:s.price_currency})},w({accessor:"target_date",title:t._({id:"ZmykKo"})}),w({accessor:"received_date",title:t._({id:"J18WDZ"})}),ke({accessor:"notes"}),Se({})],[]),I=l.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"qVsPia"})},{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"vQY+8t"}),choiceFunction:re(i.returnorderlineitem)}],[]),R=l.useMemo(()=>[r.jsx(Le,{tooltip:t._({id:"2vqtLo"}),hidden:!a.hasAddRole(u.return_order),onClick:()=>{k.open()}})],[a,d]),A=l.useCallback(s=>[{hidden:!!(s!=null&&s.received_date)||!a.hasChangeRole(u.return_order),title:t._({id:"7cTlo3"}),icon:r.jsx(V,{}),onClick:Ie},se({hidden:!a.hasChangeRole(u.return_order),onClick:()=>{j(s.pk),S.open()}}),ie({hidden:!a.hasDeleteRole(u.return_order),onClick:()=>{j(s.pk),b.open()}})],[a]);return r.jsxs(r.Fragment,{children:[k.modal,S.modal,b.modal,r.jsx(ne,{url:y(o.return_order_line_list),tableState:e,columns:f,props:{params:{order:d,part_detail:!0,item_detail:!0,order_detail:!0},tableActions:R,tableFilters:I,rowActions:A}})]})}function ut(){var T;const{id:d}=Oe(),n=W(),_=Re(),{instance:e,instanceQuery:a,refreshInstance:p,requestStatus:j}=Fe({endpoint:o.return_order_list,pk:d,params:{customer_detail:!0}}),C=l.useMemo(()=>{var m;return e.order_currency||((m=e.customer_detail)==null?void 0:m.currency)||_.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,_]),P=l.useMemo(()=>{var D;if(a.isFetching)return r.jsx(Z,{});let m=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:t._({id:"ZVUe1A"}),copy:!0,hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:t._({id:"876pfE"}),model:i.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:i.returnorder}],E=[{type:"text",name:"line_items",label:t._({id:"SgduFH"}),icon:"list"},{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>{var g;return(e==null?void 0:e.order_currency)??((g=e==null?void 0:e.customer_detail)==null?void 0:g.currency)}},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var g;return G(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)??((g=e==null?void 0:e.customer_detail)==null?void 0:g.currency)})}}],L=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"link",model:i.contact,link:!1,name:"contact",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact}],O=[{type:"text",name:"creation_date",label:t._({id:"x9P/+F"}),icon:"calendar"},{type:"text",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",hidden:!e.target_date},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}];return r.jsxs(pe,{children:[r.jsxs(v,{children:[r.jsx(v.Col,{span:4,children:r.jsx(he,{appRole:u.purchase_order,apiPath:o.company_list,src:(D=e.customer_detail)==null?void 0:D.image,pk:e.customer})}),r.jsx(v.Col,{span:8,children:r.jsx(F,{fields:m,item:e})})]}),r.jsx(F,{fields:E,item:e}),r.jsx(F,{fields:L,item:e}),r.jsx(F,{fields:O,item:e})]})},[e,a]),k=l.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:r.jsx(z,{}),content:P},{name:"line-items",label:t._({id:"SgduFH"}),icon:r.jsx(Q,{}),content:r.jsxs(h,{multiple:!0,defaultValue:["line-items","extra-items"],children:[r.jsxs(h.Item,{value:"line-items",children:[r.jsx(h.Control,{children:r.jsx(U,{size:"lg",children:t._({id:"SgduFH"})})}),r.jsx(h.Panel,{children:r.jsx(ve,{orderId:e.pk,customerId:e.customer,currency:C})})]},"lineitems"),r.jsxs(h.Item,{value:"extra-items",children:[r.jsx(h.Control,{children:r.jsx(U,{size:"lg",children:t._({id:"l11DG/"})})}),r.jsx(h.Panel,{children:r.jsx(Ee,{endpoint:o.return_order_extra_line_list,orderId:e.pk,currency:C,role:u.return_order})})]},"extraitems")]})},{name:"attachments",label:t._({id:"w/Sphq"}),icon:r.jsx(Y,{}),content:r.jsx(Ne,{model_type:i.returnorder,model_id:e.pk})},{name:"notes",label:t._({id:"1DBGsz"}),icon:r.jsx(J,{}),content:r.jsx(xe,{modelType:i.returnorder,modelId:e.pk,editable:n.hasChangeRole(u.return_order)})}],[e,d,n]),S=l.useMemo(()=>a.isLoading?[]:[r.jsx(ge,{status:e.status_custom_key,type:i.returnorder,options:{size:"lg"}})],[e,a]),b=Ae(),f=B({url:o.return_order_list,pk:e.pk,title:t._({id:"RDcVR0"}),fields:b,onFormSuccess:()=>{p()}}),I=x({url:o.return_order_list,title:t._({id:"mpNlR/"}),fields:b,initialData:{...e,reference:void 0},modelType:i.returnorder,follow:!0}),R=x({url:y(o.return_order_issue,e.pk),title:t._({id:"LUGEsQ"}),onFormSuccess:p,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),A=x({url:y(o.return_order_cancel,e.pk),title:t._({id:"qOAlIV"}),onFormSuccess:p,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"INmUKx"})}),s=x({url:y(o.return_order_hold,e.pk),title:t._({id:"Sd+hNf"}),onFormSuccess:p,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),N=x({url:y(o.return_order_complete,e.pk),title:t._({id:"yDIX54"}),onFormSuccess:p,preFormWarning:t._({id:"DYITap"}),successMessage:t._({id:"W7TghJ"})}),c=Pe({modelType:i.returnorder}),K=l.useMemo(()=>{const m=n.hasChangeRole(u.return_order),E=m&&(e.status==c.PENDING||e.status==c.ON_HOLD),L=m&&(e.status==c.PENDING||e.status==c.PLACED||e.status==c.IN_PROGRESS),O=m&&(e.status==c.PENDING||e.status==c.IN_PROGRESS||e.status==c.ON_HOLD),D=m&&e.status==c.IN_PROGRESS;return[r.jsx(M,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!E,color:"blue",onClick:()=>R.open()}),r.jsx(M,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!D,color:"green",onClick:()=>N.open()}),r.jsx(ee,{model:i.returnorder,pk:e.pk}),r.jsx(oe,{model:i.returnorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),r.jsx(ae,{modelType:i.returnorder,items:[e.pk],enableReports:!0}),r.jsx(le,{tooltip:t._({id:"/IKytX"}),icon:r.jsx(X,{}),actions:[de({hidden:!n.hasChangeRole(u.return_order),tooltip:t._({id:"mVeaUg"}),onClick:()=>{f.open()}}),ce({tooltip:t._({id:"oi/3Pq"}),hidden:!n.hasChangeRole(u.return_order),onClick:()=>I.open()}),ue({tooltip:t._({id:"20mLBC"}),hidden:!L,onClick:()=>s.open()}),me({tooltip:t._({id:"tVJk4q"}),hidden:!O,onClick:()=>A.open()})]})]},[n,e,c]);return r.jsxs(r.Fragment,{children:[f.modal,R.modal,A.modal,s.modal,N.modal,I.modal,r.jsx(_e,{status:j,loading:a.isFetching,children:r.jsxs($,{gap:"xs",children:[r.jsx(be,{title:t._({id:"Z6ve1w"})+`: ${e.reference}`,subtitle:e.description,imageUrl:(T=e.customer_detail)==null?void 0:T.image,badges:S,actions:K,breadcrumbs:[{name:t._({id:"mUv9U4"}),url:"/sales/"}],editAction:f.open,editEnabled:n.hasChangePermission(i.returnorder)}),r.jsx(fe,{pageKey:"returnorder",panels:k})]})})]})}export{ut as default};
